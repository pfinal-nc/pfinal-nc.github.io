import{_ as i,o as a,c as n,ac as t}from"./chunks/framework.CxPy2qzZ.js";const c=JSON.parse('{"title":"服务器进程日志分析：从头皮发麻到AI解救","description":"维护Web服务器时，面对密密麻麻的进程信息头皮发麻？这篇文章教你用Shell脚本记录服务器状态，配合AI分析，轻松搞定进程分析、性能监控、卡顿排查等问题。","frontmatter":{"title":"服务器进程日志分析：从头皮发麻到AI解救","date":"2025-12-26T11:10:00.000Z","tags":["工具","Shell","Linux","服务器监控","AI"],"description":"维护Web服务器时，面对密密麻麻的进程信息头皮发麻？这篇文章教你用Shell脚本记录服务器状态，配合AI分析，轻松搞定进程分析、性能监控、卡顿排查等问题。","author":"PFinal南丞","keywords":"服务器监控, 进程分析, Shell脚本, Linux命令, 性能优化, AI辅助分析, 服务器卡顿","head":[["link",{"rel":"canonical","href":"https://friday-go.icu/Tools/服务器进程日志分析：从头皮发麻到AI解救"}],["meta",{"name":"keywords","content":"服务器监控, 进程分析, Shell脚本, Linux命令, 性能优化, AI辅助分析, 服务器卡顿, PFinalClub, Golang教程, Go后端开发, Go微服务, PHP, Python, 技术博客"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"TechArticle\\",\\"headline\\":\\"服务器进程日志分析：从头皮发麻到AI解救\\",\\"url\\":\\"https://friday-go.icu/Tools/服务器进程日志分析：从头皮发麻到AI解救\\",\\"datePublished\\":\\"2025-12-26T11:10:00.000Z\\",\\"dateModified\\":1766721617000,\\"author\\":{\\"@type\\":\\"Person\\",\\"name\\":\\"PFinal南丞\\",\\"url\\":\\"https://friday-go.icu/about\\"},\\"publisher\\":{\\"@type\\":\\"Organization\\",\\"name\\":\\"PFinalClub\\",\\"logo\\":{\\"@type\\":\\"ImageObject\\",\\"url\\":\\"https://friday-go.icu/logo.png\\"}},\\"description\\":\\"维护Web服务器时，面对密密麻麻的进程信息头皮发麻？这篇文章教你用Shell脚本记录服务器状态，配合AI分析，轻松搞定进程分析、性能监控、卡顿排查等问题。\\",\\"inLanguage\\":\\"zh-CN\\",\\"mainEntityOfPage\\":{\\"@type\\":\\"WebPage\\",\\"@id\\":\\"https://friday-go.icu/Tools/服务器进程日志分析：从头皮发麻到AI解救\\"},\\"keywords\\":\\"服务器监控, 进程分析, Shell脚本, Linux命令, 性能优化, AI辅助分析, 服务器卡顿\\"}"],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"BreadcrumbList\\",\\"itemListElement\\":[{\\"@type\\":\\"ListItem\\",\\"position\\":1,\\"name\\":\\"首页\\",\\"item\\":{\\"@id\\":\\"https://friday-go.icu\\",\\"@type\\":\\"WebPage\\"}},{\\"@type\\":\\"ListItem\\",\\"position\\":2,\\"name\\":\\"Tools\\",\\"item\\":{\\"@id\\":\\"https://friday-go.icu/Tools\\",\\"@type\\":\\"WebPage\\"}},{\\"@type\\":\\"ListItem\\",\\"position\\":3,\\"name\\":\\"服务器进程日志分析：从头皮发麻到AI解救\\",\\"item\\":{\\"@id\\":\\"https://friday-go.icu/Tools/服务器进程日志分析：从头皮发麻到AI解救\\",\\"@type\\":\\"Article\\"}}]}"]]},"headers":[],"relativePath":"Tools/服务器进程日志分析：从头皮发麻到AI解救.md","filePath":"Tools/服务器进程日志分析：从头皮发麻到AI解救.md","lastUpdated":1766721617000}'),e={name:"Tools/服务器进程日志分析：从头皮发麻到AI解救.md"};function l(p,s,h,k,r,o){return a(),n("div",{"data-pagefind-body":!0,"data-pagefind-meta":"date:1766747400000"},s[0]||(s[0]=[t(`<h1 id="服务器进程日志分析-从头皮发麻到ai解救" tabindex="-1">服务器进程日志分析：从头皮发麻到AI解救 <a class="header-anchor" href="#服务器进程日志分析-从头皮发麻到ai解救" aria-label="Permalink to &quot;服务器进程日志分析：从头皮发麻到AI解救&quot;">​</a></h1><h2 id="写在前面" tabindex="-1">写在前面 <a class="header-anchor" href="#写在前面" aria-label="Permalink to &quot;写在前面&quot;">​</a></h2><p>最近在维护一台老的 <strong>Web服务器</strong>，每次查看进程的时候，<code>ps aux</code> 一敲，屏幕上刷出来密密麻麻一大堆进程信息，看得我头皮发麻。尤其是那些超长的命令参数，看着就让人心烦。想着总不能每次都这么痛苦吧，于是决定整点东西来解决这个问题。</p><h2 id="解决思路" tabindex="-1">解决思路 <a class="header-anchor" href="#解决思路" aria-label="Permalink to &quot;解决思路&quot;">​</a></h2><p>既然每次都要看这些进程信息，那不如写个脚本，把执行结果记录下来，顺便统计一下执行时间和退出码，方便后续分析。说干就干，我写了下面这个脚本：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">command</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log_file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;command_execution_$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;+%Y%m%d_%H%M%S&quot;).log&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;========================================&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$log_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;时间: $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$log_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;命令: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$log_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;========================================&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$log_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用Bash内置计时器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">start_time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SECONDS</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用临时文件避免子shell问题</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">temp_file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mktemp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">eval</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$temp_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">exit_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\${PIPESTATUS[0]}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将输出追加到日志文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$temp_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$log_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$temp_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$((</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SECONDS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start_time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;========================================&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$log_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;退出码: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$exit_code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$log_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;耗时: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">duration</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}秒&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$log_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><p>这个脚本的功能很简单：把任意命令的执行过程记录下来，包括执行时间、命令本身、完整输出、退出码和耗时。一目了然，该有的信息都有了。</p><h2 id="实战使用" tabindex="-1">实战使用 <a class="header-anchor" href="#实战使用" aria-label="Permalink to &quot;实战使用&quot;">​</a></h2><p>把脚本往服务器上一丢，起个好记的名字，比如 <code>命令执行监控.sh</code>，然后运行一下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aux</span></span></code></pre></div><p>执行完毕后，脚本会自动生成一个带时间戳的日志文件，打开一看，格式整整齐齐：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>========================================</span></span>
<span class="line"><span>时间: 2025年12月26日 星期五 11时10分09秒 CST</span></span>
<span class="line"><span>命令: ps aux</span></span>
<span class="line"><span>========================================</span></span>
<span class="line"><span>USER               PID  %CPU %MEM      VSZ    RSS   TT  STAT STARTED      TIME COMMAND</span></span>
<span class="line"><span>pfinal           47294  18.2  2.0 1494420072 338416   ??  R    11:01上午   0:47.08 /Applications/Trae CN.app/Contents/Frameworks/Trae CN Helper (Renderer).app/Contents/MacOS/Trae CN Helper (Renderer) --type=renderer --user-data-dir=/Users/pfinal/Library/Application Support/Trae CN --standard-schemes=vscode-webview,vscode-file --enable-sandbox --secure-schemes=vscode-webview,vscode-file --cors-schemes=vscode-webview,vscode-file --fetch-schemes=vscode-webview,vscode-file --service-worker-schemes=vscode-webview --code-cache-schemes=vscode-webview,vscode-file --app-path=/Applications/Trae CN.app/Contents/Resources/app --enable-sandbox --enable-blink-features=HighlightAPI --js-flags=--max-old-space-size=8192 --disable-blink-features=FontMatchingCTMigration,StandardizedBrowserZoom, --lang=zh-CN --num-raster-threads=4 --enable-zero-copy --enable-gpu-memory-buffer-compositor-resources --enable-main-frame-before-activation --renderer-client-id=8 --time-ticks-at-unix-epoch=-1763549045983093 --launch-time-ticks=3169034948987 --shared-files --field-trial-handle=1718379636,r,1980764242391010435,4761999176824767603,262144 --enable-features=DocumentPolicyIncludeJSCallStacksInCrashReports,EarlyEstablishGpuChannel,EstablishGpuChannelAsync,PdfUseShowSaveFilePicker,ScreenCaptureKitPickerScreen,ScreenCaptureKitStreamPickerSonoma --disable-features=CalculateNativeWinOcclusion,FontationsLinuxSystemFonts,MacWebContentsOcclusion,ScreenAIOCREnabled,SpareRendererForSitePerProcess,TimeoutHangingVideoCaptureStarts --variations-seed-version --vscode-window-config=vscode:8765d1cc-a06f-493a-a7f5-1893d3c1f3a0 --seatbelt-client=92</span></span>
<span class="line"><span>_windowserver      158  12.5  0.5 44512404  82920   ??  Ss   191125  3232:13.57 /System/Library/PrivateFrameworks/SkyLight.framework/Resources/WindowServer -daemon</span></span>
<span class="line"><span>pfinal           35223  12.5 17.2 8634410808 2880396   ??  Ss   161225  2030:45.83 /Applications/OrbStack.app/Contents/Frameworks/OrbStack Helper.app/Contents/MacOS/OrbStack Helper vmgr -build-id 1763632535 -handoff</span></span>
<span class="line"><span>pfinal           47538  11.0  0.5 1492622204  85000   ??  S    11:01上午   0:30.20 /Applications/Trae CN.app/Contents/Frameworks/Trae CN Helper (Plugin).app/Contents/MacOS/Trae CN Helper (Plugin) --type=utility --utility-sub-type=node.mojom.NodeService --lang=zh-CN --service-sandbox-type=none --dns-result-order=ipv4first --experimental-network-inspection --inspect-port=0 --vscode-crash-reporter-process-type=extensionHost --user-data-dir=/Users/pfinal/Library/Application Support/Trae CN --standard-schemes=vscode-webview,vscode-file --enable-sandbox --secure-schemes=vscode-webview,vscode-file --cors-schemes=vscode-webview,vscode-file --fetch-schemes=vscode-webview,vscode-file --service-worker-schemes=vscode-webview --code-cache-schemes=vscode-webview,vscode-file --shared-files --field-trial-handle=1718379636,r,1980764242391010435,4761999176824767603,262144 --enable-features=DocumentPolicyIncludeJSCallStacksInCrashReports,EarlyEstablishGpuChannel,EstablishGpuChannelAsync,PdfUseShowSaveFilePicker,ScreenCaptureKitPickerScreen,ScreenCaptureKitStreamPickerSonoma --disable-features=CalculateNativeWinOcclusion,FontationsLinuxSystemFonts,MacWebContentsOcclusion,ScreenAIOCREnabled,SpareRendererForSitePerProcess,TimeoutHangingVideoCaptureStarts --variations-seed-version</span></span>
<span class="line"><span>pfinal           47288   9.6  0.4 67993920  65248   ??  S    11:01上午   0:09.56 /Applications/Trae CN.app/Contents/Frameworks/Trae CN Helper (GPU).app/Contents/MacOS/Trae CN Helper (GPU) --type=gpu-process --user-data-dir=/Users/pfinal/Library/Application Support/Trae CN --gpu-preferences=UAAAAAAAAAAgAAAEAAAAAAAAAAAAAAAAAABgAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA --shared-files --field-trial-handle=1718379636,r,1980764242391010435,4761999176824767603,262144 --enable-features=DocumentPolicyIncludeJSCallStacksInCrashReports,EarlyEstablishGpuChannel,EstablishGpuChannelAsync,PdfUseShowSaveFilePicker,ScreenCaptureKitPickerScreen,ScreenCaptureKitStreamPickerSonoma --disable-features=CalculateNativeWinOcclusion,FontationsLinuxSystemFonts,MacWebContentsOcclusion,ScreenAIOCREnabled,SpareRendererForSitePerProcess,TimeoutHangingVideoCaptureStarts --variations-seed-version --seatbelt-client=33</span></span>
<span class="line"><span></span></span>
<span class="line"><span>............</span></span>
<span class="line"><span></span></span>
<span class="line"><span>========================================</span></span>
<span class="line"><span>退出码: 0</span></span>
<span class="line"><span>耗时: 0秒</span></span></code></pre></div><h2 id="问题又来了" tabindex="-1">问题又来了 <a class="header-anchor" href="#问题又来了" aria-label="Permalink to &quot;问题又来了&quot;">​</a></h2><p>好了，现在日志是有了，也规整了。但问题是，这玩意儿看起来还是密密麻麻一大片啊！那些超长的命令参数，各种 CPU、内存占用数据，进程状态...看着看着又开始头疼，瞬间没有分析的心情了。</p><h2 id="服务器卡顿-来套组合拳" tabindex="-1">服务器卡顿？来套组合拳 <a class="header-anchor" href="#服务器卡顿-来套组合拳" aria-label="Permalink to &quot;服务器卡顿？来套组合拳&quot;">​</a></h2><p>说到服务器卡顿，光看进程可不够。遇到服务器响应慢的时候，我一般会用一套组合拳来排查问题。配合前面那个脚本，把这些命令的输出都记录下来，然后统一丢给 AI 分析，简直不要太爽。</p><h3 id="_1-看看资源占用情况" tabindex="-1">1. 看看资源占用情况 <a class="header-anchor" href="#_1-看看资源占用情况" aria-label="Permalink to &quot;1. 看看资源占用情况&quot;">​</a></h3><p>首先用 <code>top</code> 或者 <code>htop</code> 实时看看资源使用情况，哪个进程在吃CPU，哪个进程在吃内存：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;top -b -n 1&quot;</span></span></code></pre></div><p>这个命令会抓取一次快照，不用盯着屏幕刷新。记录下来慢慢看，香！</p><h3 id="_2-看看网络连接" tabindex="-1">2. 看看网络连接 <a class="header-anchor" href="#_2-看看网络连接" aria-label="Permalink to &quot;2. 看看网络连接&quot;">​</a></h3><p>服务器卡顿，很多时候是网络连接出了问题。用 <code>netstat</code> 或者 <code>ss</code> 看看当前有多少连接：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;netstat -antp&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或者用更现代的 ss 命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ss -antp&quot;</span></span></code></pre></div><p>看看有没有大量的 <code>TIME_WAIT</code> 或者 <code>CLOSE_WAIT</code> 状态的连接，有时候就是这些玩意儿把服务器拖慢的。</p><h3 id="_3-检查磁盘空间" tabindex="-1">3. 检查磁盘空间 <a class="header-anchor" href="#_3-检查磁盘空间" aria-label="Permalink to &quot;3. 检查磁盘空间&quot;">​</a></h3><p>磁盘满了也会导致各种奇怪的问题，用 <code>df</code> 看看磁盘使用情况：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;df -h&quot;</span></span></code></pre></div><p>如果某个分区已经用了 100%，那八成就是它的锅。</p><h3 id="_4-看看内存使用" tabindex="-1">4. 看看内存使用 <a class="header-anchor" href="#_4-看看内存使用" aria-label="Permalink to &quot;4. 看看内存使用&quot;">​</a></h3><p>内存不够用的时候，系统就会开始疯狂 swap，卡得不行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;free -m&quot;</span></span></code></pre></div><p>看看 swap 用了多少，如果 swap 用得很高，那就该考虑加内存或者优化程序了。</p><h3 id="_5-检查磁盘-io" tabindex="-1">5. 检查磁盘 IO <a class="header-anchor" href="#_5-检查磁盘-io" aria-label="Permalink to &quot;5. 检查磁盘 IO&quot;">​</a></h3><p>有时候服务器卡，是因为磁盘 IO 太高。用 <code>iostat</code> 看看：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;iostat -x 1 5&quot;</span></span></code></pre></div><p>这会每秒输出一次，连续输出 5 次。看看 <code>%util</code> 这一列，如果接近 100%，磁盘 IO 就是瓶颈了。</p><h3 id="_6-看看哪些文件被打开了" tabindex="-1">6. 看看哪些文件被打开了 <a class="header-anchor" href="#_6-看看哪些文件被打开了" aria-label="Permalink to &quot;6. 看看哪些文件被打开了&quot;">​</a></h3><p>有时候程序会打开大量文件句柄，用 <code>lsof</code> 可以看看：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;lsof -nP | wc -l&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或者看看某个进程打开了哪些文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;lsof -p [PID]&quot;</span></span></code></pre></div><p>如果打开的文件数量超级多，可能就是文件句柄泄漏了。</p><h3 id="_7-看看系统日志" tabindex="-1">7. 看看系统日志 <a class="header-anchor" href="#_7-看看系统日志" aria-label="Permalink to &quot;7. 看看系统日志&quot;">​</a></h3><p>系统日志里经常藏着各种线索，用 <code>dmesg</code> 看看内核日志：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;dmesg -T | tail -100&quot;</span></span></code></pre></div><p>有时候会看到 OOM（Out of Memory）之类的错误信息，一看就知道问题在哪。</p><h3 id="_8-看看-web-服务器的错误日志" tabindex="-1">8. 看看 Web 服务器的错误日志 <a class="header-anchor" href="#_8-看看-web-服务器的错误日志" aria-label="Permalink to &quot;8. 看看 Web 服务器的错误日志&quot;">​</a></h3><p>如果是 Nginx 或者 Apache，直接看错误日志：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tail -n 200 /var/log/nginx/error.log&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或者</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tail -n 200 /var/log/apache2/error.log&quot;</span></span></code></pre></div><p>日志里的报错信息往往最直接，能快速定位问题。</p><h3 id="_9-看看-tcp-连接统计" tabindex="-1">9. 看看 TCP 连接统计 <a class="header-anchor" href="#_9-看看-tcp-连接统计" aria-label="Permalink to &quot;9. 看看 TCP 连接统计&quot;">​</a></h3><p>想知道有多少连接处于各种状态，可以用这个：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;netstat -an | awk &#39;/^tcp/ {print </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">6}&#39; | sort | uniq -c&quot;</span></span></code></pre></div><p>这会统计各种 TCP 连接状态的数量，一目了然。</p><h3 id="_10-看看虚拟内存统计" tabindex="-1">10. 看看虚拟内存统计 <a class="header-anchor" href="#_10-看看虚拟内存统计" aria-label="Permalink to &quot;10. 看看虚拟内存统计&quot;">​</a></h3><p>用 <code>vmstat</code> 可以看到系统的整体运行状态：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./命令执行监控.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;vmstat 1 5&quot;</span></span></code></pre></div><p>这会每秒输出一次，连续输出 5 次。可以看到 CPU、内存、IO 等各方面的统计数据。</p><h2 id="一键收集-批量分析" tabindex="-1">一键收集，批量分析 <a class="header-anchor" href="#一键收集-批量分析" aria-label="Permalink to &quot;一键收集，批量分析&quot;">​</a></h2><p>有了前面这个脚本，我甚至写了个更狠的，把这些命令一次性全部执行并记录下来：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">timestamp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;+%Y%m%d_%H%M%S&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">report_dir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;server_analysis_\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">timestamp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;开始收集服务器信息...&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 定义监控脚本路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">monitor_script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./命令执行监控.sh&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进程信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$monitor_script </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ps aux --sort=-%cpu | head -20&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command_execution_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/01_top_cpu_processes.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CPU和内存</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$monitor_script </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;top -b -n 1&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command_execution_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/02_top_snapshot.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 网络连接</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$monitor_script </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ss -antp&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command_execution_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/03_network_connections.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 磁盘使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$monitor_script </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;df -h&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command_execution_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/04_disk_usage.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 内存使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$monitor_script </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;free -m&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command_execution_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/05_memory_usage.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># IO 统计</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$monitor_script </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;iostat -x 1 5&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command_execution_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/06_io_stats.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 系统日志</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$monitor_script </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dmesg -T | tail -100&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command_execution_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/07_kernel_logs.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># TCP 连接统计</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$monitor_script </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;netstat -an | awk &#39;/^tcp/ {print </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">6}&#39; | sort | uniq -c&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command_execution_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/08_tcp_stats.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 虚拟内存统计</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$monitor_script </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vmstat 1 5&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> command_execution_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/09_vmstat.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;信息收集完成！所有日志保存在: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$report_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;现在可以把整个目录打包发给 AI 分析了！&quot;</span></span></code></pre></div><p>执行一次，所有数据全部到手，整整齐齐地放在一个目录里。然后把这个目录打个包，统统丢给 AI，让它帮我综合分析。</p><h2 id="ai-时代的解法" tabindex="-1">AI 时代的解法 <a class="header-anchor" href="#ai-时代的解法" aria-label="Permalink to &quot;AI 时代的解法&quot;">​</a></h2><p>不过还好，现在是 <strong>AI 时代</strong>！这种时候就该让 AI 大显身手了。我直接把这些日志文件往 <strong>ChatGPT</strong> 或者 <strong>Claude</strong> 里面一丢，让它帮我分析。</p><p>结果呢？AI 把这堆东西分析得是头头是道：</p><ul><li>哪些进程占用资源最多</li><li>网络连接是否存在异常</li><li>磁盘和内存使用情况如何</li><li>IO 是否存在瓶颈</li><li>系统日志里有没有关键错误</li><li>还能给出针对性的优化建议</li></ul><p>原本需要一个个命令去看，一个个数据去对比分析的工作，现在变成了喝杯咖啡的功夫就能搞定的事儿。AI 甚至还能告诉你：&quot;你的服务器有 327 个 TIME_WAIT 连接，建议调整一下内核参数...&quot;，专业得不行。</p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>从最开始看到进程列表就头皮发麻，到现在轻轻松松让 AI 帮忙分析，这个流程可以说是相当舒服了。脚本负责记录，命令负责采集，AI 负责分析，我只需要坐等结果就行。</p><p>服务器卡顿不可怕，可怕的是不知道从哪下手。有了这套组合拳，再配合 AI 的分析能力，什么 <strong>进程分析</strong>、<strong>性能瓶颈</strong>、<strong>资源占用</strong> 都不在话下。</p><p>这就是工具的力量，这就是 <strong>AI 时代</strong>的便利。再也不用担心服务器上那一大堆进程信息了，香得很！</p><hr><blockquote><p>代码是我的语言，终端是我的世界。</p><p><strong>PFinalClub</strong> · 写于上海某个加班的深夜<br> 一个用代码偷懒的专业户 | 公众号：PFinalClub<br> 2025.12.26</p></blockquote>`,71)]))}const F=i(e,[["render",l]]);export{c as __pageData,F as default};
