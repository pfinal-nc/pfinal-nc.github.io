import{_ as i,c as a,o as n,ab as h}from"./chunks/framework.BHnvhWw7.js";const d=JSON.parse('{"title":"è®©æœ¬åœ°å¤§æ¨¡å‹åƒ OpenAI ä¸€æ ·æ”¯æŒ Function Calling PHP å¼‚æ­¥å®ç°å®æˆ˜","description":"å®æˆ˜æ•™ç¨‹ï¼šå¦‚ä½•è®©æœ¬åœ°è¿è¡Œçš„ Qwen3ã€Deepseek-Coder-V3ã€GLM4-Chat ç­‰æ¨¡å‹åƒ OpenAI GPT-4 ä¸€æ ·æ”¯æŒåŸç”Ÿ Function Callingã€‚é€šè¿‡ pfinal-asyncio å¼‚æ­¥æ¡†æ¶å®ç°å®Œå…¨å…¼å®¹ OpenAI æ¥å£è§„èŒƒçš„å·¥å…·è°ƒç”¨ï¼Œå¹¶å‘æ‰§è¡Œæ€§èƒ½æå‡ 200%-500%ï¼Œé›¶ API è´¹ç”¨ï¼Œæ•°æ®å®Œå…¨æœ¬åœ°åŒ–ã€‚","frontmatter":{"title":"è®©æœ¬åœ°å¤§æ¨¡å‹åƒ OpenAI ä¸€æ ·æ”¯æŒ Function Calling PHP å¼‚æ­¥å®ç°å®æˆ˜","date":"2025-11-19T15:30:00.000Z","author":"PFinalå—ä¸","tags":["php","AI","Function Calling","å¼‚æ­¥ç¼–ç¨‹","å¤§è¯­è¨€æ¨¡å‹","Qwen3","Deepseek","GLM4"],"keywords":"PHPå¼‚æ­¥ç¼–ç¨‹, Function Calling, Tool Calls, pfinal-asyncio, Qwen3, Deepseek, GLM4, OpenAIå…¼å®¹, AI Agent, æœ¬åœ°å¤§æ¨¡å‹, PHPåç¨‹, å¼‚æ­¥å¹¶å‘, Ollama, å·¥å…·è°ƒç”¨, PHP AIå¼€å‘","description":"å®æˆ˜æ•™ç¨‹ï¼šå¦‚ä½•è®©æœ¬åœ°è¿è¡Œçš„ Qwen3ã€Deepseek-Coder-V3ã€GLM4-Chat ç­‰æ¨¡å‹åƒ OpenAI GPT-4 ä¸€æ ·æ”¯æŒåŸç”Ÿ Function Callingã€‚é€šè¿‡ pfinal-asyncio å¼‚æ­¥æ¡†æ¶å®ç°å®Œå…¨å…¼å®¹ OpenAI æ¥å£è§„èŒƒçš„å·¥å…·è°ƒç”¨ï¼Œå¹¶å‘æ‰§è¡Œæ€§èƒ½æå‡ 200%-500%ï¼Œé›¶ API è´¹ç”¨ï¼Œæ•°æ®å®Œå…¨æœ¬åœ°åŒ–ã€‚","recommend":"åç«¯å·¥ç¨‹","head":[["link",{"rel":"canonical","href":"https://friday-go.icu/dev/backend/php/è®© Qwen3 å’Œ Deepseek æ‡‚ Function Calling-PHPç¯‡-opt"}],["meta",{"name":"keywords","content":"PHPå¼‚æ­¥ç¼–ç¨‹, Function Calling, Tool Calls, pfinal-asyncio, Qwen3, Deepseek, GLM4, OpenAIå…¼å®¹, AI Agent, æœ¬åœ°å¤§æ¨¡å‹, PHPåç¨‹, å¼‚æ­¥å¹¶å‘, Ollama, å·¥å…·è°ƒç”¨, PHP AIå¼€å‘, PFinalClub, Golangæ•™ç¨‹, Goåç«¯å¼€å‘, Goå¾®æœåŠ¡, PHP, Python, æŠ€æœ¯åšå®¢"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"TechArticle\\",\\"headline\\":\\"è®©æœ¬åœ°å¤§æ¨¡å‹åƒ OpenAI ä¸€æ ·æ”¯æŒ Function Calling PHP å¼‚æ­¥å®ç°å®æˆ˜\\",\\"url\\":\\"https://friday-go.icu/dev/backend/php/è®© Qwen3 å’Œ Deepseek æ‡‚ Function Calling-PHPç¯‡-opt\\",\\"datePublished\\":\\"2025-11-19T15:30:00.000Z\\",\\"dateModified\\":1766143110000,\\"author\\":{\\"@type\\":\\"Person\\",\\"name\\":\\"PFinalå—ä¸\\",\\"url\\":\\"https://friday-go.icu/about\\"},\\"publisher\\":{\\"@type\\":\\"Organization\\",\\"name\\":\\"PFinalClub\\",\\"logo\\":{\\"@type\\":\\"ImageObject\\",\\"url\\":\\"https://friday-go.icu/logo.png\\"}},\\"description\\":\\"å®æˆ˜æ•™ç¨‹ï¼šå¦‚ä½•è®©æœ¬åœ°è¿è¡Œçš„ Qwen3ã€Deepseek-Coder-V3ã€GLM4-Chat ç­‰æ¨¡å‹åƒ OpenAI GPT-4 ä¸€æ ·æ”¯æŒåŸç”Ÿ Function Callingã€‚é€šè¿‡ pfinal-asyncio å¼‚æ­¥æ¡†æ¶å®ç°å®Œå…¨å…¼å®¹ OpenAI æ¥å£è§„èŒƒçš„å·¥å…·è°ƒç”¨ï¼Œå¹¶å‘æ‰§è¡Œæ€§èƒ½æå‡ 200%-500%ï¼Œé›¶ API è´¹ç”¨ï¼Œæ•°æ®å®Œå…¨æœ¬åœ°åŒ–ã€‚\\",\\"inLanguage\\":\\"zh-CN\\",\\"mainEntityOfPage\\":{\\"@type\\":\\"WebPage\\",\\"@id\\":\\"https://friday-go.icu/dev/backend/php/è®© Qwen3 å’Œ Deepseek æ‡‚ Function Calling-PHPç¯‡-opt\\"},\\"keywords\\":\\"PHPå¼‚æ­¥ç¼–ç¨‹, Function Calling, Tool Calls, pfinal-asyncio, Qwen3, Deepseek, GLM4, OpenAIå…¼å®¹, AI Agent, æœ¬åœ°å¤§æ¨¡å‹, PHPåç¨‹, å¼‚æ­¥å¹¶å‘, Ollama, å·¥å…·è°ƒç”¨, PHP AIå¼€å‘\\"}"]]},"headers":[],"relativePath":"dev/backend/php/è®© Qwen3 å’Œ Deepseek æ‡‚ Function Calling-PHPç¯‡-opt.md","filePath":"dev/backend/php/è®© Qwen3 å’Œ Deepseek æ‡‚ Function Calling-PHPç¯‡-opt.md","lastUpdated":1766143110000}'),l={name:"dev/backend/php/è®© Qwen3 å’Œ Deepseek æ‡‚ Function Calling-PHPç¯‡-opt.md"};function t(k,s,p,e,E,r){return n(),a("div",{"data-pagefind-body":!0,"data-pagefind-meta":"date:1763566200000"},s[0]||(s[0]=[h(`<h1 id="è®©æœ¬åœ°å¤§æ¨¡å‹åƒ-openai-ä¸€æ ·æ”¯æŒ-function-calling-php-å¼‚æ­¥å®ç°å®æˆ˜" tabindex="-1">è®©æœ¬åœ°å¤§æ¨¡å‹åƒ OpenAI ä¸€æ ·æ”¯æŒ Function Callingï¼šPHP å¼‚æ­¥å®ç°å®æˆ˜ <a class="header-anchor" href="#è®©æœ¬åœ°å¤§æ¨¡å‹åƒ-openai-ä¸€æ ·æ”¯æŒ-function-calling-php-å¼‚æ­¥å®ç°å®æˆ˜" aria-label="Permalink to &quot;è®©æœ¬åœ°å¤§æ¨¡å‹åƒ OpenAI ä¸€æ ·æ”¯æŒ Function Callingï¼šPHP å¼‚æ­¥å®ç°å®æˆ˜&quot;">â€‹</a></h1><blockquote><p><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šè®©æœ¬åœ°è¿è¡Œçš„ <strong>Qwen3ã€Deepseek-Coder-V3ã€GLM4-Chat</strong> ç­‰æ¨¡å‹ï¼Œåƒ OpenAI GPT-4 ä¸€æ ·æ”¯æŒåŸç”Ÿçš„ <strong>Function Calling / Tool Calls</strong> èƒ½åŠ›ã€‚é€šè¿‡ <code>pfinal-asyncio</code> å¼‚æ­¥æ¡†æ¶ï¼Œå®ç°å®Œå…¨å…¼å®¹ OpenAI æ¥å£è§„èŒƒçš„å·¥å…·è°ƒç”¨ï¼Œå¹¶å‘æ‰§è¡Œæ€§èƒ½æå‡ 200%-500%ï¼Œ<strong>é›¶ API è´¹ç”¨ï¼Œæ•°æ®å®Œå…¨æœ¬åœ°åŒ–</strong>ã€‚</p></blockquote><hr><h2 id="ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°æ¨¡å‹çš„-function-calling" tabindex="-1">ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°æ¨¡å‹çš„ Function Callingï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°æ¨¡å‹çš„-function-calling" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°æ¨¡å‹çš„ Function Callingï¼Ÿ&quot;">â€‹</a></h2><p>OpenAI çš„ GPT-4 åŸç”Ÿæ”¯æŒ Function Callingï¼Œä½ åªéœ€è¦åœ¨ API è¯·æ±‚ä¸­ä¼ å…¥ <code>tools</code> å‚æ•°ï¼Œæ¨¡å‹å°±èƒ½è‡ªåŠ¨è¯†åˆ«ä½•æ—¶è°ƒç”¨å·¥å…·ã€å¦‚ä½•è§£æå‚æ•°ã€‚ä½†å¯¹äºå¾ˆå¤šåœºæ™¯æ¥è¯´ï¼Œä½¿ç”¨ OpenAI API å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>ğŸ’° <strong>æˆæœ¬é—®é¢˜</strong>ï¼šAPI è°ƒç”¨è´¹ç”¨ä¸è²ï¼Œé«˜é¢‘ä½¿ç”¨æˆæœ¬é«˜</li><li>ğŸ”’ <strong>æ•°æ®éšç§</strong>ï¼šæ•æ„Ÿæ•°æ®éœ€è¦ä¸Šä¼ åˆ°äº‘ç«¯ï¼Œå­˜åœ¨æ³„éœ²é£é™©</li><li>ğŸŒ <strong>ç½‘ç»œä¾èµ–</strong>ï¼šéœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥ï¼Œç¦»çº¿åœºæ™¯æ— æ³•ä½¿ç”¨</li><li>âš¡ <strong>å“åº”å»¶è¿Ÿ</strong>ï¼šç½‘ç»œå¾€è¿”å¢åŠ å»¶è¿Ÿï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</li></ul><p><strong>æœ¬åœ°æ¨¡å‹çš„ä¼˜åŠ¿</strong>ï¼š</p><ul><li>âœ… <strong>é›¶æˆæœ¬</strong>ï¼šå®Œå…¨æœ¬åœ°è¿è¡Œï¼Œæ—  API è´¹ç”¨</li><li>âœ… <strong>æ•°æ®å®‰å…¨</strong>ï¼šæ•°æ®ä¸å‡ºæœ¬åœ°ï¼Œéšç§å®Œå…¨å¯æ§</li><li>âœ… <strong>ç¦»çº¿å¯ç”¨</strong>ï¼šæ— éœ€ç½‘ç»œè¿æ¥ï¼Œéšæ—¶éšåœ°å¯ç”¨</li><li>âœ… <strong>ä½å»¶è¿Ÿ</strong>ï¼šæœ¬åœ°æ¨ç†ï¼Œå“åº”é€Ÿåº¦å¿«</li></ul><p>ä½†é—®é¢˜æ˜¯ï¼šæœ¬åœ°æ¨¡å‹ï¼ˆå¦‚ Qwen3ã€Deepseekã€GLM4ï¼‰è™½ç„¶èƒ½åŠ›å¾ˆå¼ºï¼Œå´ä¸ä¸€å®šå®Œå…¨å…¼å®¹ OpenAI çš„ Function Calling åè®®ã€‚</p><p><strong>å¥½æ¶ˆæ¯æ˜¯</strong>ï¼šé€šè¿‡ Ollama è¿™ç±»æœ¬åœ°éƒ¨ç½²å·¥å…·ï¼Œé…åˆæ­£ç¡®çš„åè®®å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥è®©è¿™äº›æœ¬åœ°æ¨¡å‹<strong>å®Œå…¨åƒ OpenAI ä¸€æ ·å·¥ä½œ</strong>ã€‚è¿™å°±æ˜¯æœ¬æ–‡è¦è§£å†³çš„é—®é¢˜ã€‚</p><hr><h2 id="function-calling-å·¥ä½œåŸç†" tabindex="-1">Function Calling å·¥ä½œåŸç† <a class="header-anchor" href="#function-calling-å·¥ä½œåŸç†" aria-label="Permalink to &quot;Function Calling å·¥ä½œåŸç†&quot;">â€‹</a></h2><p>Function Calling çš„æ ¸å¿ƒæµç¨‹æ˜¯ï¼š</p><ol><li>ä½ å®šä¹‰ä¸€ç»„å·¥å…·ï¼ˆTools Definitionï¼‰ï¼Œç”¨ JSON Schema æè¿°æ¯ä¸ªå·¥å…·çš„åŠŸèƒ½å’Œå‚æ•°</li><li>æ¨¡å‹åœ¨æ¨ç†æ—¶åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·ï¼Œå¦‚æœéœ€è¦ï¼Œè¿”å›ç»“æ„åŒ–çš„ <code>tool_calls</code> æ•°ç»„</li><li>ä½ çš„ä»£ç æ‰§è¡Œè¿™äº›å·¥å…·è°ƒç”¨ï¼ˆè¿™é‡Œæ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼‰</li><li>æŠŠæ‰§è¡Œç»“æœå›ä¼ ç»™æ¨¡å‹</li><li>æ¨¡å‹åŸºäºå·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ</li></ol><p>å¬èµ·æ¥ç®€å•ï¼Œä½†æœ‰ä¸¤ä¸ªæŠ€æœ¯éš¾ç‚¹ï¼š</p><ol><li><strong>åè®®å…¼å®¹æ€§</strong>ï¼šå¦‚ä½•è®©æœ¬åœ°æ¨¡å‹ç†è§£å¹¶è¿”å›ç¬¦åˆ OpenAI è§„èŒƒçš„ <code>tool_calls</code></li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå¦‚ä½•é«˜æ•ˆå¹¶å‘æ‰§è¡Œå¤šä¸ªå·¥å…·è°ƒç”¨</li></ol><hr><h2 id="ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥" tabindex="-1">ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ&quot;">â€‹</a></h2><p>å½“æ¨¡å‹ä¸€æ¬¡æ€§è¦è°ƒç”¨å¤šä¸ªå·¥å…·æ—¶ï¼Œä¼ ç»Ÿçš„ PHP åŒæ­¥æ¨¡å¼ä¼šä¸²è¡Œæ‰§è¡Œï¼š</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¼ ç»ŸåŒæ­¥æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$weather1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_weather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;åŒ—äº¬&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç­‰å¾… 1 ç§’</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$weather2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_weather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ä¸Šæµ·&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å†ç­‰ 1 ç§’  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$price </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_stock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;600519&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å†ç­‰ 1 ç§’</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ€»å…± 3 ç§’ï¼</span></span></code></pre></div><p>è¿™ä¸‰ä¸ªè¯·æ±‚æ˜æ˜å¯ä»¥åŒæ—¶å‘å‡ºå»ï¼Œä¸ºä»€ä¹ˆè¦æ’é˜Ÿï¼Ÿè¿™å°±æ˜¯å¼‚æ­¥çš„ä»·å€¼ã€‚ç”¨ <code>pfinal-asyncio</code> ä¹‹åï¼š</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¼‚æ­¥å¹¶å‘æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> gather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() =&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get_weather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;åŒ—äº¬&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() =&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get_weather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ä¸Šæµ·&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() =&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get_stock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;600519&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ€»å…± 1 ç§’ï¼ˆå–å†³äºæœ€æ…¢çš„é‚£ä¸ªï¼‰</span></span></code></pre></div><p>æ€§èƒ½æå‡å¾ˆæ˜æ˜¾ï¼Œç‰¹åˆ«æ˜¯å·¥å…·æ•°é‡å¤šçš„æ—¶å€™ã€‚ä½†æ›´é‡è¦çš„æ˜¯ï¼Œ<strong>å¼‚æ­¥æ‰§è¡Œè®©æ•´ä¸ª Function Calling æµç¨‹æ›´åŠ é«˜æ•ˆï¼Œæ¥è¿‘ OpenAI çš„ä½“éªŒ</strong>ã€‚</p><hr><h2 id="ç¯å¢ƒå‡†å¤‡" tabindex="-1">ç¯å¢ƒå‡†å¤‡ <a class="header-anchor" href="#ç¯å¢ƒå‡†å¤‡" aria-label="Permalink to &quot;ç¯å¢ƒå‡†å¤‡&quot;">â€‹</a></h2><p>å…ˆè¯´ä¸‹æŠ€æœ¯æ ˆï¼š</p><ul><li>PHP 8.1+ï¼ˆéœ€è¦ Fiber æ”¯æŒï¼‰</li><li><code>pfinal/asyncio</code>ï¼ˆPHP çš„å¼‚æ­¥åç¨‹åº“ï¼Œç±»ä¼¼ Node.js çš„ Promiseï¼‰</li><li>Ollamaï¼ˆæœ¬åœ°éƒ¨ç½²å¤§æ¨¡å‹ï¼Œå…¼å®¹ OpenAI API æ ¼å¼ï¼‰</li></ul><p>å®‰è£…ä¾èµ–ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">composer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> require</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pfinal/asyncio</span></span></code></pre></div><p>ç„¶åç¡®ä¿ Ollama åœ¨æœ¬åœ°è¿è¡Œï¼Œå¹¶ä¸‹è½½æ”¯æŒ Function Calling çš„æ¨¡å‹ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ollama</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> serve</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ”¯æŒçš„æ¨¡å‹ï¼ˆä»»é€‰å…¶ä¸€æˆ–å¤šä¸ªï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ollama</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> qwen3:32b</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # é€šä¹‰åƒé—®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ollama</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deepseek-coder-v3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # Deepseek ä»£ç æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ollama</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> glm-4-chat</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # GLM4 å¯¹è¯æ¨¡å‹</span></span></code></pre></div><p><strong>é‡è¦æç¤º</strong>ï¼šè¿™äº›æ¨¡å‹é€šè¿‡ Ollama éƒ¨ç½²åï¼Œéƒ½æ”¯æŒ OpenAI å…¼å®¹çš„ Function Calling æ¥å£ã€‚ä½ åªéœ€è¦åœ¨è¯·æ±‚ä¸­ä¼ å…¥ <code>tools</code> å‚æ•°ï¼Œæ¨¡å‹å°±èƒ½åƒ GPT-4 ä¸€æ ·è¿”å› <code>tool_calls</code>ã€‚</p><hr><h2 id="æ ¸å¿ƒå®ç°" tabindex="-1">æ ¸å¿ƒå®ç° <a class="header-anchor" href="#æ ¸å¿ƒå®ç°" aria-label="Permalink to &quot;æ ¸å¿ƒå®ç°&quot;">â€‹</a></h2><h3 id="ç¬¬ä¸€æ­¥-å®šä¹‰å·¥å…·-schema-openai-å…¼å®¹æ ¼å¼" tabindex="-1">ç¬¬ä¸€æ­¥ï¼šå®šä¹‰å·¥å…· Schemaï¼ˆOpenAI å…¼å®¹æ ¼å¼ï¼‰ <a class="header-anchor" href="#ç¬¬ä¸€æ­¥-å®šä¹‰å·¥å…·-schema-openai-å…¼å®¹æ ¼å¼" aria-label="Permalink to &quot;ç¬¬ä¸€æ­¥ï¼šå®šä¹‰å·¥å…· Schemaï¼ˆOpenAI å…¼å®¹æ ¼å¼ï¼‰&quot;">â€‹</a></h3><p>è¦è®©æœ¬åœ°æ¨¡å‹åƒ OpenAI ä¸€æ ·å·¥ä½œï¼Œç¬¬ä¸€æ­¥å°±æ˜¯å®šä¹‰å·¥å…·ã€‚è¿™é‡Œ<strong>å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ OpenAI çš„ JSON Schema æ ¼å¼</strong>æ¥å†™ï¼Œå› ä¸º Qwen3ã€Deepseekã€GLM4 è¿™äº›æ¨¡å‹éƒ½æ˜¯æŒ‰ç…§è¿™ä¸ªæ ‡å‡†æ¥ç†è§£å·¥å…·çš„ã€‚</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PfinalClub\\Asyncio\\Http\\AsyncHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PfinalClub\\Asyncio\\</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å·¥å…·å®šä¹‰ï¼ˆå¿…é¡»ç¬¦åˆ OpenAI è§„èŒƒï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TOOLS_SCHEMA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;function&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;function&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;name&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;get_weather_metrics&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;description&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯ï¼ˆæ¸©åº¦ã€å¤©æ°”çŠ¶å†µï¼‰&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;parameters&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;properties&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;location&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;description&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;åŸå¸‚åç§°ï¼Œå¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;required&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;location&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;function&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;function&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;name&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;fetch_market_data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;description&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;è·å–è‚¡ç¥¨æˆ–åŠ å¯†è´§å¸çš„å®æ—¶ä»·æ ¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;parameters&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;properties&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;symbol&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;description&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;äº¤æ˜“ä»£ç ï¼Œå¦‚ï¼š600519.SH æˆ– BTC-USDT&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    ],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;region&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;enum&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;US&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;HK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CRYPTO&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;description&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;å¸‚åœºåŒºåŸŸï¼Œé»˜è®¤ CN&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;required&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;symbol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><p>è¿™é‡Œæœ‰ä¸ªå°æŠ€å·§ï¼š<code>description</code> å­—æ®µä¸€å®šè¦å†™æ¸…æ¥šï¼Œæ¨¡å‹å°±æ˜¯é è¿™ä¸ªæ¥åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è°ƒç”¨å“ªä¸ªå·¥å…·çš„ã€‚æˆ‘ä¸€å¼€å§‹å†™å¾—æ¯”è¾ƒæ¨¡ç³Šï¼Œç»“æœæ¨¡å‹ç»å¸¸è°ƒç”¨é”™å·¥å…·ã€‚</p><h3 id="ç¬¬äºŒæ­¥-å®ç°ä¸šåŠ¡å‡½æ•°" tabindex="-1">ç¬¬äºŒæ­¥ï¼šå®ç°ä¸šåŠ¡å‡½æ•° <a class="header-anchor" href="#ç¬¬äºŒæ­¥-å®ç°ä¸šåŠ¡å‡½æ•°" aria-label="Permalink to &quot;ç¬¬äºŒæ­¥ï¼šå®ç°ä¸šåŠ¡å‡½æ•°&quot;">â€‹</a></h3><p>è¿™äº›å°±æ˜¯çœŸæ­£å¹²æ´»çš„å‡½æ•°äº†ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œåº”è¯¥æ˜¯çœŸå®çš„ API è°ƒç”¨æˆ–æ•°æ®åº“æŸ¥è¯¢ã€‚</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * è·å–å¤©æ°”æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_weather_metrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $location)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å®é™…é¡¹ç›®ä¸­è¿™é‡Œåº”è¯¥æ˜¯å¼‚æ­¥ HTTP è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // $http = new AsyncHttpClient();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // $response = await($http-&gt;get(&quot;https://api.weather.com/...&quot;));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ¨¡æ‹Ÿè¿”å›</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> json_encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;location&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $location,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;temperature&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 22.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;condition&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;å¤šäº‘&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;timestamp&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON_UNESCAPED_UNICODE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * è·å–è¡Œæƒ…æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch_market_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $symbol, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $region </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;CN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $price </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mt_rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> json_encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;symbol&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $symbol,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;region&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $region,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;price&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $price,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;currency&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $region </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;US&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;USD&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;CNY&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON_UNESCAPED_UNICODE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="ç¬¬ä¸‰æ­¥-æ ¸å¿ƒè°ƒåº¦å™¨-é‡ç‚¹" tabindex="-1">ç¬¬ä¸‰æ­¥ï¼šæ ¸å¿ƒè°ƒåº¦å™¨ï¼ˆé‡ç‚¹ï¼‰ <a class="header-anchor" href="#ç¬¬ä¸‰æ­¥-æ ¸å¿ƒè°ƒåº¦å™¨-é‡ç‚¹" aria-label="Permalink to &quot;ç¬¬ä¸‰æ­¥ï¼šæ ¸å¿ƒè°ƒåº¦å™¨ï¼ˆé‡ç‚¹ï¼‰&quot;">â€‹</a></h3><p>è¿™æ˜¯æœ€å…³é”®çš„éƒ¨åˆ†ã€‚å½“æ¨¡å‹è¿”å› <code>tool_calls</code> æ•°ç»„æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ol><li>è§£ææ¯ä¸ªå·¥å…·è°ƒç”¨çš„å‚æ•°</li><li>æŠŠå®ƒä»¬åŒ…è£…æˆå¼‚æ­¥ä»»åŠ¡</li><li>å¹¶å‘æ‰§è¡Œ</li><li>ç­‰å¾…æ‰€æœ‰ç»“æœ</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å¹¶å‘æ‰§è¡Œå·¥å…·è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> array</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> $toolCalls æ¨¡å‹è¿”å›çš„ tool_calls</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> array</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> æ‰§è¡Œç»“æœï¼Œé¡ºåºä¸è¾“å…¥ä¸€è‡´</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dispatch_tool_calls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $toolCalls)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $tasks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;æ£€æµ‹åˆ° &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($toolCalls) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot; ä¸ªå·¥å…·è°ƒç”¨ï¼Œå¼€å§‹å¹¶å‘æ‰§è¡Œ...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($toolCalls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $call) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $functionName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;function&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $arguments </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> json_decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;function&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;arguments&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // JSON è§£æå¤±è´¥çš„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json_last_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON_ERROR_NONE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            $tasks[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() =&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json_encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;error&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;å‚æ•°è§£æå¤±è´¥&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æŠŠæ¯ä¸ªå·¥å…·è°ƒç”¨åŒ…è£…æˆå¼‚æ­¥ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $tasks[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($functionName, $arguments) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($functionName) {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &#39;get_weather_metrics&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_weather_metrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($arguments[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;location&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &#39;fetch_market_data&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch_market_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        $arguments[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;symbol&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        $arguments[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;region&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;CN&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    ),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> json_encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;error&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;å·¥å…· {</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$functionName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">} æœªå®ç°&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\Throwable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $e) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // å•ä¸ªå·¥å…·å¤±è´¥ä¸åº”è¯¥å½±å“å…¶ä»–å·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> json_encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;error&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // gather ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œç±»ä¼¼ Promise.all</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> gather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$tasks);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™é‡Œç”¨äº† PHP 8 çš„ <code>match</code> è¡¨è¾¾å¼ï¼Œæ¯” <code>switch</code> ç®€æ´å¾ˆå¤šã€‚å¦å¤–ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½åŒ…äº† <code>try-catch</code>ï¼Œè¿™æ ·å³ä½¿æŸä¸ªå·¥å…·æŒ‚äº†ï¼Œå…¶ä»–å·¥å…·è¿˜èƒ½æ­£å¸¸æ‰§è¡Œã€‚</p><h3 id="ç¬¬å››æ­¥-å®Œæ•´æµç¨‹" tabindex="-1">ç¬¬å››æ­¥ï¼šå®Œæ•´æµç¨‹ <a class="header-anchor" href="#ç¬¬å››æ­¥-å®Œæ•´æµç¨‹" aria-label="Permalink to &quot;ç¬¬å››æ­¥ï¼šå®Œæ•´æµç¨‹&quot;">â€‹</a></h3><p>æœ€åï¼ŒæŠŠæ‰€æœ‰ç¯èŠ‚ä¸²èµ·æ¥ã€‚æ•´ä¸ªæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ç”¨æˆ·æé—® â†’ å‘é€ç»™æ¨¡å‹</li><li>æ¨¡å‹åˆ†æ â†’ è¿”å› <code>tool_calls</code></li><li>å¹¶å‘æ‰§è¡Œå·¥å…· â†’ è·å–ç»“æœ</li><li>æŠŠç»“æœå¡å›å¯¹è¯å†å² â†’ å†æ¬¡è¯·æ±‚æ¨¡å‹</li><li>æ¨¡å‹ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ</li></ol><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $httpClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AsyncHttpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;timeout&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $apiUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:11434/api/chat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ”¯æŒçš„æ¨¡å‹ï¼šqwen2.5:32bã€deepseek-coder-v3ã€glm-4-chat</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ‰€æœ‰æ¨¡å‹éƒ½é€šè¿‡ OpenAI å…¼å®¹æ¥å£æ”¯æŒ Function Calling</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $modelName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;qwen2.5:32b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆå§‹åŒ–å¯¹è¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·è·å–å®æ—¶æ•°æ®ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,   </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;å¸®æˆ‘æŸ¥ä¸€ä¸‹èŒ…å°(600519.SH)çš„è‚¡ä»·ï¼Œè¿˜æœ‰åŒ—äº¬ç°åœ¨çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;æ­£åœ¨è¯·æ±‚æ¨¡å‹ï¼ˆä½¿ç”¨ OpenAI å…¼å®¹æ¥å£ï¼‰...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç¬¬ä¸€è½®ï¼šè®©æ¨¡å‹å†³å®šè°ƒç”¨å“ªäº›å·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å…³é”®ï¼šä¼ å…¥ tools å‚æ•°ï¼Œæœ¬åœ°æ¨¡å‹ï¼ˆQwen3/Deepseek/GLM4ï¼‰ä¼šåƒ GPT-4 ä¸€æ ·è¿”å› tool_calls</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $httpClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($apiUrl, [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;Content-Type&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;application/json&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json_encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;model&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $modelName,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¯ä»¥æ˜¯ qwen2.5:32bã€deepseek-coder-v3 æˆ– glm-4-chat</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;messages&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $messages,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;tools&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TOOLS_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// OpenAI æ ‡å‡†æ ¼å¼çš„å·¥å…·å®šä¹‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;stream&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;options&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;temperature&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é™ä½éšæœºæ€§ï¼Œæé«˜å·¥å…·è°ƒç”¨çš„ç¨³å®šæ€§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $result[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $toolCalls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $message[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tool_calls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¦‚æœæ¨¡å‹ä¸è°ƒç”¨å·¥å…·ï¼Œç›´æ¥è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">empty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($toolCalls)) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;æ¨¡å‹å›å¤ï¼š&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($message[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;æ— å†…å®¹&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç¬¬äºŒè½®ï¼šå¹¶å‘æ‰§è¡Œå·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ³¨æ„ï¼šå¿…é¡»å…ˆæŠŠæ¨¡å‹çš„ assistant æ¶ˆæ¯åŠ å…¥å†å²ï¼Œè¿™æ˜¯åè®®è¦æ±‚çš„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $messages[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $message;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $toolOutputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dispatch_tool_calls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($toolCalls);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç¬¬ä¸‰è½®ï¼šæŠŠå·¥å…·ç»“æœå¡å›å¯¹è¯å†å²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($toolCalls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $call) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $messages[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;role&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tool&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;tool_call_id&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿™ä¸ª ID å¾ˆé‡è¦ï¼Œæ¨¡å‹é å®ƒå…³è”ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;name&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;function&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;content&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $toolOutputs[$index]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ç¬¬å››è½®ï¼šè·å–æœ€ç»ˆç­”æ¡ˆ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;æ­£åœ¨ç”Ÿæˆæœ€ç»ˆå›å¤...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $finalResponse </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $httpClient</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($apiUrl, [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;Content-Type&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;application/json&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">json_encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;model&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $modelName,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;messages&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $messages,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;stream&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $finalContent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $finalResponse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> str_repeat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;-&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;æœ€ç»ˆç­”æ¡ˆï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> trim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($finalContent) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> str_repeat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;-&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>æœ‰å‡ ä¸ªå…³é”®ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ol><li><strong><code>tool_call_id</code> å¿…é¡»æ­£ç¡®</strong>ï¼šæ¨¡å‹è¿”å›çš„æ¯ä¸ª <code>tool_calls</code> éƒ½æœ‰ä¸€ä¸ª <code>id</code>ï¼Œä½ åœ¨å›ä¼ ç»“æœæ—¶å¿…é¡»ç”¨è¿™ä¸ª <code>id</code>ï¼Œä¸ç„¶æ¨¡å‹ä¸çŸ¥é“å“ªä¸ªç»“æœå¯¹åº”å“ªä¸ªè°ƒç”¨ã€‚</li><li><strong>æ¶ˆæ¯é¡ºåºå¾ˆé‡è¦</strong>ï¼šå¿…é¡»å…ˆåŠ  <code>assistant</code> æ¶ˆæ¯ï¼ˆåŒ…å« <code>tool_calls</code>ï¼‰ï¼Œå†åŠ  <code>tool</code> æ¶ˆæ¯ï¼ˆåŒ…å«ç»“æœï¼‰ã€‚</li><li><strong>temperature è°ƒä½</strong>ï¼šå·¥å…·è°ƒç”¨åœºæ™¯ä¸‹ï¼Œå»ºè®®æŠŠ <code>temperature</code> è®¾ä½ä¸€ç‚¹ï¼ˆæ¯”å¦‚ 0.1ï¼‰ï¼Œè¿™æ ·æ¨¡å‹æ›´å€¾å‘äºç¨³å®šåœ°è°ƒç”¨å·¥å…·ï¼Œè€Œä¸æ˜¯éšæœºå‘æŒ¥ã€‚</li></ol><hr><h2 id="æ€§èƒ½å¯¹æ¯”" tabindex="-1">æ€§èƒ½å¯¹æ¯” <a class="header-anchor" href="#æ€§èƒ½å¯¹æ¯”" aria-label="Permalink to &quot;æ€§èƒ½å¯¹æ¯”&quot;">â€‹</a></h2><p>æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­æµ‹è¯•è¿‡ï¼Œå½“æ¨¡å‹éœ€è¦è°ƒç”¨ 3-5 ä¸ªå·¥å…·æ—¶ï¼š</p><ul><li><strong>åŒæ­¥æ¨¡å¼</strong>ï¼šæ€»è€—æ—¶ = æ‰€æœ‰å·¥å…·è€—æ—¶ä¹‹å’Œï¼ˆæ¯”å¦‚ 3 ç§’ï¼‰</li><li><strong>å¼‚æ­¥æ¨¡å¼</strong>ï¼šæ€»è€—æ—¶ â‰ˆ æœ€æ…¢çš„é‚£ä¸ªå·¥å…·ï¼ˆæ¯”å¦‚ 1 ç§’ï¼‰</li></ul><p>æ€§èƒ½æå‡åœ¨ 200%-500% ä¹‹é—´ï¼Œå·¥å…·è¶Šå¤šï¼Œæå‡è¶Šæ˜æ˜¾ã€‚</p><p>å¦å¤–ï¼Œé”™è¯¯éš”ç¦»ä¹Ÿå¾ˆé‡è¦ã€‚å¦‚æœæŸä¸ªå·¥å…·æŒ‚äº†ï¼ˆæ¯”å¦‚ API è¶…æ—¶ï¼‰ï¼Œå…¶ä»–å·¥å…·è¿˜èƒ½æ­£å¸¸æ‰§è¡Œï¼Œä¸ä¼šå¯¼è‡´æ•´ä¸ªè¯·æ±‚å¤±è´¥ã€‚</p><hr><h2 id="è¸©å‘ç»éªŒ" tabindex="-1">è¸©å‘ç»éªŒ <a class="header-anchor" href="#è¸©å‘ç»éªŒ" aria-label="Permalink to &quot;è¸©å‘ç»éªŒ&quot;">â€‹</a></h2><ol><li><strong>Schema æ ¼å¼è¦ä¸¥æ ¼</strong>ï¼šJSON Schema å†™é”™äº†ï¼Œæ¨¡å‹å¯èƒ½ç†è§£ä¸äº†ï¼Œæˆ–è€…è°ƒç”¨å‚æ•°ä¸å¯¹ã€‚å»ºè®®å…ˆç”¨ OpenAI çš„åœ¨çº¿å·¥å…·éªŒè¯ä¸€ä¸‹ã€‚</li><li><strong>ID å…³è”è¦å‡†ç¡®</strong>ï¼š<code>tool_call_id</code> å¦‚æœå¯¹ä¸ä¸Šï¼Œæ¨¡å‹ä¼šæ··ä¹±ï¼Œå¯èƒ½è¿”å›é”™è¯¯çš„ç»“æœã€‚</li><li><strong>å¼‚æ­¥å‡½æ•°è¦çº¯å‡½æ•°</strong>ï¼š<code>async()</code> é‡ŒåŒ…çš„å‡½æ•°æœ€å¥½æ˜¯æ— å‰¯ä½œç”¨çš„ï¼Œæˆ–è€…å‰¯ä½œç”¨å¯æ§çš„ï¼Œä¸ç„¶è°ƒè¯•èµ·æ¥å¾ˆéº»çƒ¦ã€‚</li><li><strong>è¶…æ—¶è®¾ç½®</strong>ï¼šå¦‚æœå·¥å…·è°ƒç”¨æ¶‰åŠå¤–éƒ¨ APIï¼Œè®°å¾—è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…æ•´ä¸ªè¯·æ±‚å¡æ­»ã€‚</li></ol><hr>`,62)]))}const F=i(l,[["render",t]]);export{d as __pageData,F as default};
