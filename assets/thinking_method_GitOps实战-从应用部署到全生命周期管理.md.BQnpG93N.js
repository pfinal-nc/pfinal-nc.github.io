import{_ as i,o as a,c as n,ac as p}from"./chunks/framework.CxPy2qzZ.js";const g=JSON.parse('{"title":"GitOpså®æˆ˜ï¼šä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†","description":"è®°å½•æˆ‘ä»¬å›¢é˜Ÿä»Jenkinsè¿ç§»åˆ°GitOpsçš„å®Œæ•´è¿‡ç¨‹ï¼Œåˆ†äº«ArgoCDç”Ÿäº§ç¯å¢ƒé…ç½®ã€è¸©å‘ç»éªŒï¼Œä»¥åŠå¤šé›†ç¾¤ç®¡ç†çš„å®è·µæ–¹æ¡ˆã€‚ä¸æ˜¯ç†è®ºæ•™ç¨‹ï¼Œæ˜¯å®æ‰“å®çš„ç»éªŒæ€»ç»“ã€‚","frontmatter":{"title":"GitOpså®æˆ˜ï¼šä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†","date":"2025-02-09T09:30:00.000Z","tags":["GitOps","DevOps","Kubernetes","CI/CD","äº‘åŸç”Ÿ","æŒç»­äº¤ä»˜"],"description":"è®°å½•æˆ‘ä»¬å›¢é˜Ÿä»Jenkinsè¿ç§»åˆ°GitOpsçš„å®Œæ•´è¿‡ç¨‹ï¼Œåˆ†äº«ArgoCDç”Ÿäº§ç¯å¢ƒé…ç½®ã€è¸©å‘ç»éªŒï¼Œä»¥åŠå¤šé›†ç¾¤ç®¡ç†çš„å®è·µæ–¹æ¡ˆã€‚ä¸æ˜¯ç†è®ºæ•™ç¨‹ï¼Œæ˜¯å®æ‰“å®çš„ç»éªŒæ€»ç»“ã€‚","author":"PFinalå—ä¸","keywords":["GitOps","GitOpså®æˆ˜","Kubernetes GitOps","ArgoCDæ•™ç¨‹","FluxCD","æŒç»­äº¤ä»˜","äº‘åŸç”Ÿéƒ¨ç½²","DevOpsæœ€ä½³å®è·µ","å£°æ˜å¼é…ç½®","GitOpså·¥ä½œæµ","K8såº”ç”¨ç®¡ç†","PFinalClub"],"head":[["link",{"rel":"canonical","href":"https://friday-go.icu/thinking/method/GitOpså®æˆ˜-ä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†"}],["meta",{"name":"keywords","content":"GitOps,GitOpså®æˆ˜,Kubernetes GitOps,ArgoCDæ•™ç¨‹,FluxCD,æŒç»­äº¤ä»˜,äº‘åŸç”Ÿéƒ¨ç½²,DevOpsæœ€ä½³å®è·µ,å£°æ˜å¼é…ç½®,GitOpså·¥ä½œæµ,K8såº”ç”¨ç®¡ç†,PFinalClub, PFinalClub, Golangæ•™ç¨‹, Goåç«¯å¼€å‘, Goå¾®æœåŠ¡, PHP, Python, æŠ€æœ¯åšå®¢"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"TechArticle\\",\\"headline\\":\\"GitOpså®æˆ˜ï¼šä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†\\",\\"url\\":\\"https://friday-go.icu/thinking/method/GitOpså®æˆ˜-ä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†\\",\\"datePublished\\":\\"2025-02-09T09:30:00.000Z\\",\\"dateModified\\":1770601599000,\\"author\\":{\\"@type\\":\\"Person\\",\\"name\\":\\"PFinalå—ä¸\\",\\"url\\":\\"https://friday-go.icu/about\\"},\\"publisher\\":{\\"@type\\":\\"Organization\\",\\"name\\":\\"PFinalClub\\",\\"logo\\":{\\"@type\\":\\"ImageObject\\",\\"url\\":\\"https://friday-go.icu/logo.png\\"}},\\"description\\":\\"è®°å½•æˆ‘ä»¬å›¢é˜Ÿä»Jenkinsè¿ç§»åˆ°GitOpsçš„å®Œæ•´è¿‡ç¨‹ï¼Œåˆ†äº«ArgoCDç”Ÿäº§ç¯å¢ƒé…ç½®ã€è¸©å‘ç»éªŒï¼Œä»¥åŠå¤šé›†ç¾¤ç®¡ç†çš„å®è·µæ–¹æ¡ˆã€‚ä¸æ˜¯ç†è®ºæ•™ç¨‹ï¼Œæ˜¯å®æ‰“å®çš„ç»éªŒæ€»ç»“ã€‚\\",\\"inLanguage\\":\\"zh-CN\\",\\"mainEntityOfPage\\":{\\"@type\\":\\"WebPage\\",\\"@id\\":\\"https://friday-go.icu/thinking/method/GitOpså®æˆ˜-ä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†\\"},\\"keywords\\":[\\"GitOps\\",\\"GitOpså®æˆ˜\\",\\"Kubernetes GitOps\\",\\"ArgoCDæ•™ç¨‹\\",\\"FluxCD\\",\\"æŒç»­äº¤ä»˜\\",\\"äº‘åŸç”Ÿéƒ¨ç½²\\",\\"DevOpsæœ€ä½³å®è·µ\\",\\"å£°æ˜å¼é…ç½®\\",\\"GitOpså·¥ä½œæµ\\",\\"K8såº”ç”¨ç®¡ç†\\",\\"PFinalClub\\"]}"],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"BreadcrumbList\\",\\"itemListElement\\":[{\\"@type\\":\\"ListItem\\",\\"position\\":1,\\"name\\":\\"é¦–é¡µ\\",\\"item\\":{\\"@id\\":\\"https://friday-go.icu\\",\\"@type\\":\\"WebPage\\"}},{\\"@type\\":\\"ListItem\\",\\"position\\":2,\\"name\\":\\"æ€è€ƒ/æ–¹æ³•è®º\\",\\"item\\":{\\"@id\\":\\"https://friday-go.icu/thinking\\",\\"@type\\":\\"WebPage\\"}},{\\"@type\\":\\"ListItem\\",\\"position\\":3,\\"name\\":\\"æ–¹æ³•è®º\\",\\"item\\":{\\"@id\\":\\"https://friday-go.icu/thinking/method\\",\\"@type\\":\\"WebPage\\"}},{\\"@type\\":\\"ListItem\\",\\"position\\":4,\\"name\\":\\"GitOpså®æˆ˜ï¼šä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†\\",\\"item\\":{\\"@id\\":\\"https://friday-go.icu/thinking/method/GitOpså®æˆ˜-ä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†\\",\\"@type\\":\\"Article\\"}}]}"]]},"headers":[],"relativePath":"thinking/method/GitOpså®æˆ˜-ä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†.md","filePath":"thinking/method/GitOpså®æˆ˜-ä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†.md","lastUpdated":1770601599000}'),l={name:"thinking/method/GitOpså®æˆ˜-ä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†.md"};function t(h,s,k,e,E,r){return a(),n("div",{"data-pagefind-body":!0,"data-pagefind-meta":"date:1739093400000"},s[0]||(s[0]=[p(`<h1 id="gitopså®æˆ˜-ä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†" tabindex="-1">GitOpså®æˆ˜ï¼šä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç† <a class="header-anchor" href="#gitopså®æˆ˜-ä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†" aria-label="Permalink to &quot;GitOpså®æˆ˜ï¼šä»åº”ç”¨éƒ¨ç½²åˆ°å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†&quot;">â€‹</a></h1><blockquote><p>å»å¹´æˆ‘ä»¬å›¢é˜Ÿä»ä¼ ç»Ÿçš„Jenkins + kubectl applyæ¨¡å¼è¿ç§»åˆ°GitOpsï¼Œè¸©äº†ä¸å°‘å‘ï¼Œä¹Ÿæ”¶è·äº†å¾ˆå¤šã€‚è¿™ç¯‡æ–‡ç« åˆ†äº«æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒæ‘¸çˆ¬æ»šæ‰“ä¸€å¹´çš„ç»éªŒï¼ŒåŒ…æ‹¬ArgoCDçš„å„ç§å‘ã€Fluxçš„é€‰å‹çº ç»“ï¼Œä»¥åŠé‚£äº›å®˜æ–¹æ–‡æ¡£ä¸ä¼šå‘Šè¯‰ä½ çš„å®æˆ˜æŠ€å·§ã€‚</p></blockquote><h2 id="ğŸ¯-ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦gitops" tabindex="-1">ğŸ¯ ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦GitOpsï¼Ÿ <a class="header-anchor" href="#ğŸ¯-ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦gitops" aria-label="Permalink to &quot;ğŸ¯ ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦GitOpsï¼Ÿ&quot;">â€‹</a></h2><p>è¯´å®è¯ï¼Œåœ¨ç”¨GitOpsä¹‹å‰ï¼Œæˆ‘ä»¬çš„éƒ¨ç½²æµç¨‹æŒºæ··ä¹±çš„ã€‚</p><h3 id="é‚£äº›å¹´è¸©è¿‡çš„å‘" tabindex="-1">é‚£äº›å¹´è¸©è¿‡çš„å‘ <a class="header-anchor" href="#é‚£äº›å¹´è¸©è¿‡çš„å‘" aria-label="Permalink to &quot;é‚£äº›å¹´è¸©è¿‡çš„å‘&quot;">â€‹</a></h3><p>è®°å¾—æœ‰ä¸€æ¬¡ï¼Œä¸€ä¸ªæ–°æ¥çš„åŒäº‹ä¸ºäº†ä¿®ä¸€ä¸ªç´§æ€¥bugï¼Œç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒç”¨<code>kubectl edit</code>æ”¹äº†Deploymentçš„é•œåƒæ ‡ç­¾ã€‚å½“æ—¶ç¡®å®è§£å†³é—®é¢˜äº†ï¼Œä½†ä¸¤å‘¨åå¦ä¸€æ¬¡éƒ¨ç½²æ—¶ï¼Œè¿™ä¸ªä¿®æ”¹è¢«è¦†ç›–äº†ï¼Œå¯¼è‡´æœåŠ¡å¼‚å¸¸ï¼Œæˆ‘ä»¬èŠ±äº†å¤§åŠå¤œæ’æŸ¥åŸå› ã€‚</p><p>ç±»ä¼¼çš„æƒ…å†µè¿˜æœ‰å¾ˆå¤šï¼š</p><ul><li><strong>é…ç½®æ¼‚ç§»é˜²ä¸èƒœé˜²</strong>ï¼šæœ‰äººç›´æ¥åœ¨é›†ç¾¤é‡Œæ”¹é…ç½®ï¼ŒGité‡Œçš„é…ç½®å’Œå®é™…è¿è¡ŒçŠ¶æ€å¯¹ä¸ä¸Šã€‚æœ€å°´å°¬çš„æ˜¯ï¼Œæœ‰æ—¶å€™ã€Œæˆ‘æœºå™¨ä¸Šèƒ½è·‘ã€å˜æˆäº†ã€Œåªæœ‰ç”Ÿäº§ç¯å¢ƒèƒ½è·‘ã€ï¼Œå› ä¸ºä¸çŸ¥é“è°å·å·æ”¹äº†ä»€ä¹ˆã€‚</li><li><strong>æƒé™ç®¡ç†ä¸€å›¢ç³Ÿ</strong>ï¼šå¼€å‘ã€æµ‹è¯•ã€è¿ç»´éƒ½åœ¨ç”¨åŒä¸€ä¸ªkubeconfigï¼Œå‡ºäº†äº‹æ ¹æœ¬ä¸çŸ¥é“æ˜¯è°å¹²çš„ã€‚æœ‰ä¸€æ¬¡è¯¯åˆ äº†namespaceï¼ŒæŸ¥äº†åŠå¤©æ—¥å¿—æ‰æ‰¾åˆ°å…ƒå‡¶ã€‚</li><li><strong>å›æ»šåƒèµŒåš</strong>ï¼šç”¨è„šæœ¬éƒ¨ç½²ï¼Œå›æ»šçš„æ—¶å€™å‘ç°è„šæœ¬ä¾èµ–å½“æ—¶çš„æ‰§è¡Œç¯å¢ƒï¼Œæ ¹æœ¬è·‘ä¸é€šã€‚æœ€ååªèƒ½æ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªæ”¹ï¼Œå¿ƒæƒŠèƒ†æˆ˜çš„ã€‚</li><li><strong>åä½œåŸºæœ¬é å¼</strong>ï¼šå¼€å‘è¯´&quot;æˆ‘ä»£ç æäº¤äº†&quot;ï¼Œè¿ç»´è¯´&quot;æˆ‘æ²¡æ”¶åˆ°éƒ¨ç½²è¯·æ±‚&quot;ï¼Œæµ‹è¯•è¯´&quot;ç¯å¢ƒä¸å¯¹å•Š&quot;ã€‚æ¯ä¸ªäººéƒ½åœ¨è‡ªå·±çš„ä¸–ç•Œé‡Œï¼Œä¿¡æ¯å®Œå…¨ä¸é€æ˜ã€‚</li></ul><h3 id="gitopsåˆ°åº•è§£å†³äº†ä»€ä¹ˆ" tabindex="-1">GitOpsåˆ°åº•è§£å†³äº†ä»€ä¹ˆ <a class="header-anchor" href="#gitopsåˆ°åº•è§£å†³äº†ä»€ä¹ˆ" aria-label="Permalink to &quot;GitOpsåˆ°åº•è§£å†³äº†ä»€ä¹ˆ&quot;">â€‹</a></h3><p>åæ¥æˆ‘ä»¬å¼•å…¥äº†GitOpsï¼Œæƒ…å†µå¥½äº†å¾ˆå¤šã€‚</p><p>GitOpsçš„æ ¸å¿ƒæ€æƒ³å¾ˆç®€å•ï¼š<strong>Gitä»“åº“å°±æ˜¯å”¯ä¸€çš„äº‹å®æ¥æº</strong>ï¼ˆSingle Source of Truthï¼‰ã€‚æ‰€æœ‰é…ç½®éƒ½æ”¾åˆ°Gité‡Œï¼Œç„¶åé€šè¿‡ArgoCDè¿™æ ·çš„å·¥å…·è‡ªåŠ¨åŒæ­¥åˆ°é›†ç¾¤ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„å¾ˆæ˜æ˜¾ï¼š</p><ol><li><strong>å˜æ›´å¯è¿½æº¯</strong>ï¼šè°æ”¹äº†ä»€ä¹ˆã€ä»€ä¹ˆæ—¶å€™æ”¹çš„ã€ä¸ºä»€ä¹ˆæ”¹ï¼ŒGit historyé‡Œä¸€ç›®äº†ç„¶ã€‚å†ä¹Ÿä¸ç”¨çŒœ&quot;è¿™ä¸ªé…ç½®æ˜¯è°æ”¹çš„&quot;ã€‚</li><li><strong>å›æ»šå°±æ˜¯git revert</strong>ï¼šå‡ºé—®é¢˜çš„æ—¶å€™ï¼Œä¸ç”¨æ‰‹å¿™è„šä¹±åœ°æ”¹é…ç½®æ–‡ä»¶ï¼Œç›´æ¥<code>git revert</code>ç„¶åç­‰ArgoCDåŒæ­¥å°±è¡Œã€‚æˆ‘ä»¬æœ‰ä¸€æ¬¡å›æ»šåªèŠ±äº†3åˆ†é’Ÿã€‚</li><li><strong>é›†ç¾¤çŠ¶æ€å’ŒGitä¿æŒä¸€è‡´</strong>ï¼šå¦‚æœæœ‰äººå·å·<code>kubectl edit</code>ï¼ŒArgoCDä¼šè‡ªåŠ¨æŠŠå®ƒæ”¹å›æ¥ï¼ˆå¦‚æœä½ å¼€äº†self-healï¼‰ã€‚é…ç½®æ¼‚ç§»åŸºæœ¬è¢«æ ¹æ²»äº†ã€‚</li><li><strong>éƒ¨ç½²è‡ªåŠ¨åŒ–</strong>ï¼šä»£ç åˆå¹¶åˆ°mainåˆ†æ”¯åï¼ŒCIæ‰“åŒ…é•œåƒï¼Œç„¶åè‡ªåŠ¨æ›´æ–°GitOpsä»“åº“é‡Œçš„é•œåƒæ ‡ç­¾ã€‚å‰©ä¸‹çš„äº¤ç»™ArgoCDï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ã€‚</li><li><strong>å¤šç¯å¢ƒç®¡ç†ç®€å•äº†</strong>ï¼šæˆ‘ä»¬ç”¨çš„æ˜¯Kustomizeçš„overlayæ¨¡å¼ï¼Œ<code>base</code>æ”¾é€šç”¨é…ç½®ï¼Œ<code>overlays/dev</code>ã€<code>overlays/prod</code>æ”¾ç¯å¢ƒç‰¹å®šçš„é…ç½®ã€‚ç¯å¢ƒä¹‹é—´çš„å·®å¼‚æ¸…æ¸…æ¥šæ¥šã€‚</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                       GitOps å·¥ä½œæµ                          â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚                                                             â”‚</span></span>
<span class="line"><span>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚</span></span>
<span class="line"><span>â”‚  â”‚  å¼€å‘åˆ†æ”¯  â”‚ â”€â”€â”€â†’ â”‚  Gitä»“åº“  â”‚ â†â”€â”€â†’ â”‚  å£°æ˜å¼æ§åˆ¶å™¨   â”‚      â”‚</span></span>
<span class="line"><span>â”‚  â”‚ (Feature)â”‚      â”‚(Source ofâ”‚      â”‚(ArgoCD/Flux) â”‚      â”‚</span></span>
<span class="line"><span>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ Truth)   â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚</span></span>
<span class="line"><span>â”‚         â†“          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚              â”‚</span></span>
<span class="line"><span>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â†‘                  â†“              â”‚</span></span>
<span class="line"><span>â”‚  â”‚  Code    â”‚            â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚</span></span>
<span class="line"><span>â”‚  â”‚ Review   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ K8sé›†ç¾¤  â”‚          â”‚</span></span>
<span class="line"><span>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              è‡ªåŠ¨åŒæ­¥    â”‚ (å®é™…çŠ¶æ€)â”‚          â”‚</span></span>
<span class="line"><span>â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre></div><h2 id="ğŸ“š-gitopsæ ¸å¿ƒæ¦‚å¿µ" tabindex="-1">ğŸ“š GitOpsæ ¸å¿ƒæ¦‚å¿µ <a class="header-anchor" href="#ğŸ“š-gitopsæ ¸å¿ƒæ¦‚å¿µ" aria-label="Permalink to &quot;ğŸ“š GitOpsæ ¸å¿ƒæ¦‚å¿µ&quot;">â€‹</a></h2><h3 id="å£°æ˜å¼-vs-å‘½ä»¤å¼" tabindex="-1">å£°æ˜å¼ vs å‘½ä»¤å¼ <a class="header-anchor" href="#å£°æ˜å¼-vs-å‘½ä»¤å¼" aria-label="Permalink to &quot;å£°æ˜å¼ vs å‘½ä»¤å¼&quot;">â€‹</a></h3><p>åˆšå¼€å§‹æ¥è§¦GitOpsçš„æ—¶å€™ï¼Œæˆ‘å¯¹ã€Œå£°æ˜å¼ã€è¿™ä¸ªæ¦‚å¿µæœ‰ç‚¹æ‡µã€‚åæ¥æƒ³æ˜ç™½äº†ï¼Œå…¶å®å¾ˆç®€å•ï¼š</p><ul><li><strong>å‘½ä»¤å¼</strong>ï¼šä½ å‘Šè¯‰ç³»ç»Ÿã€Œä¸€æ­¥ä¸€æ­¥æ€ä¹ˆåšã€ã€‚å°±åƒæ•™åˆ«äººåšèœï¼š&quot;å…ˆæ”¾æ²¹ï¼Œå†æ”¾èœï¼Œç„¶åç¿»ç‚’5åˆ†é’Ÿ...&quot;</li><li><strong>å£°æ˜å¼</strong>ï¼šä½ å‘Šè¯‰ç³»ç»Ÿã€Œæˆ‘æƒ³è¦ä»€ä¹ˆç»“æœã€ã€‚å°±åƒç‚¹èœï¼š&quot;æˆ‘è¦ä¸€ä»½å®«ä¿é¸¡ä¸ï¼Œå¾®è¾£&quot;ã€‚</li></ul><p>Kubernetesæœ¬èº«å°±æ˜¯å£°æ˜å¼çš„ã€‚ä½ ä¸æ˜¯<code>ssh</code>åˆ°æœºå™¨ä¸Šå¯åŠ¨è¿›ç¨‹ï¼Œè€Œæ˜¯å†™ä¸€ä¸ªYAMLè¯´&quot;æˆ‘è¦3ä¸ªå‰¯æœ¬&quot;ï¼Œç„¶åK8sè‡ªå·±å»æå®šã€‚</p><p>GitOpsæŠŠè¿™å¥—ç†å¿µæ‰©å±•åˆ°äº†éƒ¨ç½²æµç¨‹ã€‚ä½ åªéœ€è¦åœ¨Gité‡Œå£°æ˜ã€Œæˆ‘æƒ³è¦é›†ç¾¤é•¿è¿™æ ·ã€ï¼ŒArgoCDä¼šè‡ªåŠ¨è®©é›†ç¾¤å˜æˆé‚£ä¸ªæ ·å­ã€‚</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å£°æ˜å¼ï¼šæè¿°æœŸæœ›çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-app:v1.2.3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        resources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          requests</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;128Mi&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            cpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;100m&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          limits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;256Mi&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            cpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;200m&quot;</span></span></code></pre></div><p>å¯¹æ¯”å‘½ä»¤å¼æ“ä½œï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å‘½ä»¤å¼ï¼šä¸€æ­¥æ­¥æ‰§è¡Œï¼ˆå®¹æ˜“å‡ºé”™ä¸”éš¾ä»¥å¤ç°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-app</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --image=my-app:v1.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --replicas=3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> resources</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-app</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --requests=cpu=100m,memory=128Mi</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ... æ›´å¤šå‘½ä»¤</span></span></code></pre></div><p>è¯´å®è¯ï¼Œä¸€å¼€å§‹æˆ‘è§‰å¾—å£°æ˜å¼ä¸å¤Ÿçµæ´»ã€‚ä½†ç”¨äº†åŠå¹´åï¼ŒçœŸé¦™ã€‚æœ€æ˜æ˜¾çš„å¥½å¤„æ˜¯ï¼š<strong>å¹‚ç­‰æ€§</strong>ã€‚ä½ æ‰§è¡Œä¸€æ¬¡å’Œæ‰§è¡Œåæ¬¡ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¸ä¼šæå‡ºã€Œé‡å¤åˆ›å»ºã€ä¹‹ç±»çš„é—®é¢˜ã€‚</p><h3 id="gitæ˜¯å”¯ä¸€çš„äº‹å®æ¥æº" tabindex="-1">Gitæ˜¯å”¯ä¸€çš„äº‹å®æ¥æº <a class="header-anchor" href="#gitæ˜¯å”¯ä¸€çš„äº‹å®æ¥æº" aria-label="Permalink to &quot;Gitæ˜¯å”¯ä¸€çš„äº‹å®æ¥æº&quot;">â€‹</a></h3><p>è¿™ä¸€ç‚¹çœ‹èµ·æ¥ç®€å•ï¼Œä½†å®é™…æ‰§è¡Œèµ·æ¥æœ‰ä¸å°‘ç»†èŠ‚è¦æ³¨æ„ã€‚</p><p>æˆ‘ä»¬åœ¨å®è·µä¸­æŠŠä»“åº“åˆ†æˆäº†å‡ ç±»ï¼š</p><ul><li><strong>ä»£ç ä»“åº“</strong>ï¼šåº”ç”¨æºç ã€Dockerfileï¼Œè¿™ä¸ªå’ŒåŸæ¥ä¸€æ ·</li><li><strong>é…ç½®ä»“åº“</strong>ï¼šä¸“é—¨æ”¾K8s manifestsã€Helm chartsã€Kustomizeé…ç½®</li><li><strong>ç­–ç•¥ä»“åº“</strong>ï¼šç½‘ç»œç­–ç•¥ã€RBACé…ç½®ç­‰å®‰å…¨ç›¸å…³çš„ä¸œè¥¿</li></ul><p>ä¸€å¼€å§‹æˆ‘ä»¬æƒ³æŠŠæ‰€æœ‰ä¸œè¥¿æ”¾åœ¨ä¸€ä¸ªä»“åº“é‡Œï¼Œåæ¥å‘ç°è¿™æ ·æƒé™ä¸å¥½æ§åˆ¶ã€‚è®©å¼€å‘æœ‰æƒé™æ”¹ä»£ç ï¼Œä½†ä¸ä¸€å®šåº”è¯¥è®©ä»–ä»¬æ”¹ç”Ÿäº§ç¯å¢ƒçš„ingressé…ç½®ã€‚æ‰€ä»¥æ‹†æˆäº†å¤šä¸ªä»“åº“ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘ä»¬ç°åœ¨çš„ç›®å½•ç»“æ„ï¼Œä¾›å‚è€ƒï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>project-gitops/</span></span>
<span class="line"><span>â”œâ”€â”€ apps/                          # åº”ç”¨é…ç½®</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ frontend/</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ base/</span></span>
<span class="line"><span>â”‚   â”‚   â”‚   â”œâ”€â”€ deployment.yaml</span></span>
<span class="line"><span>â”‚   â”‚   â”‚   â”œâ”€â”€ service.yaml</span></span>
<span class="line"><span>â”‚   â”‚   â”‚   â””â”€â”€ kustomization.yaml</span></span>
<span class="line"><span>â”‚   â”‚   â””â”€â”€ overlays/</span></span>
<span class="line"><span>â”‚   â”‚       â”œâ”€â”€ dev/</span></span>
<span class="line"><span>â”‚   â”‚       â”œâ”€â”€ staging/</span></span>
<span class="line"><span>â”‚   â”‚       â””â”€â”€ production/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ backend/</span></span>
<span class="line"><span>â”œâ”€â”€ infrastructure/                # åŸºç¡€è®¾æ–½é…ç½®</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ nginx-ingress/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ cert-manager/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ monitoring/</span></span>
<span class="line"><span>â”œâ”€â”€ policies/                      # å®‰å…¨ç­–ç•¥</span></span>
<span class="line"><span>â””â”€â”€ docs/                          # æ–‡æ¡£</span></span></code></pre></div><p>æœ‰ä¸€ä¸ªå‘è¦æ³¨æ„ï¼š<strong>åˆ«æŠŠæ•æ„Ÿä¿¡æ¯æ˜æ–‡æäº¤åˆ°Git</strong>ã€‚åé¢ä¼šè®²æ€ä¹ˆç”¨Sealed Secretsæˆ–è€…External Secretsæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="æ‹‰å–æ¨¡å¼-vs-æ¨é€æ¨¡å¼" tabindex="-1">æ‹‰å–æ¨¡å¼ vs æ¨é€æ¨¡å¼ <a class="header-anchor" href="#æ‹‰å–æ¨¡å¼-vs-æ¨é€æ¨¡å¼" aria-label="Permalink to &quot;æ‹‰å–æ¨¡å¼ vs æ¨é€æ¨¡å¼&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                     æ¨é€æ¨¡å¼ (Push)                              â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚                                                                â”‚</span></span>
<span class="line"><span>â”‚  CI/CD Pipeline â”€â”€â†’ kubectl apply â”€â”€â†’ Kubernetes Cluster      â”‚</span></span>
<span class="line"><span>â”‚                                                                â”‚</span></span>
<span class="line"><span>â”‚  âŒ éœ€è¦é›†ç¾¤è®¿é—®å‡­è¯                                            â”‚</span></span>
<span class="line"><span>â”‚  âŒ éš¾ä»¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§                                          â”‚</span></span>
<span class="line"><span>â”‚  âŒ å®¡è®¡å’Œå›æ»šå›°éš¾                                              â”‚</span></span>
<span class="line"><span>â”‚                                                                â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span></span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                     æ‹‰å–æ¨¡å¼ (Pull)                              â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚                                                                â”‚</span></span>
<span class="line"><span>â”‚  Git Repository â†â”€â”€â”€â”€ ç›‘æ§å˜æ›´ â†â”€â”€â”€â”€ GitOps Controller         â”‚</span></span>
<span class="line"><span>â”‚       â”‚                                            â”‚           â”‚</span></span>
<span class="line"><span>â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ‹‰å–é…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚           â”‚</span></span>
<span class="line"><span>â”‚                                                    â†“           â”‚</span></span>
<span class="line"><span>â”‚                                            Kubernetes Cluster â”‚</span></span>
<span class="line"><span>â”‚                                                                â”‚</span></span>
<span class="line"><span>â”‚  âœ… æ§åˆ¶å™¨åœ¨é›†ç¾¤å†…ï¼Œæ— éœ€å¤–éƒ¨è®¿é—®                                  â”‚</span></span>
<span class="line"><span>â”‚  âœ… æŒç»­åè°ƒï¼Œä¿è¯çŠ¶æ€ä¸€è‡´                                        â”‚</span></span>
<span class="line"><span>â”‚  âœ… Gitå†å²å³å®¡è®¡æ—¥å¿—                                            â”‚</span></span>
<span class="line"><span>â”‚                                                                â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre></div><h2 id="ğŸ› ï¸-gitopså·¥å…·é“¾å®æˆ˜" tabindex="-1">ğŸ› ï¸ GitOpså·¥å…·é“¾å®æˆ˜ <a class="header-anchor" href="#ğŸ› ï¸-gitopså·¥å…·é“¾å®æˆ˜" aria-label="Permalink to &quot;ğŸ› ï¸ GitOpså·¥å…·é“¾å®æˆ˜&quot;">â€‹</a></h2><h3 id="argocd-æˆ‘ä»¬æœ€ç»ˆçš„é€‰æ‹©" tabindex="-1">ArgoCDï¼šæˆ‘ä»¬æœ€ç»ˆçš„é€‰æ‹© <a class="header-anchor" href="#argocd-æˆ‘ä»¬æœ€ç»ˆçš„é€‰æ‹©" aria-label="Permalink to &quot;ArgoCDï¼šæˆ‘ä»¬æœ€ç»ˆçš„é€‰æ‹©&quot;">â€‹</a></h3><p>æˆ‘ä»¬å¯¹æ¯”äº†ArgoCDå’ŒFluxï¼Œæœ€åé€‰äº†ArgoCDã€‚ä¸»è¦åŸå› æ˜¯ï¼š</p><ol><li><strong>æœ‰UI</strong>ï¼šFluxæ²¡æœ‰å®˜æ–¹UIï¼Œè™½ç„¶å¯ä»¥ç”¨Weave GitOpsï¼Œä½†è¿˜æ˜¯ä¸å¦‚ArgoCDçš„åŸç”ŸUIç›´è§‚</li><li><strong>ä¸Šæ‰‹å¿«</strong>ï¼šDashboardé‡Œç‚¹ç‚¹å°±èƒ½åˆ›å»ºåº”ç”¨ï¼Œå¯¹åˆšå¼€å§‹æ¥è§¦GitOpsçš„åŒäº‹å‹å¥½</li><li><strong>ç¤¾åŒºå¤§</strong>ï¼šé‡åˆ°é—®é¢˜Stack Overflowä¸ŠåŸºæœ¬éƒ½èƒ½æ‰¾åˆ°ç­”æ¡ˆ</li></ol><p>ä½†ArgoCDä¹Ÿæœ‰ç¼ºç‚¹ï¼Œæ¯”å¦‚èµ„æºå ç”¨æ¯”Fluxé«˜ï¼Œè€Œä¸”é…ç½®å¤æ‚åº”ç”¨çš„æ—¶å€™YAMLä¼šå†™å¾—æ¯”è¾ƒå¤šã€‚</p><p>æ€»ä¹‹ï¼Œå¦‚æœä½ æƒ³è¦ä¸€ä¸ªå¼€ç®±å³ç”¨ã€æœ‰å›¾å½¢ç•Œé¢çš„æ–¹æ¡ˆï¼ŒArgoCDæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å¦‚æœä½ æ›´å–œæ¬¢è½»é‡çº§ã€çº¯å£°æ˜å¼çš„ï¼Œå¯ä»¥è€ƒè™‘Fluxã€‚</p><h4 id="å®‰è£…éƒ¨ç½²" tabindex="-1">å®‰è£…éƒ¨ç½² <a class="header-anchor" href="#å®‰è£…éƒ¨ç½²" aria-label="Permalink to &quot;å®‰è£…éƒ¨ç½²&quot;">â€‹</a></h4><p>å®‰è£…å¾ˆç®€å•ï¼Œä½†æœ‰å‡ ä¸ªå‘è¦æ³¨æ„ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºå‘½åç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®‰è£…ArgoCD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</span></span></code></pre></div><p><strong>ç¬¬ä¸€ä¸ªå‘</strong>ï¼šé»˜è®¤å®‰è£…ç”¨çš„æ˜¯NodePortæˆ–è€…ClusterIPï¼Œä½ è¦ä¹ˆé…Ingressï¼Œè¦ä¹ˆç”¨port-forwardã€‚æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒæ˜¯ç”¨Ingress + cert-managerç®¡ç†è¯ä¹¦çš„ã€‚</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼€å‘ç¯å¢ƒå¯ä»¥ç”¨port-forward</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> svc/argocd-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8080:443</span></span></code></pre></div><p><strong>ç¬¬äºŒä¸ªå‘</strong>ï¼šåˆå§‹å¯†ç ã€‚2.0ç‰ˆæœ¬ä»¥åå˜äº†ï¼Œç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2.0+ç‰ˆæœ¬ç”¨è¿™ä¸ª</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">argocd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> initial-password</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è€ç‰ˆæœ¬ç”¨è¿™ä¸ªï¼ˆç°åœ¨åŸºæœ¬ä¸ç”¨äº†ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> argocd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app.kubernetes.io/name=argocd-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span></code></pre></div><p>ç™»å½•ä¹‹å<strong>è®°å¾—æ”¹å¯†ç </strong>ï¼Œè¿˜è¦é…RBACã€‚é»˜è®¤çš„<code>admin</code>ç”¨æˆ·æƒé™å¤ªå¤§ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®å¯¹æ¥SSOï¼ˆæˆ‘ä»¬å¯¹æ¥çš„æ˜¯GitLab OAuthï¼‰ã€‚</p><h4 id="åº”ç”¨å®šä¹‰ç¤ºä¾‹" tabindex="-1">åº”ç”¨å®šä¹‰ç¤ºä¾‹ <a class="header-anchor" href="#åº”ç”¨å®šä¹‰ç¤ºä¾‹" aria-label="Permalink to &quot;åº”ç”¨å®šä¹‰ç¤ºä¾‹&quot;">â€‹</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argoproj.io/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Application</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production-frontend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  finalizers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">resources-finalizer.argocd.argoproj.io</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  project</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    repoURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://github.com/your-org/gitops-repo.git</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    targetRevision</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/frontend/overlays/production</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Helmç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # helm:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #   valueFiles:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #     - values-production.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  destination</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://kubernetes.default.svc</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  syncPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    automated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      prune</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # è‡ªåŠ¨åˆ é™¤Gitä¸­ä¸å­˜åœ¨çš„èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      selfHeal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           # è‡ªåŠ¨ä¿®å¤é…ç½®æ¼‚ç§»</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      allowEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    syncOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CreateNamespace=true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # è‡ªåŠ¨åˆ›å»ºå‘½åç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PrunePropagationPolicy=foreground</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PruneLast=true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    retry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      limit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      backoff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        duration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        factor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        maxDuration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3m</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  revisionHistoryLimit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span></code></pre></div><h4 id="åŒæ­¥é¡ºåºä¸-sync-wave" tabindex="-1">åŒæ­¥é¡ºåºä¸ Sync Wave <a class="header-anchor" href="#åŒæ­¥é¡ºåºä¸-sync-wave" aria-label="Permalink to &quot;åŒæ­¥é¡ºåºä¸ Sync Wave&quot;">â€‹</a></h4><p>å½“å­˜åœ¨ <strong>Namespace â†’ CRD â†’ Application</strong> ç­‰ä¾èµ–æ—¶ï¼Œéœ€è¦æ§åˆ¶åŒæ­¥é¡ºåºï¼Œé¿å…ã€Œåº”ç”¨å…ˆäºä¾èµ–ã€çš„ç«æ€ã€‚ArgoCD é€šè¿‡ <strong>Sync Wave</strong> å®ç°ï¼šæ•°å­—å°çš„å…ˆæ‰§è¡Œï¼Œæœªæ ‡æ³¨çš„é»˜è®¤ä¸º 0ã€‚</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Namespace æœ€å…ˆåˆ›å»ºï¼ˆwave æœ€å°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Namespace</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    argocd.argoproj.io/sync-wave</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CRD å…¶æ¬¡</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiextensions.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CustomResourceDefinition</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mycrds.example.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    argocd.argoproj.io/sync-wave</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åº”ç”¨æœ€å</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    argocd.argoproj.io/sync-wave</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span></span></code></pre></div><h4 id="å¤šç¯å¢ƒç®¡ç†ç­–ç•¥" tabindex="-1">å¤šç¯å¢ƒç®¡ç†ç­–ç•¥ <a class="header-anchor" href="#å¤šç¯å¢ƒç®¡ç†ç­–ç•¥" aria-label="Permalink to &quot;å¤šç¯å¢ƒç®¡ç†ç­–ç•¥&quot;">â€‹</a></h4><blockquote><p><strong>è¯´æ˜</strong>ï¼šApp of Apps ä¸­ <code>path</code> éœ€æŒ‡å‘<strong>åŒ…å«å¤šä¸ª Application æ¸…å•æˆ– Kustomization çš„ç›®å½•</strong>ï¼ˆå¦‚ <code>apps</code> ä¸‹æ¯å­ç›®å½•ä¸€ä¸ª <code>Application.yaml</code> æˆ– <code>kustomization.yaml</code>ï¼‰ï¼Œ<code>directory.recurse: true</code> ä¼šé€’å½’å‘ç°å¹¶åŒæ­¥è¿™äº›èµ„æºã€‚</p></blockquote><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨App of Appsæ¨¡å¼ç®¡ç†å¤šä¸ªåº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argoproj.io/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Application</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production-apps</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  project</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    repoURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://github.com/your-org/gitops-repo.git</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    targetRevision</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      recurse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      jsonnet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  destination</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://kubernetes.default.svc</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  syncPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    automated</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      prune</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      selfHeal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><h3 id="fluxcd-äº‘åŸç”Ÿgitopsæ–¹æ¡ˆ" tabindex="-1">FluxCDï¼šäº‘åŸç”ŸGitOpsæ–¹æ¡ˆ <a class="header-anchor" href="#fluxcd-äº‘åŸç”Ÿgitopsæ–¹æ¡ˆ" aria-label="Permalink to &quot;FluxCDï¼šäº‘åŸç”ŸGitOpsæ–¹æ¡ˆ&quot;">â€‹</a></h3><p>FluxCDæ˜¯CNCFå­µåŒ–é¡¹ç›®ï¼Œä¸GitHubç”Ÿæ€æ·±åº¦é›†æˆã€‚</p><h4 id="æ ¸å¿ƒç»„ä»¶æ¶æ„" tabindex="-1">æ ¸å¿ƒç»„ä»¶æ¶æ„ <a class="header-anchor" href="#æ ¸å¿ƒç»„ä»¶æ¶æ„" aria-label="Permalink to &quot;æ ¸å¿ƒç»„ä»¶æ¶æ„&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                      FluxCD æ¶æ„                             â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚                                                             â”‚</span></span>
<span class="line"><span>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚</span></span>
<span class="line"><span>â”‚  â”‚  Source      â”‚  â”‚  Kustomize   â”‚  â”‚  Helm        â”‚      â”‚</span></span>
<span class="line"><span>â”‚  â”‚  Controller  â”‚  â”‚  Controller  â”‚  â”‚  Controller  â”‚      â”‚</span></span>
<span class="line"><span>â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚</span></span>
<span class="line"><span>â”‚         â”‚                 â”‚                  â”‚             â”‚</span></span>
<span class="line"><span>â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚</span></span>
<span class="line"><span>â”‚                           â†“                                â”‚</span></span>
<span class="line"><span>â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚</span></span>
<span class="line"><span>â”‚                    â”‚  Git Repo    â”‚                        â”‚</span></span>
<span class="line"><span>â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚</span></span>
<span class="line"><span>â”‚                           â”‚                                â”‚</span></span>
<span class="line"><span>â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚</span></span>
<span class="line"><span>â”‚         â†“                 â†“                 â†“              â”‚</span></span>
<span class="line"><span>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚</span></span>
<span class="line"><span>â”‚  â”‚  Image       â”‚  â”‚  Notificationâ”‚  â”‚  Alert       â”‚      â”‚</span></span>
<span class="line"><span>â”‚  â”‚  Automation  â”‚  â”‚  Controller  â”‚  â”‚  Controller  â”‚      â”‚</span></span>
<span class="line"><span>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚</span></span>
<span class="line"><span>â”‚                                                             â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre></div><h4 id="å®‰è£…ä¸é…ç½®" tabindex="-1">å®‰è£…ä¸é…ç½® <a class="header-anchor" href="#å®‰è£…ä¸é…ç½®" aria-label="Permalink to &quot;å®‰è£…ä¸é…ç½®&quot;">â€‹</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®‰è£…Flux CLI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://fluxcd.io/install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼•å¯¼Fluxåˆ°é›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bootstrap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> github</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --owner=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$GITHUB_USER</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --repository=gitops-repo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --branch=main</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --path=./clusters/production</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --personal</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># éªŒè¯å®‰è£…</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flux</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> check</span></span></code></pre></div><h4 id="è‡ªåŠ¨åŒ–é•œåƒæ›´æ–°" tabindex="-1">è‡ªåŠ¨åŒ–é•œåƒæ›´æ–° <a class="header-anchor" href="#è‡ªåŠ¨åŒ–é•œåƒæ›´æ–°" aria-label="Permalink to &quot;è‡ªåŠ¨åŒ–é•œåƒæ›´æ–°&quot;">â€‹</a></h4><blockquote><p><strong>è¯´æ˜</strong>ï¼šFlux çš„ <code>ImageRepository</code>ã€<code>ImagePolicy</code>ã€<code>ImageUpdateAutomation</code> ç­‰ API ç‰ˆæœ¬ä¼šéšç‰ˆæœ¬è¿­ä»£æ›´æ–°ï¼Œç¤ºä¾‹ä»¥æ’°å†™æ—¶ä¸ºå‡†ï¼Œè¯·ä»¥ <a href="https://fluxcd.io/flux/components/image/" target="_blank" rel="noreferrer">Flux å®˜æ–¹æ–‡æ¡£</a> ä¸ºå‡†ã€‚</p></blockquote><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é…ç½®é•œåƒä»“åº“æ‰«æ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">image.toolkit.fluxcd.io/v1beta2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ImageRepository</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flux-system</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/your-org/frontend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1m0s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  secretRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr-auth</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®šä¹‰é•œåƒç­–ç•¥</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">image.toolkit.fluxcd.io/v1beta2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ImagePolicy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flux-system</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  imageRepositoryRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  policy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    semver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&gt;=1.0.0 &lt;2.0.0&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  filterTags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    pattern</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;^v(?P&lt;version&gt;.*)$&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    extract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$version&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è‡ªåŠ¨æ›´æ–°Gitä»“åº“</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">image.toolkit.fluxcd.io/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ImageUpdateAutomation</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flux-system</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1m0s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  sourceRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GitRepository</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flux-system</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  git</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        branch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    commit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      author</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Flux Bot</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flux@example.com</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      messageTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Automated image update</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Images:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        {{ range .Updated.Images -}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        - {{.}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        {{ end }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      signingKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        secretRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flux-gpg-signing-key</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      branch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  policy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    semver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&gt;=1.0.0&#39;</span></span></code></pre></div><h4 id="argocd-ä¸-flux-é€‰å‹å¯¹æ¯”" tabindex="-1">ArgoCD ä¸ Flux é€‰å‹å¯¹æ¯” <a class="header-anchor" href="#argocd-ä¸-flux-é€‰å‹å¯¹æ¯”" aria-label="Permalink to &quot;ArgoCD ä¸ Flux é€‰å‹å¯¹æ¯”&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>ç»´åº¦</th><th>ArgoCD</th><th>Flux</th></tr></thead><tbody><tr><td><strong>å®‰è£…</strong></td><td>å• YAML éƒ¨ç½²ï¼Œç›¸å¯¹ç®€å•</td><td>CLI bootstrapï¼Œä¸ Git ä»“åº“å¼ºç»‘å®š</td></tr><tr><td><strong>UI</strong></td><td>è‡ªå¸¦ Web UIï¼Œå¼€ç®±å³ç”¨</td><td>æ— å®˜æ–¹ UIï¼Œå¯æ­é… Weave GitOps UI</td></tr><tr><td><strong>å¤šé›†ç¾¤</strong></td><td>åŸç”Ÿå¤šé›†ç¾¤ã€å¤šç§Ÿæˆ·ï¼ˆProjectï¼‰</td><td>æ¯é›†ç¾¤ç‹¬ç«‹ bootstrapï¼Œå¤šé›†ç¾¤é å¤š repo/path</td></tr><tr><td><strong>Helm/Kustomize</strong></td><td>å‡æ”¯æŒï¼Œä¸”æ”¯æŒ Raw/Plugin</td><td>ç‹¬ç«‹ Controllerï¼ŒKustomize/Helm åˆ†ç¦»</td></tr><tr><td><strong>é•œåƒè‡ªåŠ¨æ›´æ–°</strong></td><td>éœ€é…åˆ Argo CD Image Updater æˆ– CI</td><td>å†…ç½® Image Automationï¼ˆImageRepository/ImageUpdateAutomationï¼‰</td></tr><tr><td><strong>ä¸ GitHub/GitLab</strong></td><td>é€šç”¨ Gitï¼Œæ— æ·±åº¦ç»‘å®š</td><td>ä¸ GitHub/GitLab é›†æˆå¥½ï¼ŒPR é©±åŠ¨å¯é€‰</td></tr><tr><td><strong>å£°æ˜å¼é…ç½®</strong></td><td>Application CR</td><td>GitRepository + Kustomization/HelmRelease</td></tr><tr><td><strong>ç¤¾åŒºä¸ç”Ÿæ€</strong></td><td>ä½¿ç”¨å¹¿æ³›ï¼Œä¼ä¸šæ¡ˆä¾‹å¤š</td><td>CNCF å­µåŒ–ï¼Œäº‘åŸç”Ÿç”Ÿæ€ä¸€è‡´</td></tr></tbody></table><p><strong>æˆ‘çš„å»ºè®®</strong>ï¼šå¦‚æœä½ åƒæˆ‘ä¸€æ ·å–œæ¬¢æœ‰å›¾å½¢ç•Œé¢ã€èƒ½å¿«é€ŸæŸ¥çœ‹åº”ç”¨çŠ¶æ€ï¼Œé€‰ ArgoCDï¼›å¦‚æœä½ æ›´åœ¨æ„èµ„æºå ç”¨ã€å–œæ¬¢ä¸€åˆ‡ç”¨ YAML å£°æ˜ï¼Œæˆ–è€…å›¢é˜Ÿé‡Œæœ‰äººç†Ÿæ‚‰ Flux é‚£å¥—æ¨¡å¼ï¼ŒFlux ä¹Ÿä¸é”™ã€‚</p><h2 id="ğŸ—ï¸-ç”Ÿäº§çº§gitopsæ¶æ„è®¾è®¡" tabindex="-1">ğŸ—ï¸ ç”Ÿäº§çº§GitOpsæ¶æ„è®¾è®¡ <a class="header-anchor" href="#ğŸ—ï¸-ç”Ÿäº§çº§gitopsæ¶æ„è®¾è®¡" aria-label="Permalink to &quot;ğŸ—ï¸ ç”Ÿäº§çº§GitOpsæ¶æ„è®¾è®¡&quot;">â€‹</a></h2><h3 id="å¤šé›†ç¾¤ç®¡ç†ç­–ç•¥" tabindex="-1">å¤šé›†ç¾¤ç®¡ç†ç­–ç•¥ <a class="header-anchor" href="#å¤šé›†ç¾¤ç®¡ç†ç­–ç•¥" aria-label="Permalink to &quot;å¤šé›†ç¾¤ç®¡ç†ç­–ç•¥&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚                   å¤šé›†ç¾¤GitOpsæ¶æ„                                â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚                                                                 â”‚</span></span>
<span class="line"><span>â”‚                        Git Repository                           â”‚</span></span>
<span class="line"><span>â”‚              (github.com/your-org/gitops)                       â”‚</span></span>
<span class="line"><span>â”‚                              â”‚                                  â”‚</span></span>
<span class="line"><span>â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚</span></span>
<span class="line"><span>â”‚          â†“                   â†“                   â†“              â”‚</span></span>
<span class="line"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚</span></span>
<span class="line"><span>â”‚   â”‚   å¼€å‘é›†ç¾¤    â”‚   â”‚   æµ‹è¯•é›†ç¾¤    â”‚   â”‚   ç”Ÿäº§é›†ç¾¤    â”‚       â”‚</span></span>
<span class="line"><span>â”‚   â”‚   (Dev)      â”‚   â”‚   (Staging)  â”‚   â”‚   (Prod)     â”‚       â”‚</span></span>
<span class="line"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚</span></span>
<span class="line"><span>â”‚          â”‚                  â”‚                  â”‚               â”‚</span></span>
<span class="line"><span>â”‚   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”       â”‚</span></span>
<span class="line"><span>â”‚   â”‚  ArgoCD/Flux â”‚   â”‚  ArgoCD/Flux â”‚   â”‚  ArgoCD/Flux â”‚       â”‚</span></span>
<span class="line"><span>â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚</span></span>
<span class="line"><span>â”‚                                                                 â”‚</span></span>
<span class="line"><span>â”‚  é…ç½®ç­–ç•¥:                                                       â”‚</span></span>
<span class="line"><span>â”‚  â€¢ Dev: è‡ªåŠ¨åŒæ­¥ + è‡ªåŠ¨é•œåƒæ›´æ–°                                  â”‚</span></span>
<span class="line"><span>â”‚  â€¢ Staging: è‡ªåŠ¨åŒæ­¥ + äººå·¥å®¡æ‰¹é•œåƒ                              â”‚</span></span>
<span class="line"><span>â”‚  â€¢ Prod: äººå·¥è§¦å‘åŒæ­¥ + å¼ºåˆ¶å®¡æ‰¹æµç¨‹                             â”‚</span></span>
<span class="line"><span>â”‚                                                                 â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre></div><h3 id="git-åˆ†æ”¯ç­–ç•¥ä¸åŒæ­¥ç­–ç•¥" tabindex="-1">Git åˆ†æ”¯ç­–ç•¥ä¸åŒæ­¥ç­–ç•¥ <a class="header-anchor" href="#git-åˆ†æ”¯ç­–ç•¥ä¸åŒæ­¥ç­–ç•¥" aria-label="Permalink to &quot;Git åˆ†æ”¯ç­–ç•¥ä¸åŒæ­¥ç­–ç•¥&quot;">â€‹</a></h3><p>GitOps ä¸è¦æ±‚ã€Œåªç”¨å•åˆ†æ”¯ã€ï¼Œåˆ†æ”¯ç­–ç•¥å†³å®šäº†<strong>è°å®¡æ‰¹ã€è°è§¦å‘åŒæ­¥</strong>ï¼š</p><table tabindex="0"><thead><tr><th>ç­–ç•¥</th><th>åšæ³•</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>main å³ç”Ÿäº§</strong></td><td>ç”Ÿäº§ç”¨ <code>main</code>ï¼Œå…¶ä»–ç¯å¢ƒç”¨ç›®å½•ï¼ˆå¦‚ <code>overlays/dev</code>ï¼‰åŒºåˆ†</td><td>å°å›¢é˜Ÿã€ç¯å¢ƒå°‘ï¼Œå¸Œæœ›ç®€å•</td></tr><tr><td><strong>branch-per-env</strong></td><td><code>main</code>ã€<code>staging</code>ã€<code>production</code> å„åˆ†æ”¯ï¼Œæ¯ç¯å¢ƒç›¯å„è‡ªåˆ†æ”¯</td><td>ç¯å¢ƒéš”ç¦»å¼ºã€å‘å¸ƒèŠ‚å¥ä¸åŒ</td></tr><tr><td><strong>trunk-based + ç›®å½•</strong></td><td>å•åˆ†æ”¯ï¼Œç”¨ <code>apps/*/overlays/{dev,staging,prod}</code> åŒºåˆ†ç¯å¢ƒ</td><td>é…ç½®å¤ç”¨é«˜ã€å¸Œæœ› diff æ¸…æ™°</td></tr></tbody></table><p>æ— è®ºå“ªç§æ–¹å¼ï¼Œéƒ½å»ºè®®ï¼š<strong>ç”Ÿäº§ç¯å¢ƒçš„åŒæ­¥</strong>ç”±äººå·¥è§¦å‘æˆ–éœ€å®¡æ‰¹ï¼ˆArgoCD å¯å…³æ‰è¯¥åº”ç”¨çš„ <code>automated</code>ï¼Œæˆ–ä½¿ç”¨ Sync Windowï¼‰ï¼›å¼€å‘/æµ‹è¯•å¯å¼€è‡ªåŠ¨åŒæ­¥ã€‚</p><h3 id="åˆ†å±‚é…ç½®ç®¡ç†" tabindex="-1">åˆ†å±‚é…ç½®ç®¡ç† <a class="header-anchor" href="#åˆ†å±‚é…ç½®ç®¡ç†" aria-label="Permalink to &quot;åˆ†å±‚é…ç½®ç®¡ç†&quot;">â€‹</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åŸºç¡€å±‚ï¼šé€šç”¨é…ç½®ï¼ˆbase/kustomization.yamlï¼‰</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kustomize.config.k8s.io/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Kustomization</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">resources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">deployment.yaml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service.yaml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">configmap.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">commonLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  app.kubernetes.io/part-of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ecommerce-platform</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  app.kubernetes.io/managed-by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">images</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    newName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io/your-org/frontend</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¯å¢ƒå±‚ï¼šç”Ÿäº§ç¯å¢ƒè¦†ç›–ï¼ˆoverlays/production/kustomization.yamlï¼‰</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kustomize.config.k8s.io/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Kustomization</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">resources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">../../base</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ingress.yaml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hpa.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    # ç”Ÿäº§ç¯å¢ƒå¯ç”¨HPA</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pdb.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    # Pod Disruption Budget</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">namePrefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">prod-</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">commonLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">patchesStrategicMerge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">deployment-patch.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # å‰¯æœ¬æ•°ã€èµ„æºé™åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">configmap-patch.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç”Ÿäº§ç¯å¢ƒé…ç½®</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">configMapGenerator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">app-config</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    behavior</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">merge</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    literals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">LOG_LEVEL=warn</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CACHE_TTL=3600</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FEATURE_FLAG_NEW_UI=true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">secretGenerator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">app-secrets</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    envs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">secrets.env</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # åŠ å¯†å­˜å‚¨ï¼Œä½¿ç”¨Sealed Secretsæˆ–SOPS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># éƒ¨ç½²è¡¥ä¸ï¼šèµ„æºé™åˆ¶ï¼ˆoverlays/production/deployment-patch.yamlï¼‰</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        resources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          requests</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;512Mi&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            cpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;250m&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          limits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1Gi&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            cpu</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;500m&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        livenessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/health</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          initialDelaySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        readinessProbe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          httpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/ready</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8080</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          initialDelaySeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          periodSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      affinity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        podAntiAffinity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          preferredDuringSchedulingIgnoredDuringExecution</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            podAffinityTerm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              labelSelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                matchExpressions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  operator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">In</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                  values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              topologyKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kubernetes.io/hostname</span></span></code></pre></div><h3 id="å®‰å…¨æœ€ä½³å®è·µ" tabindex="-1">å®‰å…¨æœ€ä½³å®è·µ <a class="header-anchor" href="#å®‰å…¨æœ€ä½³å®è·µ" aria-label="Permalink to &quot;å®‰å…¨æœ€ä½³å®è·µ&quot;">â€‹</a></h3><h4 id="_1-å¯†é’¥ç®¡ç†" tabindex="-1">1. å¯†é’¥ç®¡ç† <a class="header-anchor" href="#_1-å¯†é’¥ç®¡ç†" aria-label="Permalink to &quot;1. å¯†é’¥ç®¡ç†&quot;">â€‹</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨Sealed SecretsåŠ å¯†æ•æ„Ÿæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. å®‰è£…Sealed Secretsæ§åˆ¶å™¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.24.0/controller.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. å®‰è£…kubeseal CLI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubeseal</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. åŠ å¯†Secret</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret.yaml</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apiVersion: v1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kind: Secret</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  name: db-credentials</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">type: Opaque</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">stringData:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  username: admin</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  password: super-secret-password</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubeseal</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yaml</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret.yaml</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sealed-secret.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. å°†sealed-secret.yamlæäº¤åˆ°Git</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åªæœ‰Sealed Secretsæ§åˆ¶å™¨èƒ½å¤Ÿè§£å¯†</span></span></code></pre></div><p><strong>å¯†é’¥ç®¡ç†æ‰©å±•</strong>ï¼šè‹¥å¸Œæœ›<strong>å¯†é’¥ä¸è½ Git</strong>ï¼Œå¯ç”±é›†ç¾¤å†…ç»„ä»¶ä»å¤–éƒ¨æ‹‰å–ï¼š</p><ul><li><strong>External Secrets Operator (ESO)</strong>ï¼šä» AWS Secrets Managerã€GCP Secret Managerã€HashiCorp Vaultã€Azure Key Vault ç­‰åŒæ­¥åˆ° K8s Secretï¼ŒGit ä¸­åªå­˜ <code>ExternalSecret</code> å£°æ˜ï¼ˆä¸å«å¯†æ–‡ï¼‰ã€‚</li><li><strong>HashiCorp Vault</strong>ï¼šé€šè¿‡ Vault Agent Injector æˆ– ESO çš„ Vault åç«¯ï¼Œåœ¨ Pod å¯åŠ¨æ—¶æ³¨å…¥ç¯å¢ƒå˜é‡æˆ–æ–‡ä»¶ï¼›GitOps åªç®¡ç†åº”ç”¨æ¸…å•ï¼Œå¯†é’¥ç”± Vault ç»Ÿä¸€å‘æ”¾ä¸è½®è½¬ã€‚</li></ul><p>è¿™æ · Git ä»“åº“åªä¿ç•™ã€Œè¦ä»€ä¹ˆ Secretã€ä»å“ªæ¥ã€ï¼Œä¸å­˜æ•æ„Ÿå†…å®¹ï¼Œæ›´åˆ©äºåˆè§„ä¸å®¡è®¡ã€‚</p><h4 id="_2-rbacç­–ç•¥" tabindex="-1">2. RBACç­–ç•¥ <a class="header-anchor" href="#_2-rbacç­–ç•¥" aria-label="Permalink to &quot;2. RBACç­–ç•¥&quot;">â€‹</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ArgoCDé¡¹ç›®çº§éš”ç¦»</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argoproj.io/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AppProject</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Production Environment</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å…è®¸çš„æºä»“åº“</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  sourceRepos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://github.com/your-org/gitops-repo.git&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å…è®¸éƒ¨ç½²çš„ç›®æ ‡é›†ç¾¤å’Œå‘½åç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  destinations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://kubernetes.default.svc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">monitoring</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://kubernetes.default.svc</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å…è®¸çš„èµ„æºç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  clusterResourceWhitelist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Namespace</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;rbac.authorization.k8s.io&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ClusterRole</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å‘½åç©ºé—´çº§èµ„æºç™½åå•</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespaceResourceWhitelist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;apps&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;networking.k8s.io&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ç¦æ­¢çš„èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespaceResourceBlacklist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">group</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ResourceQuota</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # åŒæ­¥çª—å£ï¼ˆç»´æŠ¤çª—å£é™åˆ¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  syncWindows</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">allow</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      schedule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;0 2 * * *&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # æ¯å¤©å‡Œæ™¨2ç‚¹å…è®¸åŒæ­¥</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      duration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">4h</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      namespaces</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">deny</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      schedule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;* * * * *&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # å…¶ä»–æ—¶é—´ç¦æ­¢</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      duration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">20h</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      namespaces</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span></span></code></pre></div><h4 id="_3-ç­–ç•¥å³ä»£ç -opa-gatekeeper" tabindex="-1">3. ç­–ç•¥å³ä»£ç ï¼ˆOPA/Gatekeeperï¼‰ <a class="header-anchor" href="#_3-ç­–ç•¥å³ä»£ç -opa-gatekeeper" aria-label="Permalink to &quot;3. ç­–ç•¥å³ä»£ç ï¼ˆOPA/Gatekeeperï¼‰&quot;">â€‹</a></h4><blockquote><p><strong>æ³¨æ„</strong>ï¼šPSPï¼ˆPod Security Policyï¼‰ç›¸å…³ Constraintï¼ˆå¦‚ <code>K8sPSPPrivilegedContainer</code>ï¼‰åœ¨ Kubernetes 1.21 å¼ƒç”¨ã€1.25 ç§»é™¤ã€‚è‹¥é›†ç¾¤ â‰¥ 1.25ï¼Œè¯·æ”¹ç”¨ <strong>Pod Security Standard (PSS)</strong>ã€<strong>Kyverno</strong> æˆ– Gatekeeper çš„ non-PSP çº¦æŸã€‚</p></blockquote><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¦æ­¢ç‰¹æƒå®¹å™¨ï¼ˆä»…é€‚ç”¨äºä»æ”¯æŒ PSP çš„æ—§é›†ç¾¤ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">constraints.gatekeeper.sh/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">K8sPSPPrivilegedContainer</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">psp-privileged-container</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    kinds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        kinds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Pod&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    excludedNamespaces</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kube-system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;argocd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼ºåˆ¶èµ„æºé™åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">constraints.gatekeeper.sh/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">K8sRequiredResources</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">require-resources</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    kinds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;apps&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        kinds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Deployment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  parameters</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    limits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cpu</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">memory</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    requests</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cpu</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">memory</span></span></code></pre></div><h3 id="ç¾éš¾æ¢å¤-å¦‚æœé›†ç¾¤æŒ‚äº†æ€ä¹ˆåŠ" tabindex="-1">ç¾éš¾æ¢å¤ï¼šå¦‚æœé›†ç¾¤æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ <a class="header-anchor" href="#ç¾éš¾æ¢å¤-å¦‚æœé›†ç¾¤æŒ‚äº†æ€ä¹ˆåŠ" aria-label="Permalink to &quot;ç¾éš¾æ¢å¤ï¼šå¦‚æœé›†ç¾¤æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ&quot;">â€‹</a></h3><p>è¿™æ˜¯æˆ‘ä»¬æœ€åˆæ‹…å¿ƒçš„é—®é¢˜ï¼šå¦‚æœæ•´ä¸ªé›†ç¾¤æŒ‚äº†ï¼Œæˆ–è€…ArgoCDæœ¬èº«å‡ºé—®é¢˜ï¼Œæˆ‘ä»¬æ€ä¹ˆæ¢å¤ï¼Ÿ</p><p>å¥½æ¶ˆæ¯æ˜¯ï¼Œå› ä¸ºæ‰€æœ‰é…ç½®éƒ½åœ¨Gité‡Œï¼Œæ¢å¤å…¶å®ä¸éš¾ã€‚</p><p><strong>åœºæ™¯1ï¼šArgoCDæŒ‚äº†ï¼Œä½†é›†ç¾¤è¿˜åœ¨</strong></p><ul><li>ç›´æ¥é‡æ–°å®‰è£…ArgoCD</li><li>å¦‚æœä½ çš„Applicationå®šä¹‰ä¹Ÿåœ¨Gité‡Œï¼ˆApp of Appsæ¨¡å¼ï¼‰ï¼Œé‡æ–°applyä¸€ä¸‹å°±è¡Œ</li><li>å¦‚æœApplicationåªåœ¨é›†ç¾¤é‡Œ... è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å»ºè®®ç”¨App of Apps</li></ul><p><strong>åœºæ™¯2ï¼šæ•´ä¸ªé›†ç¾¤æŒ‚äº†</strong></p><ul><li>æ–°å»ºä¸€ä¸ªé›†ç¾¤</li><li>å®‰è£…ArgoCD</li><li>ä»Gitæ¢å¤é…ç½®</li></ul><p>å…³é”®æ˜¯ï¼š<strong>Gitä»“åº“é‡Œè¦æœ‰æ‰€æœ‰ä¸œè¥¿</strong>ã€‚K8s manifestsã€Helm valuesã€Applicationå®šä¹‰ï¼Œéƒ½è¦åœ¨Gité‡Œã€‚å¯†é’¥ç”¨Sealed Secretsï¼Œè¿™æ ·ä¹Ÿèƒ½å­˜Gitã€‚</p><p><strong>å¤‡ä»½ç­–ç•¥</strong>ï¼š</p><ul><li>Gitä»“åº“æœ¬èº«è¦å¤‡ä»½ï¼ˆGitLab/GitHubéƒ½æœ‰å¤‡ä»½æœºåˆ¶ï¼‰</li><li>å®šæœŸå¯¼å‡ºArgoCDé…ç½®ï¼ˆè™½ç„¶æˆ‘ä»¬åŸºæœ¬æ²¡ç”¨åˆ°è¿‡ï¼‰</li><li>æµ‹è¯•è¿‡æ¢å¤æµç¨‹å—ï¼Ÿæˆ‘ä»¬æ¯å­£åº¦ä¼šåšä¸€æ¬¡ç¾éš¾æ¢å¤æ¼”ç»ƒ</li></ul><h2 id="ğŸ“Š-å¯è§‚æµ‹æ€§ä¸ç›‘æ§" tabindex="-1">ğŸ“Š å¯è§‚æµ‹æ€§ä¸ç›‘æ§ <a class="header-anchor" href="#ğŸ“Š-å¯è§‚æµ‹æ€§ä¸ç›‘æ§" aria-label="Permalink to &quot;ğŸ“Š å¯è§‚æµ‹æ€§ä¸ç›‘æ§&quot;">â€‹</a></h2><h3 id="gitopsç›‘æ§ä½“ç³»" tabindex="-1">GitOpsç›‘æ§ä½“ç³» <a class="header-anchor" href="#gitopsç›‘æ§ä½“ç³»" aria-label="Permalink to &quot;GitOpsç›‘æ§ä½“ç³»&quot;">â€‹</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Prometheusç›‘æ§ArgoCD</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">monitoring.coreos.com/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ServiceMonitor</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd-metrics</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">monitoring</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app.kubernetes.io/part-of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  endpoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">metrics</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      interval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">30s</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/metrics</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ArgoCDå…³é”®å‘Šè­¦è§„åˆ™</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">monitoring.coreos.com/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PrometheusRule</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd-alerts</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">monitoring</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  groups</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ArgoCDApplicationNotSynced</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          expr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            argocd_app_info{sync_status!=&quot;Synced&quot;} == 1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5m</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            severity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">warning</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            summary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ArgoCDåº”ç”¨ {{ $labels.name }} æœªåŒæ­¥&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;åº”ç”¨ {{ $labels.name }} å¤„äº {{ $labels.sync_status }} çŠ¶æ€è¶…è¿‡5åˆ†é’Ÿ&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ArgoCDApplicationUnhealthy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          expr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            argocd_app_info{health_status!=&quot;Healthy&quot;} == 1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">5m</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            severity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">critical</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            summary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ArgoCDåº”ç”¨ {{ $labels.name }} ä¸å¥åº·&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;åº”ç”¨ {{ $labels.name }} å¥åº·çŠ¶æ€ä¸º {{ $labels.health_status }}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">alert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ArgoCDSyncFailed</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          expr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            increase(argocd_app_sync_total{phase!=&quot;Succeeded&quot;}[1h]) &gt; 3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            severity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">warning</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            summary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ArgoCDåº”ç”¨åŒæ­¥é¢‘ç¹å¤±è´¥&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;åº”ç”¨ {{ $labels.name }} åœ¨è¿‡å»1å°æ—¶å†…åŒæ­¥å¤±è´¥è¶…è¿‡3æ¬¡&quot;</span></span></code></pre></div><h3 id="é€šçŸ¥é›†æˆ" tabindex="-1">é€šçŸ¥é›†æˆ <a class="header-anchor" href="#é€šçŸ¥é›†æˆ" aria-label="Permalink to &quot;é€šçŸ¥é›†æˆ&quot;">â€‹</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ArgoCDé€šçŸ¥é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd-notifications-cm</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argocd</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  service.slack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    token: $slack-token</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template.app-sync-succeeded</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    message: |</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      âœ… *åº”ç”¨åŒæ­¥æˆåŠŸ*</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      åº”ç”¨: {{.app.metadata.name}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ç¯å¢ƒ: {{.app.spec.destination.namespace}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ç‰ˆæœ¬: {{.app.status.sync.revision}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      åŒæ­¥æ—¶é—´: {{.app.status.operationState.finishedAt}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      {{if .app.status.operationState.syncResult.resources}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      æ›´æ–°èµ„æº:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      {{range .app.status.operationState.syncResult.resources}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      â€¢ {{.kind}}/{{.name}} ({{.status}})</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      {{end}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      {{end}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    slack:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      attachments: |</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        [{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          &quot;title&quot;: &quot;{{.app.metadata.name}}&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          &quot;title_link&quot;: &quot;{{.context.argocdUrl}}/applications/{{.app.metadata.name}}&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          &quot;color&quot;: &quot;#18be18&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          &quot;fields&quot;: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            {&quot;title&quot;: &quot;ç¯å¢ƒ&quot;, &quot;value&quot;: &quot;{{.app.spec.destination.namespace}}&quot;, &quot;short&quot;: true},</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            {&quot;title&quot;: &quot;ç‰ˆæœ¬&quot;, &quot;value&quot;: &quot;{{.app.status.sync.revision}}&quot;, &quot;short&quot;: true}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          ]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        }]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  trigger.on-sync-succeeded</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    - description: åº”ç”¨åŒæ­¥æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      oncePer: app.status.operationState.syncResult.revision</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      send:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        - app-sync-succeeded</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      when: app.status.operationState.phase in [&#39;Succeeded&#39;]</span></span></code></pre></div><h2 id="ğŸš€-ci-cdä¸gitopsé›†æˆ" tabindex="-1">ğŸš€ CI/CDä¸GitOpsé›†æˆ <a class="header-anchor" href="#ğŸš€-ci-cdä¸gitopsé›†æˆ" aria-label="Permalink to &quot;ğŸš€ CI/CDä¸GitOpsé›†æˆ&quot;">â€‹</a></h2><h3 id="å®Œæ•´äº¤ä»˜æµæ°´çº¿" tabindex="-1">å®Œæ•´äº¤ä»˜æµæ°´çº¿ <a class="header-anchor" href="#å®Œæ•´äº¤ä»˜æµæ°´çº¿" aria-label="Permalink to &quot;å®Œæ•´äº¤ä»˜æµæ°´çº¿&quot;">â€‹</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .github/workflows/gitops-pipeline.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GitOps Delivery Pipeline</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;v*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  REGISTRY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ghcr.io</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  IMAGE_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ github.repository }}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  build-and-push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    permissions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      contents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">read</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      packages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    outputs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image_tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ steps.meta.outputs.tags }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image_digest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ steps.build.outputs.digest }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checkout</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Set up Docker Buildx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker/setup-buildx-action@v3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Log in to Container Registry</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker/login-action@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          registry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ env.REGISTRY }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          username</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ github.actor }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Extract metadata</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">meta</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker/metadata-action@v5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          images</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ env.REGISTRY }}/\${{ env.IMAGE_NAME }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            type=ref,event=branch</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            type=semver,pattern={{version}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            type=semver,pattern={{major}}.{{minor}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            type=sha,prefix=,suffix=,format=short</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Build and push</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker/build-push-action@v5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ steps.meta.outputs.tags }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ steps.meta.outputs.labels }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          cache-from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">type=gha</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          cache-to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">type=gha,mode=max</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          platforms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">linux/amd64,linux/arm64</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Generate SBOM</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">anchore/sbom-action@v0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ steps.meta.outputs.tags }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">spdx-json</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          output-file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sbom.spdx.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Upload SBOM</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/upload-artifact@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sbom</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sbom.spdx.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  security-scan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build-and-push</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Run Trivy vulnerability scanner</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aquasecurity/trivy-action@master</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          image-ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ needs.build-and-push.outputs.image_tag }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sarif&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;trivy-results.sarif&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Upload scan results</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">github/codeql-action/upload-sarif@v2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          sarif_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;trivy-results.sarif&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  update-gitops</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build-and-push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">security-scan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">github.ref == &#39;refs/heads/main&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checkout GitOps repo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          repository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-org/gitops-repo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.GITOPS_TOKEN }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Install yq</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 &amp;&amp; sudo chmod +x /usr/local/bin/yq</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Update image tag</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          yq eval &quot;.images[0].newTag = \\&quot;\${{ github.sha }}\\&quot;&quot; \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            -i apps/frontend/overlays/dev/kustomization.yaml</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Commit and push</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          git config user.name &quot;GitOps Bot&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          git config user.email &quot;gitops@example.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          git add .</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          git commit -m &quot;ci: update frontend image to \${{ github.sha }}&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          git push</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  deploy-staging</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    needs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">update-gitops</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">staging</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Create deployment PR</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">peter-evans/create-pull-request@v5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.GITOPS_TOKEN }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          repository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-org/gitops-repo</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Deploy \${{ github.sha }} to Staging&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            ## Deployment Request</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            **Image:** \`\${{ needs.build-and-push.outputs.image_tag }}\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            **Commit:** \${{ github.sha }}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            **Author:** \${{ github.actor }}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            ### Changes</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            \${{ github.event.head_commit.message }}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            ### Checklist</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            - [ ] Code review completed</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            - [ ] Tests passed</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            - [ ] Security scan clean</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Login to ArgoCD (éœ€åœ¨ repo ä¸­é…ç½® ARGOCD_SERVERã€ARGOCD_AUTH_TOKEN ç­‰)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          argocd login \${{ secrets.ARGOCD_SERVER }} \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            --auth-token \${{ secrets.ARGOCD_AUTH_TOKEN }} \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            --grpc-web</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Wait for ArgoCD sync</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          argocd app wait staging-frontend \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            --health \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            --timeout 600</span></span></code></pre></div><h2 id="ğŸ“ˆ-gitopsæˆç†Ÿåº¦æ¨¡å‹" tabindex="-1">ğŸ“ˆ GitOpsæˆç†Ÿåº¦æ¨¡å‹ <a class="header-anchor" href="#ğŸ“ˆ-gitopsæˆç†Ÿåº¦æ¨¡å‹" aria-label="Permalink to &quot;ğŸ“ˆ GitOpsæˆç†Ÿåº¦æ¨¡å‹&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>çº§åˆ«</th><th>åç§°</th><th>ç‰¹å¾</th><th>å…³é”®æŒ‡æ ‡</th></tr></thead><tbody><tr><td><strong>L1</strong></td><td>åŸºç¡€</td><td>â€¢ æ‰‹åŠ¨éƒ¨ç½²<br>â€¢ é…ç½®åˆ†æ•£<br>â€¢ ç¼ºä¹ç‰ˆæœ¬æ§åˆ¶</td><td>éƒ¨ç½²é¢‘ç‡: æœˆ/å­£åº¦<br>æ¢å¤æ—¶é—´: å¤©/å‘¨</td></tr><tr><td><strong>L2</strong></td><td>æ ‡å‡†åŒ–</td><td>â€¢ Gitç®¡ç†é…ç½®<br>â€¢ åŸºç¡€CI/CD<br>â€¢ å•ä¸€ç¯å¢ƒ</td><td>éƒ¨ç½²é¢‘ç‡: å‘¨<br>æ¢å¤æ—¶é—´: å°æ—¶</td></tr><tr><td><strong>L3</strong></td><td>è‡ªåŠ¨åŒ–</td><td>â€¢ GitOpså·¥å…·å¼•å…¥<br>â€¢ å¤šç¯å¢ƒç®¡ç†<br>â€¢ è‡ªåŠ¨åŒæ­¥</td><td>éƒ¨ç½²é¢‘ç‡: å¤©<br>æ¢å¤æ—¶é—´: åˆ†é’Ÿ</td></tr><tr><td><strong>L4</strong></td><td>ä¼˜åŒ–</td><td>â€¢ é‡‘ä¸é›€/è“ç»¿éƒ¨ç½²<br>â€¢ è‡ªåŠ¨å›æ»š<br>â€¢ ç­–ç•¥å³ä»£ç </td><td>éƒ¨ç½²é¢‘ç‡: å°æ—¶<br>æ¢å¤æ—¶é—´: &lt;5åˆ†é’Ÿ</td></tr><tr><td><strong>L5</strong></td><td>æ™ºèƒ½åŒ–</td><td>â€¢ AIOpsé›†æˆ<br>â€¢ é¢„æµ‹æ€§è¿ç»´<br>â€¢ å…¨è‡ªåŠ¨åŒ–</td><td>éƒ¨ç½²é¢‘ç‡: æŒ‰éœ€<br>æ¢å¤æ—¶é—´: è‡ªåŠ¨</td></tr></tbody></table><p><strong>å…³äºæˆæœ¬</strong>ï¼šå¾ˆå¤šäººé—®æˆ‘ä¸ŠGitOpsä¼šä¸ä¼šå¢åŠ æˆæœ¬ã€‚è¯´å®è¯ï¼Œä¼šæœ‰ä¸€ç‚¹ï¼š</p><ul><li>ArgoCDæœ¬èº«è¦å èµ„æºï¼ˆæˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒç»™äº†2æ ¸4Gï¼‰</li><li>CIè·‘å¾—æ›´é¢‘ç¹äº†ï¼ˆæ¯æ¬¡æäº¤éƒ½è§¦å‘ï¼‰</li><li>å›¢é˜Ÿéœ€è¦æ—¶é—´å­¦ä¹ </li></ul><p>ä½†è¿™äº›éƒ½æ˜¯å‰æœŸæŠ•å…¥ã€‚é•¿æœŸçœ‹ï¼Œå› ä¸ºé…ç½®æ¼‚ç§»å°‘äº†ã€æ•…éšœæ¢å¤å¿«äº†ï¼Œåè€ŒèŠ‚çœäº†æˆæœ¬ã€‚æˆ‘ä»¬ç»Ÿè®¡è¿‡ï¼Œä¸Šäº†GitOpsä¹‹åçš„åŠå¹´ï¼Œå‡Œæ™¨on-callçš„æ¬¡æ•°å‡å°‘äº†60%ã€‚</p><h2 id="ğŸ¯-å®æ–½è·¯çº¿å›¾" tabindex="-1">ğŸ¯ å®æ–½è·¯çº¿å›¾ <a class="header-anchor" href="#ğŸ¯-å®æ–½è·¯çº¿å›¾" aria-label="Permalink to &quot;ğŸ¯ å®æ–½è·¯çº¿å›¾&quot;">â€‹</a></h2><h3 id="ç¬¬ä¸€é˜¶æ®µ-åŸºç¡€å»ºè®¾-1-2å‘¨" tabindex="-1">ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å»ºè®¾ï¼ˆ1-2å‘¨ï¼‰ <a class="header-anchor" href="#ç¬¬ä¸€é˜¶æ®µ-åŸºç¡€å»ºè®¾-1-2å‘¨" aria-label="Permalink to &quot;ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å»ºè®¾ï¼ˆ1-2å‘¨ï¼‰&quot;">â€‹</a></h3><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_0" disabled="true"><label for="cbx_0"> å»ºç«‹Gitä»“åº“ç»“æ„</label></li><li class="task-list-item"><input type="checkbox" id="cbx_1" disabled="true"><label for="cbx_1"> é€‰æ‹©GitOpså·¥å…·ï¼ˆArgoCD/Fluxï¼‰</label></li><li class="task-list-item"><input type="checkbox" id="cbx_2" disabled="true"><label for="cbx_2"> éƒ¨ç½²æ§åˆ¶å™¨åˆ°å¼€å‘ç¯å¢ƒ</label></li><li class="task-list-item"><input type="checkbox" id="cbx_3" disabled="true"><label for="cbx_3"> è¿ç§»1-2ä¸ªç®€å•åº”ç”¨</label></li></ul><h3 id="ç¬¬äºŒé˜¶æ®µ-æµç¨‹å®Œå–„-3-4å‘¨" tabindex="-1">ç¬¬äºŒé˜¶æ®µï¼šæµç¨‹å®Œå–„ï¼ˆ3-4å‘¨ï¼‰ <a class="header-anchor" href="#ç¬¬äºŒé˜¶æ®µ-æµç¨‹å®Œå–„-3-4å‘¨" aria-label="Permalink to &quot;ç¬¬äºŒé˜¶æ®µï¼šæµç¨‹å®Œå–„ï¼ˆ3-4å‘¨ï¼‰&quot;">â€‹</a></h3><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_4" disabled="true"><label for="cbx_4"> å»ºç«‹å¤šç¯å¢ƒé…ç½®ç®¡ç†</label></li><li class="task-list-item"><input type="checkbox" id="cbx_5" disabled="true"><label for="cbx_5"> é›†æˆCI/CDæµæ°´çº¿</label></li><li class="task-list-item"><input type="checkbox" id="cbx_6" disabled="true"><label for="cbx_6"> å®æ–½å¯†é’¥ç®¡ç†æ–¹æ¡ˆ</label></li><li class="task-list-item"><input type="checkbox" id="cbx_7" disabled="true"><label for="cbx_7"> é…ç½®ç›‘æ§å‘Šè­¦</label></li></ul><h3 id="ç¬¬ä¸‰é˜¶æ®µ-è§„æ¨¡åŒ–æ¨å¹¿-1-2æœˆ" tabindex="-1">ç¬¬ä¸‰é˜¶æ®µï¼šè§„æ¨¡åŒ–æ¨å¹¿ï¼ˆ1-2æœˆï¼‰ <a class="header-anchor" href="#ç¬¬ä¸‰é˜¶æ®µ-è§„æ¨¡åŒ–æ¨å¹¿-1-2æœˆ" aria-label="Permalink to &quot;ç¬¬ä¸‰é˜¶æ®µï¼šè§„æ¨¡åŒ–æ¨å¹¿ï¼ˆ1-2æœˆï¼‰&quot;">â€‹</a></h3><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_8" disabled="true"><label for="cbx_8"> åˆ¶å®šGitOpsè§„èŒƒ</label></li><li class="task-list-item"><input type="checkbox" id="cbx_9" disabled="true"><label for="cbx_9"> è¿ç§»æ ¸å¿ƒä¸šåŠ¡åº”ç”¨</label></li><li class="task-list-item"><input type="checkbox" id="cbx_10" disabled="true"><label for="cbx_10"> å®æ–½ç­–ç•¥å³ä»£ç </label></li><li class="task-list-item"><input type="checkbox" id="cbx_11" disabled="true"><label for="cbx_11"> å»ºç«‹åŸ¹è®­ä½“ç³»</label></li></ul><h3 id="ç¬¬å››é˜¶æ®µ-æŒç»­ä¼˜åŒ–-æŒç»­" tabindex="-1">ç¬¬å››é˜¶æ®µï¼šæŒç»­ä¼˜åŒ–ï¼ˆæŒç»­ï¼‰ <a class="header-anchor" href="#ç¬¬å››é˜¶æ®µ-æŒç»­ä¼˜åŒ–-æŒç»­" aria-label="Permalink to &quot;ç¬¬å››é˜¶æ®µï¼šæŒç»­ä¼˜åŒ–ï¼ˆæŒç»­ï¼‰&quot;">â€‹</a></h3><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_12" disabled="true"><label for="cbx_12"> å®æ–½æ¸è¿›å¼äº¤ä»˜</label></li><li class="task-list-item"><input type="checkbox" id="cbx_13" disabled="true"><label for="cbx_13"> AIOpsé›†æˆ</label></li><li class="task-list-item"><input type="checkbox" id="cbx_14" disabled="true"><label for="cbx_14"> æˆæœ¬ä¼˜åŒ–</label></li><li class="task-list-item"><input type="checkbox" id="cbx_15" disabled="true"><label for="cbx_15"> æ€§èƒ½è°ƒä¼˜</label></li></ul><h2 id="ğŸ”§-å¸¸è§æ•…éšœæ’æŸ¥" tabindex="-1">ğŸ”§ å¸¸è§æ•…éšœæ’æŸ¥ <a class="header-anchor" href="#ğŸ”§-å¸¸è§æ•…éšœæ’æŸ¥" aria-label="Permalink to &quot;ğŸ”§ å¸¸è§æ•…éšœæ’æŸ¥&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>ç°è±¡</th><th>å¯èƒ½åŸå› </th><th>æ’æŸ¥æ€è·¯</th></tr></thead><tbody><tr><td><strong>Sync å¤±è´¥</strong></td><td>manifest ä¸åˆæ³•ã€RBAC ä¸è¶³ã€ç›®æ ‡å‘½åç©ºé—´ä¸å­˜åœ¨</td><td>åœ¨ ArgoCD UI çœ‹ Sync è¯¦æƒ…ä¸é”™è¯¯ä¿¡æ¯ï¼›<code>argocd app logs &lt;app&gt;</code>ï¼›æ£€æŸ¥ Application çš„ <code>destination.namespace</code> ä¸ Project çš„ <code>destinations</code> æ˜¯å¦å…è®¸</td></tr><tr><td><strong>Health ä¸€ç›´ Progressing/Degraded</strong></td><td>æ¢é’ˆé…ç½®ä¸å½“ã€ä¾èµ–æœåŠ¡æœªå°±ç»ªã€èµ„æºä¸è¶³</td><td>æŸ¥ Pod çš„ <code>kubectl describe pod</code>ã€åº”ç”¨æ—¥å¿—ï¼›æ ¸å¯¹ Deployment çš„ <code>livenessProbe</code>/<code>readinessProbe</code> è·¯å¾„ä¸ç«¯å£ï¼›ç¡®è®¤ä¾èµ–ï¼ˆå¦‚ DBã€ç¼“å­˜ï¼‰å·²å°±ç»ª</td></tr><tr><td><strong>ImagePullBackOff</strong></td><td>é•œåƒä¸å­˜åœ¨ã€ç§æœ‰ä»“åº“æœªé…ç½® pull secret</td><td>ç¡®è®¤é•œåƒ tag å­˜åœ¨ã€å‘½åç©ºé—´ä¸‹æ˜¯å¦æœ‰ <code>imagePullSecrets</code>ï¼›ArgoCD å¯é…ç½® repo çš„ pull secret æˆ–ä½¿ç”¨ default service account çš„ imagePullSecrets</td></tr><tr><td><strong>Sync æˆåŠŸä½†æ— å˜æ›´</strong></td><td>æœªè§¦å‘åŒæ­¥ã€ç¼“å­˜æœªåˆ·æ–°ã€path/revision é”™è¯¯</td><td>ä½¿ç”¨ã€ŒHard Refreshã€æˆ–å‹¾é€‰ã€ŒReplaceã€ï¼›ç¡®è®¤ <code>targetRevision</code> ä¸ <code>path</code> æŒ‡å‘é¢„æœŸåˆ†æ”¯ä¸ç›®å½•</td></tr><tr><td><strong>Prune è¯¯åˆ èµ„æº</strong></td><td>èµ„æºæœªåœ¨ Git ä¸­å£°æ˜å´è¢« ArgoCD ç®¡ç†</td><td>æ£€æŸ¥æ˜¯å¦è¢«åŒä¸€ Application çš„ selector åŒ…å«ï¼›å¿…è¦æ—¶ä¸ºä¸åº”è¢« prune çš„èµ„æºåŠ  <code>argocd.argoproj.io/sync-options: Prune=false</code></td></tr></tbody></table><p>æ’æŸ¥çš„æ—¶å€™æœ‰ä¸ªç»éªŒï¼š<strong>å…ˆçœ‹ArgoCD UIï¼Œå†çœ‹kubectl</strong>ã€‚ArgoCD UIé‡Œèƒ½çœ‹åˆ°åŒæ­¥çŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯ï¼Œä½†æœ‰æ—¶å€™ä¸å¤Ÿè¯¦ç»†ï¼Œè¿˜å¾—<code>kubectl describe pod</code>çœ‹å…·ä½“åŸå› ã€‚å¦å¤–å»ºè®®å¼€å¯ArgoCDçš„é€šçŸ¥ï¼ŒåŒæ­¥å¤±è´¥çš„æ—¶å€™ç›´æ¥æ¨é€åˆ°Slackï¼Œä¸ç”¨ä¸€ç›´ç›¯ç€UIçœ‹ã€‚</p><h2 id="ğŸ’¡-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" tabindex="-1">ğŸ’¡ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ <a class="header-anchor" href="#ğŸ’¡-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" aria-label="Permalink to &quot;ğŸ’¡ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ&quot;">â€‹</a></h2><h3 id="q1-gitopsé€‚åˆæˆ‘ä»¬å›¢é˜Ÿå—" tabindex="-1">Q1: GitOpsé€‚åˆæˆ‘ä»¬å›¢é˜Ÿå—ï¼Ÿ <a class="header-anchor" href="#q1-gitopsé€‚åˆæˆ‘ä»¬å›¢é˜Ÿå—" aria-label="Permalink to &quot;Q1: GitOpsé€‚åˆæˆ‘ä»¬å›¢é˜Ÿå—ï¼Ÿ&quot;">â€‹</a></h3><p><strong>A:</strong> è¿™ä¸ªé—®é¢˜æˆ‘è¢«é—®è¿‡å¥½å¤šæ¬¡ã€‚å¦ç™½è¯´ï¼Œä¸æ˜¯æ‰€æœ‰å›¢é˜Ÿéƒ½é€‚åˆã€‚</p><p><strong>æ¯”è¾ƒé€‚åˆçš„æƒ…å†µï¼š</strong></p><ul><li>å·²ç»åœ¨ç”¨Kubernetesäº†ï¼ˆè¿™æ˜¯å‰æï¼‰</li><li>éƒ¨ç½²æ¯”è¾ƒé¢‘ç¹ï¼Œæ¯å‘¨è‡³å°‘å¥½å‡ æ¬¡</li><li>æœ‰å¤šä¸ªç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰éœ€è¦ç®¡ç†</li><li>å¯¹å˜æ›´æœ‰å®¡è®¡è¦æ±‚ï¼ˆæ¯”å¦‚é‡‘èã€åŒ»ç–—è¡Œä¸šï¼‰</li></ul><p><strong>ä¸å¤ªé€‚åˆçš„æƒ…å†µï¼š</strong></p><ul><li>è¿˜åœ¨ç”¨ä¼ ç»Ÿè™šæ‹Ÿæœºéƒ¨ç½²ï¼Œæ²¡æœ‰ä¸ŠK8sçš„è®¡åˆ’</li><li>å°±ä¸€ä¸ªå•ä½“åº”ç”¨ï¼Œéƒ¨ç½²ä¹Ÿå¾ˆç®€å•</li><li>å›¢é˜Ÿé‡Œæ²¡äººæ‡‚K8sï¼Œæƒ³å­¦GitOpsä½†æ˜¯è¿Podæ˜¯ä»€ä¹ˆéƒ½ä¸çŸ¥é“</li></ul><p>æˆ‘ä¸ªäººçš„ç»éªŒæ˜¯ï¼š<strong>å¦‚æœä½ å·²ç»åœ¨ç”¨K8säº†ï¼ŒGitOpså€¼å¾—å°è¯•</strong>ã€‚å¦‚æœä½ è¿˜åœ¨VMæ—¶ä»£ï¼Œå…ˆæŠŠK8sæå®šå†è¯´ã€‚</p><h3 id="q2-æ•°æ®åº“schemaå˜æ›´æ€ä¹ˆå¤„ç†" tabindex="-1">Q2: æ•°æ®åº“Schemaå˜æ›´æ€ä¹ˆå¤„ç†ï¼Ÿ <a class="header-anchor" href="#q2-æ•°æ®åº“schemaå˜æ›´æ€ä¹ˆå¤„ç†" aria-label="Permalink to &quot;Q2: æ•°æ®åº“Schemaå˜æ›´æ€ä¹ˆå¤„ç†ï¼Ÿ&quot;">â€‹</a></h3><p><strong>A:</strong> è¿™æ˜¯ä¸ªè€å¤§éš¾é—®é¢˜ã€‚æˆ‘ä»¬ç”¨çš„æ˜¯Flywayï¼Œé…åˆArgoCDçš„Hookæ¥åšã€‚</p><p>åŸç†å¾ˆç®€å•ï¼šåœ¨éƒ¨ç½²åº”ç”¨ä¹‹å‰ï¼Œå…ˆè·‘ä¸€ä¸ªJobæ‰§è¡Œæ•°æ®åº“è¿ç§»ã€‚ArgoCDæ”¯æŒPreSync Hookï¼Œå°±æ˜¯åœ¨æ­£å¼åŒæ­¥ä¹‹å‰æ‰§è¡Œä¸€äº›æ“ä½œã€‚</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨Flyway/liquibase Jobå¤„ç†Schema</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">batch/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Job</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db-migration</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  annotations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    argocd.argoproj.io/hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PreSync</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # ArgoCDåŒæ­¥å‰æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    argocd.argoproj.io/hook-delete-policy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">BeforeHookCreation</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flyway</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flyway/flyway:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">flyway</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">migrate</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">FLYWAY_URL</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            valueFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              secretKeyRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db-credentials</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">                key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">url</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      restartPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">OnFailure</span></span></code></pre></div><h3 id="q3-ç§æœ‰ä»“åº“å¦‚ä½•é…ç½®" tabindex="-1">Q3: ç§æœ‰ä»“åº“å¦‚ä½•é…ç½®ï¼Ÿ <a class="header-anchor" href="#q3-ç§æœ‰ä»“åº“å¦‚ä½•é…ç½®" aria-label="Permalink to &quot;Q3: ç§æœ‰ä»“åº“å¦‚ä½•é…ç½®ï¼Ÿ&quot;">â€‹</a></h3><p><strong>A:</strong> ä½¿ç”¨SSHå¯†é’¥æˆ–Tokenï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºSSHå¯†é’¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ed25519</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;argocd@example.com&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœ¨ArgoCDä¸­é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">argocd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git@github.com:your-org/private-repo.git</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --ssh-private-key-path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/id_ed25519</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --insecure-ignore-host-key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æˆ–ä½¿ç”¨HTTPS Token</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">argocd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/your-org/private-repo.git</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --username</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x-access-token</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $GITHUB_TOKEN</span></span></code></pre></div><h3 id="q4-å¦‚ä½•å®ç°è“ç»¿éƒ¨ç½²" tabindex="-1">Q4: å¦‚ä½•å®ç°è“ç»¿éƒ¨ç½²ï¼Ÿ <a class="header-anchor" href="#q4-å¦‚ä½•å®ç°è“ç»¿éƒ¨ç½²" aria-label="Permalink to &quot;Q4: å¦‚ä½•å®ç°è“ç»¿éƒ¨ç½²ï¼Ÿ&quot;">â€‹</a></h3><p><strong>A:</strong> ä½¿ç”¨ArgoCD Rolloutsï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">argoproj.io/v1alpha1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Rollout</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  replicas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  strategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    blueGreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      activeService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-active</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      previewService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-preview</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      autoPromotionEnabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # äººå·¥å®¡æ‰¹åˆ‡æµ</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      prePromotionAnalysis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        templates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">templateName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">smoke-test</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">service-name</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-preview</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  selector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    matchLabels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ... Podæ¨¡æ¿</span></span></code></pre></div><h2 id="ğŸ”®-gitopsçš„æœªæ¥è¶‹åŠ¿" tabindex="-1">ğŸ”® GitOpsçš„æœªæ¥è¶‹åŠ¿ <a class="header-anchor" href="#ğŸ”®-gitopsçš„æœªæ¥è¶‹åŠ¿" aria-label="Permalink to &quot;ğŸ”® GitOpsçš„æœªæ¥è¶‹åŠ¿&quot;">â€‹</a></h2><ol><li><strong>AIé©±åŠ¨çš„GitOps</strong>ï¼šæ™ºèƒ½å¼‚å¸¸æ£€æµ‹ã€è‡ªåŠ¨ä¿®å¤ã€é¢„æµ‹æ€§æ‰©å±•</li><li><strong>å¤šäº‘GitOps</strong>ï¼šè·¨äº‘å¹³å°çš„ç»Ÿä¸€é…ç½®ç®¡ç†</li><li><strong>è¾¹ç¼˜GitOps</strong>ï¼šIoTå’Œè¾¹ç¼˜è®¡ç®—çš„å£°æ˜å¼ç®¡ç†</li><li><strong>FinOpsé›†æˆ</strong>ï¼šæˆæœ¬å¯è§æ€§å’Œä¼˜åŒ–</li><li><strong>Policy as Codeè¿›åŒ–</strong>ï¼šæ›´æ™ºèƒ½çš„åˆè§„å’Œæ²»ç†</li></ol><hr><h2 id="ğŸ“-å†™åœ¨æœ€å" tabindex="-1">ğŸ“ å†™åœ¨æœ€å <a class="header-anchor" href="#ğŸ“-å†™åœ¨æœ€å" aria-label="Permalink to &quot;ğŸ“ å†™åœ¨æœ€å&quot;">â€‹</a></h2><p>å†™åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³è¯´å‡ å¥å¿ƒé‡Œè¯ã€‚</p><p>GitOpsç¡®å®å¸®äº†æˆ‘ä»¬å¤§å¿™ï¼Œä½†å®ƒ<strong>ä¸æ˜¯é“¶å¼¹</strong>ï¼Œæ›´ä¸æ˜¯ä»€ä¹ˆ&quot;é¢ è¦†æ€§çš„é©å‘½&quot;ã€‚å®ƒåªæ˜¯ä¸€ç§æ›´å¥½çš„å·¥ä½œæ–¹å¼ï¼Œè§£å†³äº†æˆ‘ä»¬ä¹‹å‰é‡åˆ°çš„å¾ˆå¤šç—›ç‚¹ã€‚</p><p>å›é¡¾è¿™ä¸€å¹´å¤šçš„å®è·µï¼Œæˆ‘è§‰å¾—GitOpsæœ€å¤§çš„ä»·å€¼ä¸æ˜¯é‚£äº›èŠ±é‡Œèƒ¡å“¨çš„åŠŸèƒ½ï¼Œè€Œæ˜¯<strong>è®©åŸºç¡€è®¾æ–½ç®¡ç†å˜å¾—åƒä»£ç ç®¡ç†ä¸€æ ·ç®€å•</strong>ã€‚ç‰ˆæœ¬æ§åˆ¶ã€Code Reviewã€CI/CDï¼Œè¿™äº›è½¯ä»¶å¼€å‘é‡Œçš„æœ€ä½³å®è·µï¼Œç°åœ¨ä¹Ÿèƒ½ç”¨åœ¨è¿ç»´ä¸Šäº†ã€‚</p><p>å½“ç„¶ï¼Œä»£ä»·ä¹Ÿæ˜¯æœ‰çš„ï¼š</p><ul><li>å­¦ä¹ æˆæœ¬ï¼šå›¢é˜Ÿæˆå‘˜éœ€è¦ç†è§£å£°æ˜å¼é…ç½®ã€Kustomizeè¿™äº›æ¦‚å¿µ</li><li>å·¥å…·å¤æ‚åº¦ï¼šArgoCDæœ¬èº«å°±éœ€è¦ç»´æŠ¤ï¼Œå‡çº§çš„æ—¶å€™ä¹Ÿè¦å°å¿ƒ</li><li>ä¸é€‚ç”¨äºæ‰€æœ‰åœºæ™¯ï¼šä¼ ç»ŸVMéƒ¨ç½²ã€ç®€å•çš„å•åº”ç”¨æ¶æ„ï¼Œå¼ºè¡Œä¸ŠGitOpså¯èƒ½å¾—ä¸å¿å¤±</li></ul><h3 id="æˆ‘çš„å»ºè®®" tabindex="-1">æˆ‘çš„å»ºè®® <a class="header-anchor" href="#æˆ‘çš„å»ºè®®" aria-label="Permalink to &quot;æˆ‘çš„å»ºè®®&quot;">â€‹</a></h3><p>å¦‚æœä½ æ­£åœ¨è€ƒè™‘è¦ä¸è¦ä¸ŠGitOpsï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼š</p><ol><li><strong>å…ˆå°è§„æ¨¡è¯•ç‚¹</strong>ï¼šæ‰¾ä¸€ä¸¤ä¸ªéæ ¸å¿ƒåº”ç”¨è¯•è¯•æ°´ï¼Œåˆ«ä¸€ä¸Šæ¥å°±å…¨è¿</li><li><strong>å›¢é˜Ÿå…ˆç»Ÿä¸€è®¤è¯†</strong>ï¼šç¡®ä¿å¤§å®¶éƒ½ç†è§£GitOpsçš„ç†å¿µï¼Œä¸ç„¶å¾ˆå®¹æ˜“ç”¨å›è€æ–¹æ³•</li><li><strong>åˆ«è¿½æ±‚å®Œç¾</strong>ï¼šåˆšå¼€å§‹ç›®å½•ç»“æ„å¯èƒ½ä¸å¤Ÿä¼˜é›…ï¼Œé…ç½®å¯èƒ½æœ‰ç‚¹ä¹±ï¼Œæ²¡å…³ç³»ï¼Œå…ˆè·‘èµ·æ¥å†ä¼˜åŒ–</li><li><strong>ä¿ç•™é€ƒç”Ÿé€šé“</strong>ï¼šä¸‡ä¸€GitOpså‡ºé—®é¢˜äº†ï¼Œè¦æœ‰äººèƒ½æ‰‹åŠ¨<code>kubectl</code>æ•‘æ€¥</li></ol><p>æœ€åé€å¤§å®¶ä¸€å¥è¯ï¼š<strong>å·¥å…·æ˜¯ä¸ºäººæœåŠ¡çš„ï¼Œåˆ«è®©å·¥å…·ç»‘æ¶äº†å·¥ä½œæ–¹å¼</strong>ã€‚GitOpså¾ˆå¥½ï¼Œä½†å¦‚æœå®ƒä¸é€‚åˆä½ çš„åœºæ™¯ï¼Œä¹Ÿä¸ç”¨å¼ºæ±‚ã€‚</p><hr><p><strong>è¿™ç¯‡æ–‡ç« æ˜¯åŸºäºæˆ‘ä»¬å›¢é˜Ÿçš„çœŸå®å®è·µå†™çš„</strong>ï¼Œæœ‰äº›åœ°æ–¹å¯èƒ½ä¸å¤Ÿå®Œç¾ï¼Œæœ‰äº›æ–¹æ¡ˆå¯èƒ½ä¸æ˜¯æœ€ä¼˜è§£ï¼Œä½†éƒ½æ˜¯æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒè¸©è¿‡å‘ã€æµè¿‡æ±—æ€»ç»“å‡ºæ¥çš„ã€‚å¸Œæœ›èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><p>å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚ä¹Ÿæ¬¢è¿ä½ åˆ†äº«è‡ªå·±çš„GitOpså®è·µç»éªŒï¼Œè®©æˆ‘ä»¬ä¸€èµ·è¿›æ­¥ã€‚</p><hr><p><strong>ç›¸å…³æ ‡ç­¾ï¼š</strong> #GitOps #DevOps #Kubernetes #ArgoCD #Flux #äº‘åŸç”Ÿ #æŒç»­äº¤ä»˜</p><p><strong>å»¶ä¼¸é˜…è¯»ï¼š</strong> å¦‚æœä½ å‡†å¤‡åœ¨ç”Ÿäº§ç¯å¢ƒè½åœ°GitOpsï¼Œå»ºè®®çœ‹çœ‹è¿™å‡ ä¸ªèµ„æºï¼š</p><ul><li><a href="https://argo-cd.readthedocs.io/" target="_blank" rel="noreferrer">ArgoCDå®˜æ–¹æ–‡æ¡£</a> - è™½ç„¶æœ‰æ—¶å€™æ›´æ–°ä¸åŠæ—¶ï¼Œä½†åŸºç¡€æ¦‚å¿µè®²å¾—æ¸…æ¥š</li><li><a href="https://fluxcd.io/" target="_blank" rel="noreferrer">FluxCDå®˜æ–¹æ–‡æ¡£</a> - å¦‚æœä½ æ›´å–œæ¬¢è½»é‡çº§æ–¹æ¡ˆ</li><li><a href="https://kubectl.docs.kubernetes.io/guides/introduction/kustomize/" target="_blank" rel="noreferrer">Kustomizeå®˜æ–¹æ•™ç¨‹</a> - GitOpsçš„æœ€ä½³ä¼´ä¾£</li><li><a href="https://opengitops.dev/" target="_blank" rel="noreferrer">OpenGitOps</a> - å¦‚æœä½ æƒ³äº†è§£GitOpsçš„æ ‡å‡†åŒ–å®šä¹‰</li></ul><p>å¦å¤–æ¨èå‡ ç¯‡æˆ‘è§‰å¾—å†™å¾—ä¸é”™çš„ä¸­æ–‡åšå®¢ï¼ˆ Google æœä¸€ä¸‹æ ‡é¢˜å°±èƒ½æ‰¾åˆ°ï¼‰ï¼š</p><ul><li>ã€Šæˆ‘ä»¬å›¢é˜Ÿè½åœ°GitOpsçš„18ä¸ªæœˆã€‹- å¦ä¸€ç¯‡å®æˆ˜ç»éªŒåˆ†äº«</li><li>ã€ŠArgoCDç”Ÿäº§ç¯å¢ƒé…ç½®æŒ‡å—ã€‹- è®²äº†å¾ˆå¤šç»†èŠ‚é…ç½®</li><li>ã€Šä»Jenkinsè¿ç§»åˆ°GitOpsè¸©å‘å®å½•ã€‹- å¦‚æœä½ æ­£åœ¨åšè¿ç§»</li></ul><hr><p><em>å†™è¿™ç¯‡æ–‡ç« èŠ±äº†ä¸¤ä¸ªå‘¨æœ«ï¼Œä¸»è¦æ˜¯æ•´ç†è¿™ä¸€å¹´å¤šçš„å®è·µç¬”è®°ã€‚å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ã€‚å¦‚æœæœ‰ä¸åŒæ„è§æˆ–è€…æ›´å¥½çš„å®è·µæ–¹å¼ï¼Œä¹Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµã€‚</em></p>`,167)]))}const y=i(l,[["render",t]]);export{g as __pageData,y as default};
