import{_ as i,c as a,o as n,a6 as l}from"./chunks/framework.BwtyjzPT.js";const E=JSON.parse('{"title":"ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·","description":"æ‰“é€ ä½ çš„ CLI ç¥å™¨ï¼šç”¨ Go æ„å»ºä¸€ä¸ªç±» `kubectl` çš„å‘½ä»¤è¡Œå·¥å…·","frontmatter":{"title":"ç”¨ Go æ„å»ºä¸€ä¸ªç±» `kubectl` çš„å‘½ä»¤è¡Œå·¥å…·","date":"2025-07-17T17:15:27.000Z","tags":["Golang"],"description":"æ‰“é€ ä½ çš„ CLI ç¥å™¨ï¼šç”¨ Go æ„å»ºä¸€ä¸ªç±» `kubectl` çš„å‘½ä»¤è¡Œå·¥å…·","author":"PFinalå—ä¸","keywords":"Go, å‘½ä»¤è¡Œå·¥å…·, kubectl, CLI","head":[["link",{"rel":"canonical","href":"https://friday-go.icu/zh/golang/ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·"}],["link",{"rel":"alternate","hreflang":"zh-CN","href":"https://friday-go.icu/zh/golang/ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·"}],["link",{"rel":"alternate","hreflang":"en","href":"https://friday-go.icu/golang/ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·"}],["link",{"rel":"alternate","hreflang":"x-default","href":"https://friday-go.icu/golang/ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·"}],["meta",{"name":"keywords","content":"Go, å‘½ä»¤è¡Œå·¥å…·, kubectl, CLI, PFinalClub, Golang, PHP, Python, æŠ€æœ¯åšå®¢, Tech Blog"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"TechArticle\\",\\"headline\\":\\"ç”¨ Go æ„å»ºä¸€ä¸ªç±» `kubectl` çš„å‘½ä»¤è¡Œå·¥å…·\\",\\"url\\":\\"https://friday-go.icu/zh/golang/ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·\\",\\"datePublished\\":\\"2025-07-17T17:15:27.000Z\\",\\"dateModified\\":1752731000000,\\"author\\":{\\"@type\\":\\"Person\\",\\"name\\":\\"PFinalå—ä¸\\",\\"url\\":\\"https://friday-go.icu/about\\"},\\"publisher\\":{\\"@type\\":\\"Organization\\",\\"name\\":\\"PFinalClub\\",\\"logo\\":{\\"@type\\":\\"ImageObject\\",\\"url\\":\\"https://friday-go.icu/logo.png\\"}},\\"description\\":\\"æ‰“é€ ä½ çš„ CLI ç¥å™¨ï¼šç”¨ Go æ„å»ºä¸€ä¸ªç±» `kubectl` çš„å‘½ä»¤è¡Œå·¥å…·\\",\\"inLanguage\\":\\"zh-CN\\",\\"mainEntityOfPage\\":{\\"@type\\":\\"WebPage\\",\\"@id\\":\\"https://friday-go.icu/zh/golang/ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·\\"},\\"keywords\\":\\"Go, å‘½ä»¤è¡Œå·¥å…·, kubectl, CLI\\",\\"articleSection\\":\\"Golang\\"}"]]},"headers":[],"relativePath":"zh/golang/ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·.md","filePath":"zh/golang/ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·.md","lastUpdated":1752731000000}'),t={name:"zh/golang/ç”¨ Go æ„å»ºä¸€ä¸ªç±» kubectl çš„å‘½ä»¤è¡Œå·¥å…·.md"};function h(e,s,k,p,r,d){return n(),a("div",{"data-pagefind-body":!0,"data-pagefind-meta":"date:1752772527000"},s[0]||(s[0]=[l(`<h2 id="ğŸ› ï¸-æ‰“é€ ä½ çš„-cli-ç¥å™¨-ç”¨-go-æ„å»ºä¸€ä¸ªç±»-kubectl-çš„å‘½ä»¤è¡Œå·¥å…·" tabindex="-1">ğŸ› ï¸ æ‰“é€ ä½ çš„ CLI ç¥å™¨ï¼šç”¨ Go æ„å»ºä¸€ä¸ªç±» <code>kubectl</code> çš„å‘½ä»¤è¡Œå·¥å…· <a class="header-anchor" href="#ğŸ› ï¸-æ‰“é€ ä½ çš„-cli-ç¥å™¨-ç”¨-go-æ„å»ºä¸€ä¸ªç±»-kubectl-çš„å‘½ä»¤è¡Œå·¥å…·" aria-label="Permalink to &quot;ğŸ› ï¸ æ‰“é€ ä½ çš„ CLI ç¥å™¨ï¼šç”¨ Go æ„å»ºä¸€ä¸ªç±» \`kubectl\` çš„å‘½ä»¤è¡Œå·¥å…·&quot;">â€‹</a></h2><blockquote><p><strong>â€œå¥½çš„å·¥å…·æ˜¯èº«ä½“çš„å»¶ä¼¸ã€‚â€</strong> â€”â€” å½“ä½ åœ¨ç»ˆç«¯ä¸­æµç•…æ•²ä¸‹ <code>kubectl get pods</code>ï¼Œç¬é—´æŒæ§äº‘ç«¯é›†ç¾¤çŠ¶æ€æ—¶ï¼Œæ˜¯å¦ä¹Ÿæ›¾æ¢¦æƒ³äº²æ‰‹æ‰“é€ å¦‚æ­¤å¼ºå¤§çš„å‘½ä»¤è¡Œåˆ©å™¨ï¼Ÿä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬ç”¨ Go è¯­è¨€ï¼Œè¸ä¸Šæ„å»ºå±äºä½ è‡ªå·±çš„ç±» <code>kubectl</code> CLI ç¥å™¨çš„æ—…ç¨‹ï¼</p></blockquote><hr><h2 id="ğŸŒŸ-ä¸ºä»€ä¹ˆé€‰æ‹©-go-æ‰“é€ -cli-å·¥å…·" tabindex="-1">ğŸŒŸ ä¸ºä»€ä¹ˆé€‰æ‹© Go æ‰“é€  CLI å·¥å…·ï¼Ÿ <a class="header-anchor" href="#ğŸŒŸ-ä¸ºä»€ä¹ˆé€‰æ‹©-go-æ‰“é€ -cli-å·¥å…·" aria-label="Permalink to &quot;ğŸŒŸ ä¸ºä»€ä¹ˆé€‰æ‹© Go æ‰“é€  CLI å·¥å…·ï¼Ÿ&quot;">â€‹</a></h2><p>åœ¨å‘½ä»¤è¡Œå·¥å…·é¢†åŸŸï¼ŒGo è¯­è¨€å‡­å€Ÿå…¶ç‹¬ç‰¹ä¼˜åŠ¿ï¼Œå·²æˆä¸ºäº‘åŸç”Ÿæ—¶ä»£çš„å® å„¿ï¼ˆæƒ³æƒ³ <code>kubectl</code>, <code>docker</code>, <code>terraform</code>, <code>gh</code>ï¼‰ï¼š</p><ol><li><strong>å•ä¸€äºŒè¿›åˆ¶ï¼Œéƒ¨ç½²æ— å¿§ï¼š</strong> <code>go build</code> ç›´æ¥ç”Ÿæˆç›®æ ‡å¹³å°çš„ç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ— éœ€å¤æ‚ä¾èµ–ï¼Œç”¨æˆ·ä¸‹è½½å³ç”¨ã€‚</li><li><strong>å“è¶Šçš„å¹¶å‘æ€§èƒ½ï¼š</strong> å¤©ç”Ÿæ“…é•¿å¤„ç†å¹¶å‘ I/Oï¼ˆå¦‚å¹¶è¡Œå¤„ç†å¤šä¸ª API è¯·æ±‚ï¼‰ï¼Œè®©å·¥å…·å“åº”å¦‚é£ã€‚</li><li><strong>ä¸°å¯Œçš„æ ‡å‡†åº“ä¸ç”Ÿæ€ï¼š</strong> <code>flag</code>, <code>os</code>, <code>io</code>, <code>net/http</code> ç­‰æ ‡å‡†åº“ä¸º CLI å¼€å‘æ‰“ä¸‹åšå®åŸºç¡€ï¼Œæ›´æœ‰å¼ºå¤§çš„ç¤¾åŒºåº“åŠ©åŠ›ã€‚</li><li><strong>ç¼–è¯‘å‹è¯­è¨€çš„æ•ˆç‡ï¼š</strong> æ‰§è¡Œé€Ÿåº¦å¿«ï¼Œå†…å­˜å ç”¨ç›¸å¯¹åˆç†ã€‚</li></ol><p><strong>ä¸ªäººè§è§£ï¼š</strong> ç›¸æ¯” Python æˆ– Node.jsï¼ŒGo åœ¨æ„å»ºéœ€è¦é«˜æ€§èƒ½ã€ä½ä¾èµ–ä¸”å¹¿æ³›åˆ†å‘çš„ç”Ÿäº§çº§ CLI å·¥å…·æ—¶ï¼Œä¼˜åŠ¿å°¤ä¸ºæ˜æ˜¾ã€‚å…¶ç®€æ´çš„è¯­æ³•å’Œå¼ºç±»å‹ç³»ç»Ÿä¹Ÿå‡å°‘äº†åæœŸç»´æŠ¤çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚</p><hr><h2 id="ğŸ§±-æ ¸å¿ƒåº“-ä½ çš„è„šæ‰‹æ¶é€‰æ‹©" tabindex="-1">ğŸ§± æ ¸å¿ƒåº“ï¼šä½ çš„è„šæ‰‹æ¶é€‰æ‹© <a class="header-anchor" href="#ğŸ§±-æ ¸å¿ƒåº“-ä½ çš„è„šæ‰‹æ¶é€‰æ‹©" aria-label="Permalink to &quot;ğŸ§± æ ¸å¿ƒåº“ï¼šä½ çš„è„šæ‰‹æ¶é€‰æ‹©&quot;">â€‹</a></h2><p>æ„å»º CLI çš„åŸºçŸ³æ˜¯é€‰æ‹©ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œè§£æåº“ã€‚Go ç”Ÿæ€æä¾›äº†å‡ ä¸ªä½¼ä½¼è€…ï¼š</p><ol><li><strong><code>cobra</code> (â­ Star è¶… 35k)ï¼š</strong> <strong>ç»å¯¹é¦–é€‰ï¼</strong> <code>kubectl</code>ã€<code>docker</code>ã€<code>hugo</code>ã€<code>gitlab-cli</code> ç­‰ä¼—å¤šçŸ¥åé¡¹ç›®éƒ½åœ¨ä½¿ç”¨ã€‚å®ƒæä¾›äº†ï¼š <ul><li>ç›´è§‚çš„å­å‘½ä»¤ (<code>get</code>, <code>create</code>, <code>describe</code>, <code>apply</code>...) ç»“æ„ã€‚</li><li>å¼ºå¤§çš„æ ‡å¿— (<code>flags</code>) è§£æï¼ˆæŒä¹…æ ‡å¿—ã€æœ¬åœ°æ ‡å¿—ã€å¿…é€‰æ ‡å¿—ï¼‰ã€‚</li><li>è‡ªåŠ¨ç”Ÿæˆå¸®åŠ©æ–‡æ¡£ (<code>--help</code>) å’Œæ‰‹å†Œ (<code>man</code> pages)ã€‚</li><li>Shell è‡ªåŠ¨è¡¥å…¨æ”¯æŒ (bash, zsh, fish, PowerShell)ã€‚</li><li><code>viper</code> é›†æˆï¼šæ— ç¼è¡”æ¥é…ç½®æ–‡ä»¶ (å¦‚ <code>~/.myclirc</code>)ã€‚</li></ul></li><li><strong><code>urfave/cli</code> (â­ Star è¶… 21k)ï¼š</strong> API æ›´ç®€æ´ç›´æ¥ï¼Œé€‚åˆå¿«é€Ÿæ„å»ºä¸­å°å‹ CLIã€‚è¢« <code>drone</code>, <code>goreleaser</code> ç­‰é¡¹ç›®é‡‡ç”¨ã€‚</li><li><strong>æ ‡å‡†åº“ <code>flag</code>ï¼š</strong> è½»é‡çº§ï¼Œé€‚åˆéå¸¸ç®€å•çš„å·¥å…·ã€‚ä½†ç¼ºä¹å­å‘½ä»¤ã€è‡ªåŠ¨è¡¥å…¨ç­‰é«˜çº§åŠŸèƒ½ã€‚</li></ol><p><strong>å®æˆ˜é€‰æ‹©ï¼š</strong> <strong>å¼ºçƒˆæ¨è <code>cobra</code></strong>ã€‚å®ƒä¸ä»…åŠŸèƒ½å®Œå¤‡ï¼Œå…¶è®¾è®¡å“²å­¦ï¼ˆæ¸…æ™°çš„å‘½ä»¤æ ‘ç»“æ„ï¼‰ä¸ <code>kubectl</code> é«˜åº¦å¥‘åˆï¼Œå­¦ä¹ æ›²çº¿ä¹Ÿç›¸å¯¹å¹³ç¼“ã€‚å®‰è£…å®ƒï¼š<code>go get -u github.com/spf13/cobra/cobra</code>ã€‚</p><hr><h2 id="ğŸš€-è¿›é˜¶æ¶æ„è®¾è®¡ä¸å¯æ‰©å±•æ€§" tabindex="-1">ğŸš€ è¿›é˜¶æ¶æ„è®¾è®¡ä¸å¯æ‰©å±•æ€§ <a class="header-anchor" href="#ğŸš€-è¿›é˜¶æ¶æ„è®¾è®¡ä¸å¯æ‰©å±•æ€§" aria-label="Permalink to &quot;ğŸš€ è¿›é˜¶æ¶æ„è®¾è®¡ä¸å¯æ‰©å±•æ€§&quot;">â€‹</a></h2><h3 id="å‘½ä»¤æ ‘ä¸æ’ä»¶åŒ–æ¶æ„" tabindex="-1">å‘½ä»¤æ ‘ä¸æ’ä»¶åŒ–æ¶æ„ <a class="header-anchor" href="#å‘½ä»¤æ ‘ä¸æ’ä»¶åŒ–æ¶æ„" aria-label="Permalink to &quot;å‘½ä»¤æ ‘ä¸æ’ä»¶åŒ–æ¶æ„&quot;">â€‹</a></h3><p>å¯¹äºèµ„æ·±å¼€å‘è€…ï¼ŒCLI å·¥å…·çš„å¯æ‰©å±•æ€§å’Œæ¶æ„è®¾è®¡å°¤ä¸ºé‡è¦ã€‚<code>cobra</code> æ”¯æŒæ¸…æ™°çš„å‘½ä»¤æ ‘ç»“æ„ï¼Œä¾¿äºå®ç°ç±»ä¼¼ kubectl çš„æ’ä»¶æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œkubectl é€šè¿‡ PATH ä¸‹çš„ <code>kubectl-xxx</code> å¯è‡ªåŠ¨è¯†åˆ«ä¸ºå­å‘½ä»¤ï¼Œcobra ä¹Ÿæ”¯æŒç±»ä¼¼æ‰©å±•ã€‚ä½ å¯ä»¥è®¾è®¡è‡ªå·±çš„æ’ä»¶å‘ç°ä¸åŠ¨æ€åŠ è½½æœºåˆ¶ï¼Œæ”¯æŒå›¢é˜Ÿåä½œå’ŒåŠŸèƒ½çƒ­æ’æ‹”ã€‚</p><h3 id="å‘½ä»¤è‡ªåŠ¨å‘ç°ä¸åŠ¨æ€æ³¨å†Œ" tabindex="-1">å‘½ä»¤è‡ªåŠ¨å‘ç°ä¸åŠ¨æ€æ³¨å†Œ <a class="header-anchor" href="#å‘½ä»¤è‡ªåŠ¨å‘ç°ä¸åŠ¨æ€æ³¨å†Œ" aria-label="Permalink to &quot;å‘½ä»¤è‡ªåŠ¨å‘ç°ä¸åŠ¨æ€æ³¨å†Œ&quot;">â€‹</a></h3><p>å¯ä»¥é€šè¿‡åå°„ã€Go plugin æˆ–åŸºäºé…ç½®çš„å‘½ä»¤æ³¨å†Œï¼Œå®ç°å‘½ä»¤çš„è‡ªåŠ¨æ³¨å†Œå’ŒåŠ¨æ€å‘ç°ï¼Œè®© CLI æ›´åŠ çµæ´»å¯æ‰©å±•ã€‚å¯¹äºå¤§å‹é¡¹ç›®ï¼Œå»ºè®®å°†æ¯ä¸ªå­å‘½ä»¤æ‹†åˆ†ä¸ºç‹¬ç«‹åŒ…æˆ–æ¨¡å—ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•ã€‚</p><hr><h2 id="ğŸ”¨-åŠ¨æ‰‹-æ„å»ºä½ çš„-mykctl-éª¨æ¶" tabindex="-1">ğŸ”¨ åŠ¨æ‰‹ï¼æ„å»ºä½ çš„ &quot;mykctl&quot; éª¨æ¶ <a class="header-anchor" href="#ğŸ”¨-åŠ¨æ‰‹-æ„å»ºä½ çš„-mykctl-éª¨æ¶" aria-label="Permalink to &quot;ğŸ”¨ åŠ¨æ‰‹ï¼æ„å»ºä½ çš„ &quot;mykctl&quot; éª¨æ¶&quot;">â€‹</a></h2><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fmt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">os</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">github.com/spf13/cobra</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// rootCmd ä»£è¡¨åŸºç¡€å‘½ä»¤ï¼Œä¸æ·»åŠ ä»»ä½•å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rootCmd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cobra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Use:   </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mykctl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Short: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;My awesome Kubernetes-like CLI tool&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Long:  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`mykctl is a powerful CLI for demonstrating how to build kubectl-like tools in Go.\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Run: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cmd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cobra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å¦‚æœæ²¡æœ‰æä¾›å­å‘½ä»¤ï¼Œæ˜¾ç¤ºå¸®åŠ©</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cmd.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Help</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// getCmd æ¨¡æ‹Ÿ &quot;kubectl get&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> getCmd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cobra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Use:   </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get RESOURCE [NAME]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Short: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Display one or many resources&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Args:  cobra.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MinimumNArgs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è‡³å°‘éœ€è¦ä¸€ä¸ªå‚æ•°ï¼ˆèµ„æºç±»å‹ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Run: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cmd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cobra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        resourceType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        resourceName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            resourceName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ¨¡æ‹Ÿä»&quot;API&quot;è·å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Getting resource(s) of type: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, resourceType)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resourceName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;, named: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, resourceName)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è¿™é‡Œå®é™…ä¼šè°ƒç”¨ Kubernetes API Client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å°† getCmd æ·»åŠ ä¸º rootCmd çš„å­å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rootCmd.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(getCmd)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rootCmd.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>ç¼–è¯‘ &amp; åˆä½“éªŒï¼š</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mykctl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./mykctl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./mykctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./mykctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pods</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-pod-xyz</span></span></code></pre></div><p>æ­å–œï¼ä½ å·²ç»æœ‰äº†ä¸€ä¸ªèƒ½å“åº” <code>get</code> å‘½ä»¤çš„åŸºæœ¬æ¡†æ¶ï¼<code>cobra</code> è‡ªåŠ¨ä¸ºä½ ç”Ÿæˆäº† <code>--help</code> ä¿¡æ¯ã€‚</p><hr><h2 id="ğŸŒ-çµé­‚æ‰€åœ¨-ä¸-kubernetes-api-å¯¹è¯" tabindex="-1">ğŸŒ çµé­‚æ‰€åœ¨ï¼šä¸ Kubernetes API å¯¹è¯ <a class="header-anchor" href="#ğŸŒ-çµé­‚æ‰€åœ¨-ä¸-kubernetes-api-å¯¹è¯" aria-label="Permalink to &quot;ğŸŒ çµé­‚æ‰€åœ¨ï¼šä¸ Kubernetes API å¯¹è¯&quot;">â€‹</a></h2><p>CLI æ˜¯å‰ç«¯ï¼Œä¸ K8s API Server äº¤äº’æ‰æ˜¯æ ¸å¿ƒã€‚å®˜æ–¹ <code>client-go</code> åº“æ˜¯ä½ çš„ä¸äºŒä¹‹é€‰ã€‚</p><p><strong>å…³é”®æ­¥éª¤ï¼š</strong></p><ol><li><strong>å¼•å…¥ä¾èµ–ï¼š</strong> <code>go get k8s.io/client-go@latest</code></li><li><strong>é…ç½®åŠ è½½ï¼š</strong> é€šå¸¸ä» <code>~/.kube/config</code> åŠ è½½é…ç½®ã€‚<code>client-go</code> æä¾›äº†ä¾¿æ·æ–¹æ³•ï¼š<div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/client-go/tools/clientcmd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">k8s.io/client-go/kubernetes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getK8sClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubernetes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Clientset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. åŠ è½½è§„åˆ™ï¼šé€šå¸¸ä»æ ‡å‡†ä½ç½®(~/.kube/config)æˆ–ç¯å¢ƒå˜é‡ KUBECONFIG åŠ è½½</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    loadingRules </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clientcmd.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewDefaultClientConfigLoadingRules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. åŠ è½½é…ç½®è¦†ç›–è§„åˆ™ï¼ˆæ— è¦†ç›–ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    configOverrides </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clientcmd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ConfigOverrides</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. æ„å»ºé…ç½®å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kubeConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clientcmd.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewNonInteractiveDeferredLoadingClientConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loadingRules, configOverrides)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. è·å– REST é…ç½® (åŒ…å« API Server åœ°å€ã€CA è¯ä¹¦ã€ç”¨æˆ·è®¤è¯ä¿¡æ¯ç­‰)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    restConfig, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kubeConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ClientConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 5. åˆ›å»º Kubernetes Clientset (è®¿é—®æ ¸å¿ƒ API ç»„èµ„æº)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    clientset, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kubernetes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewForConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(restConfig)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clientset, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><strong>åœ¨å‘½ä»¤ä¸­ä½¿ç”¨ Clientï¼š</strong> ä¿®æ”¹ <code>getCmd</code> çš„ <code>Run</code> å‡½æ•°ï¼š<div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Run: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cmd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cobra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    clientset, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getK8sClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Failed to get Kubernetes client: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    resourceType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    namespace </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;default&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // å¯ä»¥æ·»åŠ  --namespace æ ‡å¿—æ¥æŒ‡å®š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ·»åŠ  --all-namespaces æ ‡å¿—é€»è¾‘</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resourceType {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;pods&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pod&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;po&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è·å– Pod åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pods, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clientset.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CoreV1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Pods</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(namespace).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TODO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metav1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ListOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Error listing pods: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%v\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ ¼å¼åŒ–è¾“å‡ºï¼è¿™é‡Œæ˜¯å…³é”®ç”¨æˆ·ä½“éªŒç‚¹</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ç®€å•ç¤ºä¾‹ï¼šæ‰“å° Pod å</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PODS:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _, pod </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pods.Items {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, pod.Name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;deployments&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;deploy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;deployment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // ç±»ä¼¼é€»è¾‘å¤„ç† Deployments</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... å¤„ç†å…¶ä»–èµ„æºç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fmt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Unsupported resource type: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, resourceType)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        os.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ol><p><strong>å…³é”®ç‚¹ä¸æŒ‘æˆ˜ï¼š</strong></p><ul><li><strong>è®¤è¯å¤æ‚æ€§ï¼š</strong> <code>client-go</code> å°è£…äº†å„ç§è®¤è¯æ–¹å¼ (è¯ä¹¦ã€Tokenã€OIDC ç­‰)ï¼Œ<code>ClientConfig()</code> å·²è‡ªåŠ¨å¤„ç† <code>kubeconfig</code> ä¸­çš„é…ç½®ã€‚</li><li><strong>API ç‰ˆæœ¬é€‚é…ï¼š</strong> K8s API ç‰ˆæœ¬ä¼—å¤šä¸”æ¼”è¿›å¿«ã€‚<code>clientset.CoreV1()</code> å¯¹åº”ç¨³å®šçš„ v1 APIã€‚ä½¿ç”¨ <code>clientset.AppsV1()</code> è®¿é—® Deployments ç­‰ã€‚æ³¨æ„èµ„æºç±»å‹åœ¨ä¸åŒ API Group çš„ä½ç½®ã€‚</li><li><strong>ä¸Šä¸‹æ–‡ (<code>context</code>)ï¼š</strong> æ‰€æœ‰ API è°ƒç”¨éƒ½éœ€è¦ä¼ é€’ <code>context.Context</code>ï¼Œç”¨äºæ§åˆ¶è¶…æ—¶ (<code>context.WithTimeout</code>) å’Œå–æ¶ˆæ“ä½œã€‚è¿™æ˜¯ Go å¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³ã€‚</li><li><strong>æ€§èƒ½ä¸åˆ†é¡µï¼š</strong> å¤„ç†å¤§å‹é›†ç¾¤æ—¶ï¼Œ<code>ListOptions{Limit: 500}</code> å’Œ <code>Continue</code> token å®ç°åˆ†é¡µè·å–è‡³å…³é‡è¦ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚</li></ul><hr><h2 id="âš¡-æ€§èƒ½ä¸å¹¶å‘ä¼˜åŒ–" tabindex="-1">âš¡ æ€§èƒ½ä¸å¹¶å‘ä¼˜åŒ– <a class="header-anchor" href="#âš¡-æ€§èƒ½ä¸å¹¶å‘ä¼˜åŒ–" aria-label="Permalink to &quot;âš¡ æ€§èƒ½ä¸å¹¶å‘ä¼˜åŒ–&quot;">â€‹</a></h2><h3 id="é«˜å¹¶å‘-api-æ‰¹é‡è¯·æ±‚" tabindex="-1">é«˜å¹¶å‘ API æ‰¹é‡è¯·æ±‚ <a class="header-anchor" href="#é«˜å¹¶å‘-api-æ‰¹é‡è¯·æ±‚" aria-label="Permalink to &quot;é«˜å¹¶å‘ API æ‰¹é‡è¯·æ±‚&quot;">â€‹</a></h3><p>åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸‹ï¼Œå¦‚ä½•é«˜æ•ˆæ‹‰å–èµ„æºï¼Ÿå¯ä»¥åˆ©ç”¨ goroutine æ± ï¼ˆå¦‚ <a href="https://github.com/panjf2000/ants" target="_blank" rel="noreferrer">ants</a>ï¼‰æ‰¹é‡å¹¶å‘è¯·æ±‚ K8s APIï¼Œæå‡æ•ˆç‡å¹¶é¿å… API Server è¢«æ‰“çˆ†ã€‚</p><h3 id="i-o-ä¸è¾“å‡ºä¼˜åŒ–" tabindex="-1">I/O ä¸è¾“å‡ºä¼˜åŒ– <a class="header-anchor" href="#i-o-ä¸è¾“å‡ºä¼˜åŒ–" aria-label="Permalink to &quot;I/O ä¸è¾“å‡ºä¼˜åŒ–&quot;">â€‹</a></h3><p>ç”¨ <code>bufio.Writer</code>ã€<code>text/tabwriter</code> ä¼˜åŒ–å¤§æ‰¹é‡æ•°æ®çš„ç»ˆç«¯è¾“å‡ºï¼Œå‡å°‘å¡é¡¿å’Œé—ªçƒï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p><hr><h2 id="ğŸ—ï¸-ç”Ÿäº§çº§-cli-çš„å·¥ç¨‹å®è·µ" tabindex="-1">ğŸ—ï¸ ç”Ÿäº§çº§ CLI çš„å·¥ç¨‹å®è·µ <a class="header-anchor" href="#ğŸ—ï¸-ç”Ÿäº§çº§-cli-çš„å·¥ç¨‹å®è·µ" aria-label="Permalink to &quot;ğŸ—ï¸ ç”Ÿäº§çº§ CLI çš„å·¥ç¨‹å®è·µ&quot;">â€‹</a></h2><h3 id="é…ç½®ä½“ç³»è®¾è®¡" tabindex="-1">é…ç½®ä½“ç³»è®¾è®¡ <a class="header-anchor" href="#é…ç½®ä½“ç³»è®¾è®¡" aria-label="Permalink to &quot;é…ç½®ä½“ç³»è®¾è®¡&quot;">â€‹</a></h3><p>æ¨èç”¨ viper æ”¯æŒå¤šæºé…ç½®ï¼ˆç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°ï¼‰ï¼Œå¹¶å®ç°ä¼˜é›…çš„ä¼˜å…ˆçº§åˆå¹¶ã€‚</p><h3 id="æ—¥å¿—ä¸å¯è§‚æµ‹æ€§" tabindex="-1">æ—¥å¿—ä¸å¯è§‚æµ‹æ€§ <a class="header-anchor" href="#æ—¥å¿—ä¸å¯è§‚æµ‹æ€§" aria-label="Permalink to &quot;æ—¥å¿—ä¸å¯è§‚æµ‹æ€§&quot;">â€‹</a></h3><p>é›†æˆ zapã€logrus ç­‰æ—¥å¿—åº“ï¼Œæ”¯æŒå¤šçº§æ—¥å¿—ã€ç»“æ„åŒ–è¾“å‡ºï¼Œä¾¿äºåæœŸæ’æŸ¥å’Œè‡ªåŠ¨åŒ–è¿ç»´ã€‚</p><h3 id="å¤šè¯­è¨€ä¸å›½é™…åŒ–æ”¯æŒ" tabindex="-1">å¤šè¯­è¨€ä¸å›½é™…åŒ–æ”¯æŒ <a class="header-anchor" href="#å¤šè¯­è¨€ä¸å›½é™…åŒ–æ”¯æŒ" aria-label="Permalink to &quot;å¤šè¯­è¨€ä¸å›½é™…åŒ–æ”¯æŒ&quot;">â€‹</a></h3><p>ä¸º CLI å·¥å…·æ·»åŠ  i18n æ”¯æŒï¼ŒæœåŠ¡å…¨çƒå¼€å‘è€…ã€‚</p><hr><h2 id="ğŸ§©-kubectl-æºç ä¸ç”Ÿæ€å€Ÿé‰´" tabindex="-1">ğŸ§© kubectl æºç ä¸ç”Ÿæ€å€Ÿé‰´ <a class="header-anchor" href="#ğŸ§©-kubectl-æºç ä¸ç”Ÿæ€å€Ÿé‰´" aria-label="Permalink to &quot;ğŸ§© kubectl æºç ä¸ç”Ÿæ€å€Ÿé‰´&quot;">â€‹</a></h2><h3 id="kubectl-æºç æ¶æ„è§£è¯»" tabindex="-1">kubectl æºç æ¶æ„è§£è¯» <a class="header-anchor" href="#kubectl-æºç æ¶æ„è§£è¯»" aria-label="Permalink to &quot;kubectl æºç æ¶æ„è§£è¯»&quot;">â€‹</a></h3><p>kubectl çš„å‘½ä»¤æ³¨å†Œã€æ‰§è¡Œæµç¨‹ã€Printer ä½“ç³»ã€æ’ä»¶æœºåˆ¶ç­‰æºç è®¾è®¡æå…·å‚è€ƒä»·å€¼ã€‚å»ºè®®æ·±å…¥é˜…è¯»å…¶æºç ï¼Œç†è§£å…¶å¯æ‰©å±•æ€§è®¾è®¡ã€‚</p><h3 id="ä¸-krewã€helm-ç­‰ç”Ÿæ€å·¥å…·çš„é›†æˆ" tabindex="-1">ä¸ krewã€helm ç­‰ç”Ÿæ€å·¥å…·çš„é›†æˆ <a class="header-anchor" href="#ä¸-krewã€helm-ç­‰ç”Ÿæ€å·¥å…·çš„é›†æˆ" aria-label="Permalink to &quot;ä¸ krewã€helm ç­‰ç”Ÿæ€å·¥å…·çš„é›†æˆ&quot;">â€‹</a></h3><p>è®©ä½ çš„ CLI å·¥å…·æ”¯æŒ krew æ’ä»¶åˆ†å‘ï¼Œæˆ–ä¸ helm ç­‰ä¸»æµå·¥å…·ååŒå·¥ä½œï¼Œæå‡ç”Ÿæ€å…¼å®¹æ€§ã€‚</p><hr><h2 id="ğŸ¨-ç”¨æˆ·ä½“éªŒçš„è‰ºæœ¯-è¾“å‡ºæ ¼å¼åŒ–ä¸äº¤äº’" tabindex="-1">ğŸ¨ ç”¨æˆ·ä½“éªŒçš„è‰ºæœ¯ï¼šè¾“å‡ºæ ¼å¼åŒ–ä¸äº¤äº’ <a class="header-anchor" href="#ğŸ¨-ç”¨æˆ·ä½“éªŒçš„è‰ºæœ¯-è¾“å‡ºæ ¼å¼åŒ–ä¸äº¤äº’" aria-label="Permalink to &quot;ğŸ¨ ç”¨æˆ·ä½“éªŒçš„è‰ºæœ¯ï¼šè¾“å‡ºæ ¼å¼åŒ–ä¸äº¤äº’&quot;">â€‹</a></h2><p><code>kubectl</code> çš„æˆåŠŸï¼Œå¾ˆå¤§ç¨‹åº¦å½’åŠŸäºå…¶æ¸…æ™°ã€çµæ´»çš„è¾“å‡ºï¼š</p><ol><li><p><strong><code>-o</code> / <code>--output</code> æ ‡å¿—ï¼š</strong> å®ç°å¤šç§è¾“å‡ºæ ¼å¼æ˜¯ä¸“ä¸š CLI çš„æ ‡é…ã€‚</p><ul><li><code>wide</code>ï¼šé»˜è®¤è¡¨æ ¼è§†å›¾çš„æ‰©å±•ç‰ˆã€‚</li><li><code>json</code> / <code>yaml</code>ï¼šåŸå§‹æ•°æ®è¾“å‡ºï¼Œæ–¹ä¾¿ç®¡é“å¤„ç† (<code>jq</code>, <code>yq</code>)ã€‚</li><li><code>name</code>ï¼šä»…è¾“å‡ºèµ„æºåç§°ã€‚</li><li><strong>è‡ªå®šä¹‰åˆ— (<code>custom-columns</code>)ï¼š</strong> é«˜çº§åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·æŒ‡å®šæ˜¾ç¤ºå“ªäº›å­—æ®µã€‚</li><li><strong>å®ç°æ€è·¯ï¼š</strong><ul><li>åœ¨å‘½ä»¤ä¸Šæ·»åŠ  <code>output</code> æ ‡å¿— (<code>cmd.Flags().StringP(&quot;output&quot;, &quot;o&quot;, &quot;&quot;, &quot;Output format...&quot;)</code>)ã€‚</li><li>åœ¨å‘½ä»¤é€»è¾‘ä¸­ï¼Œæ ¹æ® <code>output</code> æ ‡å¿—å€¼ï¼Œå°†è·å–åˆ°çš„èµ„æºå¯¹è±¡ (<code>pod</code>, <code>deployment</code> ç­‰) è½¬æ¢æˆå¯¹åº”çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</li><li>ä½¿ç”¨ <code>k8s.io/kubectl/pkg/printers</code> åŒ…ä¸­çš„ <code>TablePrinter</code>, <code>JSONPrinter</code>, <code>YAMLPrinter</code> ç­‰å¯ä»¥ç®€åŒ–å·¥ä½œï¼ˆ<code>kubectl</code> å†…éƒ¨ä½¿ç”¨ï¼‰ã€‚æˆ–è€…è‡ªå·±åˆ©ç”¨ <code>text/tabwriter</code>ã€<code>encoding/json</code>ã€<code>gopkg.in/yaml.v3</code> ç­‰åº“å®ç°ã€‚</li></ul></li></ul></li><li><p><strong><code>--watch</code> / <code>-w</code>ï¼š</strong> å®ç°èµ„æºå˜åŒ–çš„å®æ—¶ç›‘å¬ã€‚</p><ul><li><strong>å®ç°æ€è·¯ï¼š</strong> ä½¿ç”¨ API çš„ <code>Watch</code> æ–¹æ³• (<code>clientset.CoreV1().Pods(namespace).Watch(...)</code>)ã€‚è¿”å›ä¸€ä¸ª <code>watch.Interface</code> çš„é€šé“ (<code>ResultChan</code>)ï¼Œå¾ªç¯è¯»å–é€šé“ä¸­çš„äº‹ä»¶ (<code>ADDED</code>, <code>MODIFIED</code>, <code>DELETED</code>)ï¼Œå¹¶å®æ—¶æ‰“å°ã€‚</li></ul></li><li><p><strong>é¢œè‰²ä¸æç¤ºï¼š</strong> é€‚åº¦ä½¿ç”¨ <code>github.com/fatih/color</code> ç­‰åº“ä¸ºæˆåŠŸã€è­¦å‘Šã€é”™è¯¯ä¿¡æ¯æ·»åŠ é¢œè‰²ï¼Œæå‡å¯è¯»æ€§ã€‚æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ (<code>fmt.Fprintf(os.Stderr, ...)</code>) æ˜¯è°ƒè¯•çš„ç¦éŸ³ã€‚</p></li><li><p><strong>äº¤äº’å¼å‘½ä»¤ä¸ TUI</strong> æ¨èé›†æˆ <a href="https://github.com/charmbracelet/bubbletea" target="_blank" rel="noreferrer">bubbletea</a> ç­‰ TUI æ¡†æ¶ï¼Œå®ç°äº¤äº’å¼å‘½ä»¤ã€èµ„æºé€‰æ‹©ã€å®æ—¶è¿›åº¦æ¡ç­‰é«˜çº§ä½“éªŒã€‚</p></li><li><p><strong>æ™ºèƒ½è¡¥å…¨ä¸å†å²è®°å½•</strong> ä¸º CLI å·¥å…·æ·»åŠ  shell æ™ºèƒ½è¡¥å…¨ï¼ˆbash/zsh/fishï¼‰ï¼Œä»¥åŠå‘½ä»¤å†å²è®°å½•å’Œå¿«æ·å›æº¯ã€‚</p></li></ol><hr><h2 id="ğŸ›¡ï¸-é”™è¯¯å¤„ç†ä¸å¥å£®æ€§" tabindex="-1">ğŸ›¡ï¸ é”™è¯¯å¤„ç†ä¸å¥å£®æ€§ <a class="header-anchor" href="#ğŸ›¡ï¸-é”™è¯¯å¤„ç†ä¸å¥å£®æ€§" aria-label="Permalink to &quot;ğŸ›¡ï¸ é”™è¯¯å¤„ç†ä¸å¥å£®æ€§&quot;">â€‹</a></h2><p>å‘½ä»¤è¡Œå·¥å…·å¿…é¡»ç¨³å®šå¯é ï¼š</p><ol><li><strong>ä¼˜é›…å¤„ç† API é”™è¯¯ï¼š</strong> æ£€æŸ¥ API è°ƒç”¨è¿”å›çš„ <code>error</code>ã€‚K8s API é”™è¯¯é€šå¸¸æœ‰ç‰¹å®šçš„çŠ¶æ€ç å’Œä¿¡æ¯ (<code>status.Status</code>)ã€‚æ¸…æ™°å‘ŠçŸ¥ç”¨æˆ·é—®é¢˜æ‰€åœ¨ï¼ˆæƒé™ä¸è¶³ï¼Ÿèµ„æºä¸å­˜åœ¨ï¼ŸAPI Server ä¸å¯è¾¾ï¼Ÿï¼‰ã€‚</li><li><strong>ç”¨æˆ·è¾“å…¥éªŒè¯ï¼š</strong> ä½¿ç”¨ <code>cobra</code> çš„ <code>Args</code> å±æ€§ï¼ˆå¦‚ <code>cobra.ExactArgs</code>, <code>cobra.MinimumNArgs</code>ï¼‰æˆ–è‡ªå®šä¹‰éªŒè¯å‡½æ•° (<code>cmd.PreRunE</code>) ç¡®ä¿å‘½ä»¤å‚æ•°æ ¼å¼æ­£ç¡®ã€‚</li><li><strong>é…ç½®åŠ è½½å¤±è´¥ï¼š</strong> å¤„ç†æ‰¾ä¸åˆ° <code>kubeconfig</code> æˆ–é…ç½®æ— æ•ˆçš„æƒ…å†µï¼Œç»™å‡ºæ˜ç¡®æŒ‡å¼•ã€‚</li><li><strong>Panic æ¢å¤ï¼š</strong> åœ¨ <code>main()</code> æˆ–å…³é”®å…¥å£å¤„ä½¿ç”¨ <code>recover()</code> æ•è·æ„å¤– panicï¼Œè‡³å°‘æ‰“å°å‹å¥½é”™è¯¯å¹¶ç¡®ä¿ç¨‹åºä»¥é 0 çŠ¶æ€ç é€€å‡ºã€‚</li><li><strong>æ¸…æ™°çš„é€€å‡ºç ï¼š</strong> ä½¿ç”¨ <code>os.Exit(code)</code>ã€‚éµå¾ªæƒ¯ä¾‹ï¼š0 æˆåŠŸï¼Œé 0 è¡¨ç¤ºå„ç§é”™è¯¯ã€‚æ–¹ä¾¿è„šæœ¬é›†æˆã€‚</li></ol><hr><h2 id="ğŸ”’-å®‰å…¨æ€§ä¸ä¼ä¸šçº§éœ€æ±‚" tabindex="-1">ğŸ”’ å®‰å…¨æ€§ä¸ä¼ä¸šçº§éœ€æ±‚ <a class="header-anchor" href="#ğŸ”’-å®‰å…¨æ€§ä¸ä¼ä¸šçº§éœ€æ±‚" aria-label="Permalink to &quot;ğŸ”’ å®‰å…¨æ€§ä¸ä¼ä¸šçº§éœ€æ±‚&quot;">â€‹</a></h2><h3 id="k8s-api-æƒé™ç»†ç²’åº¦æ§åˆ¶" tabindex="-1">K8s API æƒé™ç»†ç²’åº¦æ§åˆ¶ <a class="header-anchor" href="#k8s-api-æƒé™ç»†ç²’åº¦æ§åˆ¶" aria-label="Permalink to &quot;K8s API æƒé™ç»†ç²’åº¦æ§åˆ¶&quot;">â€‹</a></h3><p>åœ¨ CLI å±‚é¢æ”¯æŒ RBAC æƒé™æ ¡éªŒã€impersonate æœºåˆ¶ï¼Œæ»¡è¶³ä¼ä¸šå¤šç§Ÿæˆ·å’Œå®‰å…¨åˆè§„éœ€æ±‚ã€‚</p><h3 id="æ•æ„Ÿä¿¡æ¯ä¿æŠ¤" tabindex="-1">æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ <a class="header-anchor" href="#æ•æ„Ÿä¿¡æ¯ä¿æŠ¤" aria-label="Permalink to &quot;æ•æ„Ÿä¿¡æ¯ä¿æŠ¤&quot;">â€‹</a></h3><p>å®‰å…¨å¤„ç† kubeconfigã€token ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œé˜²æ­¢æ—¥å¿—æ³„éœ²å’Œæœ¬åœ°æ˜æ–‡å­˜å‚¨ã€‚</p><hr><h2 id="ğŸ“¦-æ‰“åŒ…ä¸åˆ†å‘-è®©ä¸–ç•Œç”¨ä¸Šä½ çš„å·¥å…·" tabindex="-1">ğŸ“¦ æ‰“åŒ…ä¸åˆ†å‘ï¼šè®©ä¸–ç•Œç”¨ä¸Šä½ çš„å·¥å…· <a class="header-anchor" href="#ğŸ“¦-æ‰“åŒ…ä¸åˆ†å‘-è®©ä¸–ç•Œç”¨ä¸Šä½ çš„å·¥å…·" aria-label="Permalink to &quot;ğŸ“¦ æ‰“åŒ…ä¸åˆ†å‘ï¼šè®©ä¸–ç•Œç”¨ä¸Šä½ çš„å·¥å…·&quot;">â€‹</a></h2><ol><li><strong>å¤šå¹³å°ç¼–è¯‘ï¼š</strong> Go çš„äº¤å‰ç¼–è¯‘æå…¶ç®€å•ï¼š<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GOOS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">linux</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GOARCH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">amd64</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mykctl-linux-amd64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GOOS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">darwin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GOARCH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arm64</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mykctl-macos-arm64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GOOS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">windows</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GOARCH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">amd64</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mykctl-windows-amd64.exe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre></div></li><li><strong>ç‰ˆæœ¬ç®¡ç†ï¼š</strong> ä½¿ç”¨ <code>git tag</code> å’Œ <code>-ldflags</code> æ³¨å…¥ç‰ˆæœ¬ä¿¡æ¯ï¼š<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">go</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ldflags</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;-X main.version=1.0.0&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mykctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre></div></li><li><strong>åŒ…ç®¡ç†å™¨ï¼š</strong><ul><li><strong>Homebrew (macOS/Linux)ï¼š</strong> åˆ›å»º Formulaï¼Œæ‰˜ç®¡åœ¨ä¸ªäºº Tap æˆ–æäº¤åˆ°å®˜æ–¹ä»“åº“ï¼ˆå¦‚æœè¶³å¤Ÿæµè¡Œï¼‰ã€‚</li><li><strong>Scoop (Windows)ï¼š</strong> åˆ›å»º Bucketã€‚</li><li><strong>Linux åŒ… (deb/rpm)ï¼š</strong> ä½¿ç”¨ <code>nfpm</code> ç­‰å·¥å…·æ‰“åŒ…ã€‚</li></ul></li><li><strong>å®¹å™¨åŒ–ï¼š</strong> å°†å·¥å…·æ‰“åŒ…è¿›å°å‹ Docker é•œåƒ (<code>FROM scratch</code> æˆ– <code>FROM alpine</code>)ï¼Œæ–¹ä¾¿åœ¨ CI/CD æˆ–å—é™ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</li></ol><hr><h2 id="ğŸ“š-è¿›é˜¶é˜…è¯»ä¸ç¤¾åŒºèµ„æº" tabindex="-1">ğŸ“š è¿›é˜¶é˜…è¯»ä¸ç¤¾åŒºèµ„æº <a class="header-anchor" href="#ğŸ“š-è¿›é˜¶é˜…è¯»ä¸ç¤¾åŒºèµ„æº" aria-label="Permalink to &quot;ğŸ“š è¿›é˜¶é˜…è¯»ä¸ç¤¾åŒºèµ„æº&quot;">â€‹</a></h2><ul><li><a href="https://github.com/kubernetes/kubectl" target="_blank" rel="noreferrer">kubectl æºç æ¶æ„è§£è¯»</a></li><li><a href="https://krew.sigs.k8s.io/" target="_blank" rel="noreferrer">Krew æ’ä»¶ç”Ÿæ€</a></li><li><a href="https://github.com/urfave/cli" target="_blank" rel="noreferrer">Go CLI å·¥å…·æœ€ä½³å®è·µ</a></li><li><a href="https://github.com/charmbracelet/bubbletea" target="_blank" rel="noreferrer">bubbletea TUI æ¡†æ¶</a></li><li><a href="https://golang.org/pkg/plugin/" target="_blank" rel="noreferrer">Go plugin åŠ¨æ€åŠ è½½</a></li></ul><hr><h2 id="ğŸ¯-æ€»ç»“-ä»æ¨¡ä»¿åˆ°åˆ›æ–°" tabindex="-1">ğŸ¯ æ€»ç»“ï¼šä»æ¨¡ä»¿åˆ°åˆ›æ–° <a class="header-anchor" href="#ğŸ¯-æ€»ç»“-ä»æ¨¡ä»¿åˆ°åˆ›æ–°" aria-label="Permalink to &quot;ğŸ¯ æ€»ç»“ï¼šä»æ¨¡ä»¿åˆ°åˆ›æ–°&quot;">â€‹</a></h2><p>æ„å»ºä¸€ä¸ªç±» <code>kubectl</code> çš„ CLI å·¥å…·ï¼Œç»ä¸ä»…ä»…æ˜¯å¤åˆ¶å‘½ä»¤ã€‚é€šè¿‡ Go çš„ <code>cobra</code> æ„å»ºå‘½ä»¤éª¨æ¶ï¼Œåˆ©ç”¨ <code>client-go</code> ä¸ Kubernetes API æ·±åº¦äº¤äº’ï¼Œç²¾å¿ƒè®¾è®¡è¾“å‡ºæ ¼å¼åŒ–å’Œç”¨æˆ·ä½“éªŒï¼Œå¹¶æ³¨é‡é”™è¯¯å¤„ç†ä¸åˆ†å‘ï¼Œä½ å°±èƒ½æ‰“é€ å‡ºä¸€ä¸ªçœŸæ­£å¼ºå¤§ã€æ˜“ç”¨ä¸”ä¸“ä¸šçš„å‘½ä»¤è¡Œç¥å™¨ã€‚</p><p><strong>æ¨¡ä»¿ <code>kubectl</code> æ˜¯å­¦ä¹ çš„æ·å¾„ï¼Œä½†çœŸæ­£çš„åŠ›é‡åœ¨äºç†è§£å…¶è®¾è®¡å“²å­¦ï¼š</strong> å°†å¤æ‚çš„äº‘åŸç”Ÿæ“ä½œæŠ½è±¡ä¸ºç®€æ´ã€ä¸€è‡´ã€å¯ç»„åˆçš„å‘½ä»¤è¡Œäº¤äº’ã€‚å½“ä½ æŒæ¡äº†è¿™äº›æ ¸å¿ƒæŠ€æœ¯ç‚¹ï¼Œä½ å°±å¯ä»¥è¶…è¶Šæ¨¡ä»¿ï¼Œä¸ºä»»ä½• APIã€ä»»ä½•æœåŠ¡ã€ä»»ä½•ä½ æƒ³é«˜æ•ˆç®¡ç†çš„å¯¹è±¡ï¼Œåˆ›é€ å‡ºç‹¬ä¸€æ— äºŒçš„å‘½ä»¤è¡Œç•Œé¢ã€‚</p><blockquote><p>â€œå·¥å…·çš„æè‡´ï¼Œæ˜¯è®©å¤æ‚ä¸–ç•Œå˜å¾—å¯æ§ã€‚â€ ä½œä¸ºèµ„æ·±å¼€å‘è€…ï¼Œæ‰“é€  CLI å·¥å…·ä¸ä»…æ˜¯æŠ€æœ¯å®ç°ï¼Œæ›´æ˜¯æ¶æ„è®¾è®¡ã€å·¥ç¨‹å®è·µã€ç”¨æˆ·ä½“éªŒå’Œç”Ÿæ€æ€ç»´çš„ç»¼åˆä½“ç°ã€‚ ä½ å¯ä»¥ä»æ¨¡ä»¿ kubectl èµ·æ­¥ï¼Œä½†æ›´å€¼å¾—æ€è€ƒçš„æ˜¯ï¼šå¦‚ä½•è®©ä½ çš„å·¥å…·å…·å¤‡å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯è§‚æµ‹æ€§ï¼Œå¹¶æœ€ç»ˆæˆä¸ºå¼€å‘è€…ç”Ÿæ€ä¸­çš„ä¸€ç¯ã€‚</p></blockquote><p><strong>ç°åœ¨ï¼Œæ‰“å¼€ä½ çš„ç»ˆç«¯ï¼Œå¯åŠ¨ VS Codeï¼Œæ•²ä¸‹ <code>go mod init your-awesome-cli</code> â€”â€” ä½ çš„å‘½ä»¤è¡Œç¥å™¨ä¹‹æ—…ï¼Œæ­£å¼å¯èˆªï¼</strong> ğŸš€</p><blockquote><p><strong>â€œæˆ‘ä»¬å¡‘é€ å·¥å…·ï¼Œç„¶åå·¥å…·å¡‘é€ æˆ‘ä»¬ã€‚â€</strong> â€”â€” é©¬æ­‡å°”Â·éº¦å…‹å¢æ±‰ã€‚ä½ æ‰‹ä¸­çš„ Go ä»£ç ï¼Œå³å°†å¡‘é€ å¼€å‘è€…ä¸å¤æ‚ç³»ç»Ÿäº¤äº’çš„å…¨æ–°æ–¹å¼ã€‚</p></blockquote>`,78)]))}const g=i(t,[["render",h]]);export{E as __pageData,g as default};
