import{_ as i,c as a,o as n,a6 as t}from"./chunks/framework.DFafSIgU.js";const d=JSON.parse('{"title":"A Practical Guide to Python Coroutines with asyncio","description":"A practical guide to understanding and using Python coroutines with the asyncio library for high-performance I/O-bound tasks.","frontmatter":{"title":"A Practical Guide to Python Coroutines with asyncio","date":"2023-04-07T09:28:47.000Z","tags":["python","asyncio","concurrency"],"description":"A practical guide to understanding and using Python coroutines with the asyncio library for high-performance I/O-bound tasks.","author":"PFinal南丞","keywords":"Python, coroutine, concurrency, programming, asyncio, async, await, aiohttp","head":[["link",{"rel":"alternate","hreflang":"en","href":"https://friday-go.icu/python/Python-Coroutines.html"}],["link",{"rel":"alternate","hreflang":"zh-CN","href":"https://friday-go.icu/zh/python/Python-Coroutines.html"}],["link",{"rel":"alternate","hreflang":"x-default","href":"https://friday-go.icu/python/Python-Coroutines.html"}],["meta",{"name":"keywords","content":"Python, coroutine, concurrency, programming, asyncio, async, await, aiohttp, PFinalClub, Golang, PHP, Python, 技术博客, Tech Blog"}]]},"headers":[],"relativePath":"python/Python-Coroutines.md","filePath":"python/Python-Coroutines.md","lastUpdated":1763718357000}'),e={name:"python/Python-Coroutines.md"};function h(l,s,o,p,r,k){return n(),a("div",{"data-pagefind-body":!0,"data-pagefind-meta":"date:1680859727000"},s[0]||(s[0]=[t(`<h1 id="a-practical-guide-to-python-coroutines-with-asyncio" tabindex="-1">A Practical Guide to Python Coroutines with asyncio <a class="header-anchor" href="#a-practical-guide-to-python-coroutines-with-asyncio" aria-label="Permalink to &quot;A Practical Guide to Python Coroutines with asyncio&quot;">​</a></h1><p>In modern programming, especially for web services and network applications, handling many tasks concurrently is a common requirement. Python&#39;s <code>asyncio</code> library, combined with <code>async</code>/<code>await</code> syntax, provides a powerful way to write concurrent code that is both efficient and readable. This guide will walk you through the core concepts of Python coroutines and demonstrate their power with a practical example.</p><h2 id="what-are-coroutines-and-why-use-them" tabindex="-1">What are Coroutines and Why Use Them? <a class="header-anchor" href="#what-are-coroutines-and-why-use-them" aria-label="Permalink to &quot;What are Coroutines and Why Use Them?&quot;">​</a></h2><p>A <strong>coroutine</strong> is a special type of function that can pause its execution before it has returned, and can implicitly transfer control to another coroutine for a while. This makes them ideal for <strong>I/O-bound</strong> tasks, where the program spends most of its time waiting for external resources like network responses, database queries, or disk reads/writes.</p><p>Instead of blocking a whole thread while waiting, a coroutine yields control to an <strong>event loop</strong>, which can then run other tasks. When the waiting operation is complete, the event loop resumes the paused coroutine. This model of cooperative multitasking can handle thousands of concurrent operations on a single thread with minimal overhead.</p><p><strong>Key takeaway</strong>: Use <code>asyncio</code> for I/O-bound tasks, not for CPU-bound tasks (for which <code>multiprocessing</code> is better suited).</p><h2 id="core-concepts-async-await-and-the-event-loop" tabindex="-1">Core Concepts: <code>async</code>, <code>await</code>, and the Event Loop <a class="header-anchor" href="#core-concepts-async-await-and-the-event-loop" aria-label="Permalink to &quot;Core Concepts: \`async\`, \`await\`, and the Event Loop&quot;">​</a></h2><p>Since Python 3.5, the <code>async</code> and <code>await</code> keywords have become the standard way to work with coroutines.</p><ol><li><p><strong><code>async def</code></strong>: This syntax is used to declare a function as a <strong>coroutine</strong>. When you call a coroutine function, it doesn&#39;t execute immediately; instead, it returns a coroutine object.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_coroutine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello from a coroutine!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Calling it returns a coroutine object, it doesn&#39;t print anything yet.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">coro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> my_coroutine()</span></span></code></pre></div></li><li><p><strong><code>await</code></strong>: This keyword is used inside a coroutine to pause its execution and wait for an &quot;awaitable&quot; object (like another coroutine) to complete. While it&#39;s waiting, the event loop is free to run other tasks.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Start waiting...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Pause main() and wait for another_coroutine() to finish</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> another_coroutine() </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;...finished waiting.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Rule</strong>: <code>await</code> can only be used inside an <code>async def</code> function.</p></li><li><p><strong>The Event Loop</strong>: This is the heart of <code>asyncio</code>. It&#39;s the scheduler that manages and runs all the coroutines. The simplest way to start the event loop and run a coroutine is with <code>asyncio.run()</code>.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asyncio</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Running in the event loop!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This starts the event loop, runs the main coroutine until it completes,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># and then closes the loop.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asyncio.run(main())</span></span></code></pre></div></li></ol><h2 id="practical-example-synchronous-vs-asynchronous-web-requests" tabindex="-1">Practical Example: Synchronous vs. Asynchronous Web Requests <a class="header-anchor" href="#practical-example-synchronous-vs-asynchronous-web-requests" aria-label="Permalink to &quot;Practical Example: Synchronous vs. Asynchronous Web Requests&quot;">​</a></h2><p>Let&#39;s see the power of <code>asyncio</code> in action. We&#39;ll write two scripts to fetch the status of several websites: one synchronously (one by one) and one asynchronously (concurrently).</p><h3 id="the-synchronous-slow-way" tabindex="-1">The Synchronous (Slow) Way <a class="header-anchor" href="#the-synchronous-slow-way" aria-label="Permalink to &quot;The Synchronous (Slow) Way&quot;">​</a></h3><p>This script uses the popular <code>requests</code> library to fetch URLs sequentially.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sync_fetch.py</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requests</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">urls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.python.org&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.google.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.github.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.microsoft.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.apple.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch_sync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Fetching </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    requests.get(url)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Fetched </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">start_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.time()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> urls:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fetch_sync(url)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.time() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> start_time</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Synchronous fetching took </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:.2f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> seconds.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>When you run this, you&#39;ll see that it fetches each URL one after the other. The total time will be the sum of all individual request times. <strong>Typical Output</strong>: <code>Synchronous fetching took 5.31 seconds.</code></p><h3 id="the-asynchronous-fast-way" tabindex="-1">The Asynchronous (Fast) Way <a class="header-anchor" href="#the-asynchronous-fast-way" aria-label="Permalink to &quot;The Asynchronous (Fast) Way&quot;">​</a></h3><p>This version uses the <code>aiohttp</code> library (an async-compatible alternative to <code>requests</code>) and <code>asyncio</code> to fetch all URLs concurrently.</p><p>First, install <code>aiohttp</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aiohttp</span></span></code></pre></div><p>Now, the async code:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># async_fetch.py</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aiohttp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asyncio</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">urls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.python.org&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.google.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.github.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.microsoft.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;https://www.apple.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch_async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(session, url):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Fetching </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> session.get(url) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # We just need the status, so we don&#39;t need to read the body</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Fetched </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> with status: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.status</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.status</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aiohttp.ClientSession() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> session:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Create a list of tasks to run concurrently</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tasks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [fetch_async(session, url) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> urls]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Wait for all tasks to complete</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asyncio.gather(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tasks)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">start_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.time()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run the main coroutine</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asyncio.run(main())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.time() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> start_time</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Asynchronous fetching took </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:.2f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> seconds.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>When you run this, you&#39;ll see that all the &quot;Fetching...&quot; messages appear almost at once. The total time will be roughly the time it takes for the <em>slowest</em> single request to complete. <strong>Typical Output</strong>: <code>Asynchronous fetching took 1.12 seconds.</code></p><p>The performance improvement is dramatic!</p><h2 id="key-asyncio-patterns" tabindex="-1">Key <code>asyncio</code> Patterns <a class="header-anchor" href="#key-asyncio-patterns" aria-label="Permalink to &quot;Key \`asyncio\` Patterns&quot;">​</a></h2><ul><li><strong><code>asyncio.run(coro)</code></strong>: The main entry point to run a top-level coroutine.</li><li><strong><code>await asyncio.gather(*coroutines)</code></strong>: A crucial function for running multiple coroutines concurrently and waiting for all of them to finish.</li><li><strong><code>await asyncio.sleep(seconds)</code></strong>: The non-blocking version of <code>time.sleep()</code>. It pauses the current coroutine without blocking the entire event loop.</li></ul><h2 id="important-rules-and-pitfalls" tabindex="-1">Important Rules and Pitfalls <a class="header-anchor" href="#important-rules-and-pitfalls" aria-label="Permalink to &quot;Important Rules and Pitfalls&quot;">​</a></h2><ol><li><p><strong>&quot;Async All the Way&quot;</strong>: Once you use <code>await</code> in a function, that function must be declared with <code>async def</code>. This &quot;async&quot; nature tends to propagate up your call stack. You can&#39;t simply call an <code>async</code> function from a regular synchronous function without using an entry point like <code>asyncio.run()</code>.</p></li><li><p><strong>Don&#39;t Block the Event Loop</strong>: The biggest mistake you can make is to use a blocking I/O call inside a coroutine. For example, using <code>requests.get()</code> or <code>time.sleep()</code> will freeze your entire application, as it blocks the single thread the event loop is running on.</p></li><li><p><strong>Use Async-Compatible Libraries</strong>: Always use libraries designed for <code>asyncio</code> when performing I/O operations.</p><ul><li>For HTTP requests, use <code>aiohttp</code> or <code>httpx</code>.</li><li>For database access, use libraries like <code>asyncpg</code> (for PostgreSQL) or <code>aiomysql</code> (for MySQL).</li></ul></li></ol><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>Python&#39;s coroutines and the <code>asyncio</code> library provide a powerful and efficient way to handle concurrent I/O-bound tasks. By understanding the <code>async</code>/<code>await</code> syntax and the role of the event loop, you can write code that performs significantly better than traditional synchronous code for tasks involving network requests, database queries, and other operations where the program spends time waiting. The key is to embrace the asynchronous mindset and use the right set of async-compatible libraries to keep the event loop running smoothly.</p>`,29)]))}const y=i(e,[["render",h]]);export{d as __pageData,y as default};
